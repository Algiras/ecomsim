import{r as u,a as tn,R as H,A as we,b as ke,C as Y,c as N,X as z,Y as K,T as V,d as T,L as _e,e as fe,B as nn,f as on,g as an,h as rn}from"./charts-CMCdbFuf.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}})();var Mt={exports:{}},Oe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sn=u,ln=Symbol.for("react.element"),cn=Symbol.for("react.fragment"),dn=Object.prototype.hasOwnProperty,un=sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,fn={key:!0,ref:!0,__self:!0,__source:!0};function Ft(t,o,n){var i,a={},r=null,l=null;n!==void 0&&(r=""+n),o.key!==void 0&&(r=""+o.key),o.ref!==void 0&&(l=o.ref);for(i in o)dn.call(o,i)&&!fn.hasOwnProperty(i)&&(a[i]=o[i]);if(t&&t.defaultProps)for(i in o=t.defaultProps,o)a[i]===void 0&&(a[i]=o[i]);return{$$typeof:ln,type:t,key:r,ref:l,props:a,_owner:un.current}}Oe.Fragment=cn;Oe.jsx=Ft;Oe.jsxs=Ft;Mt.exports=Oe;var e=Mt.exports,Qe={},gt=tn;Qe.createRoot=gt.createRoot,Qe.hydrateRoot=gt.hydrateRoot;function pn(t,o,n){return Math.max(o,Math.min(n,t))}const hn={food:"#22c55e",housing:"#f59e0b",tech:"#6366f1",luxury:"#ec4899"},mn=[{id:"incomeTax",name:"Income Tax",category:"fiscal",type:"slider",min:0,max:.6,step:.01,format:"percent",icon:"üèõÔ∏è",description:"Tax on worker wages. Funds public spending. Too high reduces work incentive.",tradeoff:"‚Üë Revenue but ‚Üì Worker take-home pay"},{id:"corporateTax",name:"Corporate Tax",category:"fiscal",type:"slider",min:0,max:.5,step:.01,format:"percent",icon:"üè¢",description:"Tax on business profits. High rates may deter investment.",tradeoff:"‚Üë Revenue but ‚Üì Business investment"},{id:"minWage",name:"Minimum Wage",category:"labor",type:"slider",min:0,max:30,step:1,format:"currency",icon:"üíº",description:"Floor on wages. Protects workers but may price out low-skill labor.",tradeoff:"‚Üë Worker wages but ‚Üë Unemployment risk"},{id:"ubi",name:"Universal Basic Income",category:"welfare",type:"slider",min:0,max:500,step:10,format:"currency",icon:"üéÅ",description:"Unconditional payment to all citizens. Eliminates poverty floor. Very expensive.",tradeoff:"‚Üë Equality but ‚Üë‚Üë Government spending"},{id:"interestRate",name:"Interest Rate",category:"monetary",type:"slider",min:0,max:.2,step:.005,format:"percent",icon:"üè¶",description:"Cost of borrowing money. High rates fight inflation but slow growth.",tradeoff:"‚Üë Fights inflation but ‚Üì Business investment"},{id:"reserveRequirement",name:"Reserve Requirement",category:"monetary",type:"slider",min:0,max:.5,step:.05,format:"percent",icon:"üè¶",description:"Fraction of deposits banks must hold in reserve. Higher = safer banks but less lending.",tradeoff:"‚Üë Bank stability but ‚Üì Credit availability"},{id:"depositInsurance",name:"Deposit Insurance",category:"monetary",type:"toggle",icon:"üõ°Ô∏è",description:"Government guarantees bank deposits up to $1000. Prevents bank runs but creates moral hazard.",tradeoff:"‚Üë Depositor confidence but banks may take more risks"},{id:"maxLoanToValue",name:"Max Loan-to-Value",category:"monetary",type:"slider",min:.5,max:1,step:.05,format:"percent",icon:"üè†",description:"Maximum mortgage as a fraction of property value. Lower = bigger down payment required.",tradeoff:"‚Üë Lending safety but ‚Üì Home ownership accessibility"},{id:"antiMonopoly",name:"Anti-Monopoly Laws",category:"regulation",type:"toggle",icon:"‚öñÔ∏è",description:"Break up businesses that dominate a market. Prevents price gouging.",tradeoff:"‚Üë Competition but ‚Üì Economies of scale"},{id:"educationFunding",name:"Education Spending",category:"public",type:"slider",min:0,max:1,step:.05,format:"percent",icon:"üìö",description:"Invests in workforce quality over time. Slow payoff, lasting effect.",tradeoff:"‚Üë Long-term productivity but ‚Üë Government spending now"},{id:"unemploymentBenefit",name:"Unemployment Benefits",category:"welfare",type:"slider",min:0,max:300,step:10,format:"currency",icon:"üõ°Ô∏è",description:"Payments to unemployed workers. Maintains demand but may reduce job search urgency.",tradeoff:"‚Üë Stability but may ‚Üë Unemployment duration"},{id:"priceControlFood",name:"Food Price Controls",category:"regulation",type:"toggle",icon:"üåæ",description:"Caps food prices to protect the poor. May cause shortages if price is too low.",tradeoff:"‚Üë Affordability but ‚Üì Farm investment"},{id:"priceControlHousing",name:"Rent Controls",category:"regulation",type:"toggle",icon:"üè†",description:"Limits housing rent increases. Helps existing tenants, discourages new supply.",tradeoff:"‚Üë Affordability but ‚Üì New housing construction"},{id:"printMoney",name:"Quantitative Easing",category:"monetary",type:"slider",min:0,max:50,step:1,format:"number",icon:"üñ®Ô∏è",description:"Inject money into the economy. Boosts demand but causes inflation.",tradeoff:"‚Üë Short-term demand but ‚Üë‚Üë Inflation risk"},{id:"publicHealthcare",name:"Public Healthcare",category:"public",type:"toggle",icon:"üè•",description:"Government-funded health. Improves health, reduces death rate, increases happiness.",tradeoff:"‚Üë Health + happiness but ‚Üë‚Üë Government spending"},{id:"wealthTax",name:"Wealth Tax",category:"fiscal",type:"slider",min:0,max:.05,step:.001,format:"percent",icon:"üíé",description:"Annual tax on total wealth above threshold. Directly reduces inequality.",tradeoff:"‚Üë Equality but ‚Üì Capital accumulation"},{id:"openBorders",name:"Open Immigration",category:"labor",type:"toggle",icon:"üåç",description:"Allow skilled immigrants. Boosts labor supply and productivity, may suppress wages.",tradeoff:"‚Üë Productivity but ‚Üë Job competition"},{id:"subsidiesFarming",name:"Farm Subsidies",category:"fiscal",type:"toggle",icon:"üöú",description:"Government support for food production. Lowers food prices but costs taxpayers.",tradeoff:"‚Üë Food supply + lower prices but ‚Üë Spending"},{id:"fourDayWeek",name:"4-Day Work Week",category:"weird",type:"toggle",icon:"üóìÔ∏è",description:"Mandate a 4-day work week for all businesses. Workers are happier and healthier ‚Äî but businesses get 20% less output per worker.",tradeoff:"‚Üë Worker health & morale but ‚Üì Business productivity"},{id:"robotTax",name:"Robot Tax",category:"weird",type:"slider",min:0,max:.5,step:.05,format:"percent",icon:"ü§ñ",description:"Tax on automated production in the tech sector. Slows job displacement and funds redistribution.",tradeoff:"‚Üë Employment but ‚Üì Tech sector growth"},{id:"breadAndCircuses",name:"Bread & Circuses",category:"weird",type:"toggle",icon:"üé™",description:"Government-funded free food and entertainment for all. Romans used it to keep the masses pacified. Crushes unrest ‚Äî briefly.",tradeoff:"‚Üì Unrest now but ‚Üë Gov spending + dependency risk"},{id:"mandatoryProfitShare",name:"Mandatory Profit Sharing",category:"weird",type:"slider",min:0,max:.3,step:.05,format:"percent",icon:"ü§ù",description:"Businesses must share a percentage of profits with all employees. Reduces inequality, may deter investment.",tradeoff:"‚Üë Worker wealth + lower Gini but ‚Üì Business capital"},{id:"landValueTax",name:"Land Value Tax",category:"weird",type:"slider",min:0,max:.05,step:.005,format:"percent",icon:"üåç",description:"Annual tax on land value only (not buildings). Georgist reform ‚Äî discourages speculation, funds government efficiently.",tradeoff:"‚Üë Gov revenue + lower housing prices but unpopular with landowners"},{id:"banAdvertising",name:"Ban Advertising",category:"weird",type:"toggle",icon:"üö´",description:"Outlaws all commercial advertising. Luxury demand collapses. People only buy what they actually need. Businesses struggle to grow.",tradeoff:"‚Üì Luxury consumption + lower Gini but ‚Üì Business growth"},{id:"debtJubilee",name:"Debt Jubilee",category:"weird",type:"toggle",icon:"üé∫",description:"One-time Biblical-style cancellation of all debts. Agents with negative wealth are reset to zero. Happens once then turns off.",tradeoff:"Massive one-time equality reset ‚Äî may destabilize lenders"},{id:"lotteryRedistribution",name:"Wealth Lottery",category:"weird",type:"toggle",icon:"üé∞",description:'Each tick, a random wealthy citizen pays a "luck tax" directly to a random poor citizen. Chaotic but surprisingly equalizing.',tradeoff:"‚Üì Extreme wealth concentration but unpredictable and arbitrary"},{id:"sumptuary",name:"Sumptuary Laws",category:"weird",type:"toggle",icon:"üëë",description:"Legal limits on luxury spending for the wealthy. Medieval kings used these. Luxury sector collapses but inequality drops.",tradeoff:"‚Üì Inequality + ‚Üì Gini but luxury sector destruction"},{id:"degrowth",name:"Degrowth Policy",category:"weird",type:"toggle",icon:"üå±",description:"Deliberately slow economic growth. Less GDP obsession means less stress, more stability, better health ‚Äî but economists freak out.",tradeoff:"‚Üì GDP growth + ‚Üë Health & stability but controversial"},{id:"algoCentralPlanning",name:"Algorithmic Planning",category:"weird",type:"toggle",icon:"üßÆ",description:"An AI algorithm sets all prices and wages. Eliminates market volatility. Cold, efficient, and slightly dystopian.",tradeoff:"‚Üì Price chaos but removes market discovery + creepy"},{id:"universalBankAccount",name:"Universal Bank Account",category:"weird",type:"toggle",icon:"üèß",description:"Every citizen gets a free government bank account. Reduces financial exclusion, enables direct transfers, improves savings rates.",tradeoff:"‚Üë Financial inclusion + savings but ‚Üë Gov infrastructure cost"},{id:"policeFunding",name:"Police Funding",category:"security",type:"slider",min:0,max:1,step:.05,format:"percent",icon:"üöî",description:"Funding for law enforcement. Higher funding deters street crime and increases arrest rates, but costs the government.",tradeoff:"‚Üì Street crime but ‚Üë Government spending"},{id:"financialOversight",name:"Financial Oversight",category:"security",type:"slider",min:0,max:1,step:.05,format:"percent",icon:"üîç",description:"Funding for corporate crime investigation. Detects fraud, embezzlement, and price fixing. Expensive but protects the economy.",tradeoff:"‚Üì Corporate crime but ‚Üë Government spending + regulatory burden"},{id:"prisonReform",name:"Prison Reform",category:"security",type:"toggle",icon:"üèõÔ∏è",description:"Rehabilitative programs for inmates. Reduces reoffending rates but costs money. Treats causes rather than symptoms.",tradeoff:"‚Üì Recidivism but ‚Üë Government spending"},{id:"capitalGainsTax",name:"Capital Gains Tax",category:"fiscal",type:"slider",min:0,max:.5,step:.01,format:"percent",icon:"üìà",description:"Tax on stock dividends and investment income. Higher rates reduce inequality but discourage investment.",tradeoff:"‚Üë Revenue + ‚Üì Inequality but ‚Üì Investment incentive"},{id:"exportSubsidies",name:"Export Subsidies",category:"trade",type:"slider",min:0,max:.5,step:.05,format:"percent",icon:"üö¢",description:"Government subsidizes exporters to make domestic goods competitive abroad. Costs government revenue but improves trade balance.",tradeoff:"‚Üë Exports + trade surplus but ‚Üë Government spending"},{id:"foreignReserveIntervention",name:"FX Intervention",category:"trade",type:"toggle",icon:"üí±",description:"Central bank buys/sells foreign currency to stabilize the exchange rate. Burns foreign reserves but prevents wild currency swings.",tradeoff:"‚Üë FX stability but ‚Üì Foreign reserves"},{id:"helicopterMoney",name:"Helicopter Money",category:"chaos",type:"slider",min:0,max:500,step:10,format:"currency",icon:"üöÅ",description:"Drop cash directly into every citizen's pocket every tick. Milton Friedman's thought experiment. Pure demand stimulus ‚Äî with pure inflation consequences.",tradeoff:"‚Üë‚Üë Demand and spending but ‚Üë‚Üë‚Üë Inflation ‚Äî eventually hyperinflation"},{id:"maximumWage",name:"Maximum Wage",category:"chaos",type:"slider",min:0,max:500,step:10,format:"currency",icon:"üîí",description:"Hard cap on how much anyone can earn. Income above the limit is confiscated. No CEO mega-salaries allowed. Brain drain incoming.",tradeoff:"‚Üì Inequality and Gini but ‚Üë Risk of skill emigration and talent suppression"},{id:"wealthConfiscation",name:"Wealth Confiscation",category:"chaos",type:"slider",min:0,max:.5,step:.05,format:"percent",icon:"ü™ì",description:"Seize a portion of all wealth above $1000. Not a tax ‚Äî an outright seizure. The rich will not be happy. Capital flight begins immediately.",tradeoff:"‚Üì‚Üì Gini immediately but ‚Üë Capital flight, investment collapse, and rich agent rage"},{id:"nationalizeIndustries",name:"Nationalize Industries",category:"chaos",type:"toggle",icon:"üè≠",description:'The government takes over all private businesses. Workers get flat wages. Production is "planned." The invisible hand is replaced by a five-year plan.',tradeoff:"‚Üì Unemployment but ‚Üì‚Üì Productivity, ‚Üë Gov costs, and businesses stop innovating"},{id:"punitiveTargiffs",name:"Punitive Tariffs",category:"chaos",type:"slider",min:0,max:2,step:.1,format:"percent",icon:"üöß",description:'Slap a massive surcharge on all goods. "Protecting" the economy. In practice: prices skyrocket, consumers suffer, trading partners retaliate.',tradeoff:"‚Üë‚Üë Prices (inflation) and ‚Üì Real wages ‚Äî the Smoot-Hawley special"},{id:"guaranteedJobs",name:"Guaranteed Jobs Program",category:"chaos",type:"toggle",icon:"üë∑",description:"The government employs every unemployed citizen at minimum wage. Unemployment vanishes on paper. The government payroll explodes.",tradeoff:"‚Üì Unemployment to 0% but ‚Üë‚Üë‚Üë Government spending and budget deficit"}];function gn({policy:t,value:o,onChange:n,lagProgress:i,lagTarget:a,highlighted:r}){const l=s=>t.format==="percent"?(s*100).toFixed(0)+"%":t.format==="currency"?"$"+s:s,c=i!==void 0&&i<1;return e.jsxs("div",{className:`group ${r?"rounded-lg p-1.5 -m-1.5":""}`,style:r?{boxShadow:"0 0 12px #6366f166, inset 0 0 8px #6366f122",border:"1.5px solid #6366f1",background:"#6366f10a"}:void 0,children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-sm",children:t.icon}),e.jsx("span",{className:"text-xs text-[#e2e8f0] font-mono",children:t.name}),c&&e.jsxs("span",{className:"text-[9px] font-mono text-amber-400 bg-amber-400/10 px-1 rounded animate-pulse",children:[Math.round(i*100),"%"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs font-bold font-mono text-[#6366f1]",children:l(o)}),c&&a!==void 0&&e.jsxs("span",{className:"text-[10px] font-mono text-amber-400",children:["‚Üí ",l(a)]})]})]}),e.jsx("input",{type:"range",min:t.min,max:t.max,step:t.step,value:c&&a!==void 0?a:o,onChange:s=>n(t.id,parseFloat(s.target.value)),className:"w-full h-1.5 rounded-full appearance-none cursor-pointer",style:{background:`linear-gradient(to right, #6366f1 0%, #6366f1 ${(o-t.min)/(t.max-t.min)*100}%, ${c?"#f59e0b33":"#1e1e2e"} ${(o-t.min)/(t.max-t.min)*100}%, ${c&&a!==void 0?"#f59e0b33 "+(a-t.min)/(t.max-t.min)*100+"%, #1e1e2e "+(a-t.min)/(t.max-t.min)*100+"%":"#1e1e2e"} 100%)`},title:t.description}),c&&e.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-1 mt-1",children:e.jsx("div",{className:"h-1 rounded-full bg-amber-400 transition-all",style:{width:`${i*100}%`}})}),e.jsx("div",{className:"text-[10px] text-[#475569] mt-1 leading-tight",children:t.tradeoff})]})}function xn({policy:t,value:o,onChange:n,highlighted:i}){return e.jsxs("div",{className:`py-0.5 ${i?"rounded-lg p-1.5 -m-0.5":""}`,style:i?{boxShadow:"0 0 12px #6366f166, inset 0 0 8px #6366f122",border:"1.5px solid #6366f1",background:"#6366f10a"}:void 0,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:"text-sm flex-shrink-0",children:t.icon}),e.jsx("span",{className:"text-xs text-[#e2e8f0] font-mono truncate",children:t.name})]}),e.jsx("button",{onClick:()=>n(t.id,!o),className:"flex-shrink-0 ml-2",style:{position:"relative",width:36,height:20,borderRadius:10,backgroundColor:o?"#6366f1":"#1e1e2e",border:o?"2px solid #6366f1":"2px solid #475569",cursor:"pointer",transition:"background-color 0.2s, border-color 0.2s"},children:e.jsx("span",{style:{position:"absolute",top:2,left:o?16:2,width:12,height:12,borderRadius:"50%",backgroundColor:o?"#fff":"#94a3b8",boxShadow:"0 1px 2px rgba(0,0,0,0.3)",transition:"left 0.2s"}})})]}),e.jsx("div",{className:"text-[10px] text-[#475569] mt-1 leading-tight",children:t.tradeoff})]})}function bn({objectives:t=[],scenarioDurationYears:o,year:n,scenarioName:i}){if(!t.length)return e.jsxs("div",{className:"text-[#334155] text-xs font-mono p-2 text-center",children:["No objectives in sandbox mode.",e.jsx("br",{}),e.jsx("span",{className:"text-[#475569]",children:"Pick a Historical Crisis for a timed challenge."})]});const a=o?Math.max(0,o-(n||0)):null,r=t.filter(l=>l.completed).length;return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-[#64748b] text-xs font-mono",children:[r,"/",t.length," objectives met"]}),a!==null&&e.jsxs("div",{className:`text-xs font-mono font-bold ${a<3?"text-[#ef4444]":"text-[#94a3b8]"}`,children:[a,"yr left"]})]}),o&&e.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-1",children:e.jsx("div",{className:"h-1 rounded-full transition-all duration-500 bg-[#6366f1]",style:{width:`${Math.min(100,(n||0)/o*100)}%`}})}),t.map(l=>{const c=l.completed?"#22c55e":l.met?"#f59e0b":"#ef4444",s=l.completed?"Complete":l.met?"Active‚Ä¶":"Not met";return e.jsxs("div",{className:"bg-[#12121a] border rounded-lg p-3",style:{borderColor:c+"44"},children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-mono text-[#e2e8f0]",children:[e.jsx("span",{children:l.icon}),e.jsx("span",{children:l.label})]}),e.jsx("span",{className:"text-[10px] font-mono flex-shrink-0",style:{color:c},children:s})]}),e.jsx("div",{className:"text-[10px] text-[#475569] mb-1.5",children:l.description}),e.jsx("div",{className:"w-full bg-[#0a0a0f] rounded-full h-1.5 mb-1",children:e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-500",style:{width:`${Math.round(l.progress*100)}%`,backgroundColor:c}})}),l.met&&!l.completed&&l.sustainProgress>0&&e.jsxs("div",{className:"text-[9px] text-[#475569] font-mono",children:["Sustaining: ",Math.round(l.sustainProgress*100),"%"]}),!l.completed&&e.jsxs("div",{className:"text-[9px] text-[#334155] mt-1 leading-tight italic",children:["üí° ",l.tip]})]},l.id)})]})}const yn={economy:["interestRate","printMoney","helicopterMoney","exportSubsidies","foreignReserveIntervention","punitiveTargiffs"],fiscal:["incomeTax","corporateTax","wealthTax","capitalGainsTax","subsidiesFarming"],inequality:["minWage","ubi","unemploymentBenefit","openBorders","mandatoryProfitShare"],banking:["reserveRequirement","maxLoanToValue","depositInsurance","debtJubilee","priceControlFood","priceControlHousing","antiMonopoly"],public:["educationFunding","publicHealthcare","policeFunding","financialOversight","prisonReform"],weird:["fourDayWeek","robotTax","breadAndCircuses","landValueTax","banAdvertising","lotteryRedistribution","sumptuary","degrowth","algoCentralPlanning","universalBankAccount"],chaos:["maximumWage","wealthConfiscation","nationalizeIndustries","guaranteedJobs"]},vn=Object.fromEntries(mn.map(t=>[t.id,t])),It=["economy","fiscal","inequality","banking","public","weird","chaos"],We={economy:{title:"Economy",icon:"üìä",color:"#6366f1"},fiscal:{title:"Fiscal",icon:"üí∞",color:"#3b82f6"},inequality:{title:"Social",icon:"‚öñÔ∏è",color:"#ec4899"},banking:{title:"Finance",icon:"üè¶",color:"#f97316"},public:{title:"Gov",icon:"üèõÔ∏è",color:"#06b6d4"},weird:{title:"Labs",icon:"üß™",color:"#f97316"},chaos:{title:"Chaos",icon:"üî•",color:"#b91c1c"}},wn={economy:{always:!0},fiscal:{always:!0},inequality:{year:2,metric:"gini",threshold:.3,op:"gte"},banking:{year:3,event:"bank"},public:{year:2,metric:"crimeRate",threshold:.1,op:"gte"},weird:{year:5,scoreThreshold:50},chaos:{year:8,achievement:!0}};function q({label:t,value:o,unit:n="",trend:i,color:a="#6366f1",history:r=[],format:l="number"}){const c=u.useMemo(()=>l==="percent"?(o*100).toFixed(1)+"%":l==="currency"?"$"+bt(o):l==="index"?o.toFixed(1):bt(o),[o,l]),s=r.slice(-40).map((d,p)=>({i:p,v:d}));return e.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-lg p-2.5 flex flex-col gap-1",children:[e.jsx("div",{className:"text-[#64748b] text-[10px] uppercase tracking-wider font-mono",children:t}),e.jsxs("div",{className:"flex items-end gap-1.5",children:[e.jsx("span",{className:"text-white text-base font-bold font-mono leading-none",style:{color:a},children:c}),n&&e.jsx("span",{className:"text-[#64748b] text-[10px] mb-0.5",children:n}),i!==void 0&&e.jsxs("span",{className:`text-[10px] mb-0.5 ${i>=0?"text-green-400":"text-red-400"}`,children:[i>=0?"‚Üë":"‚Üì"," ",Math.abs(i*100).toFixed(1),"%"]})]}),s.length>5&&e.jsx("div",{className:"h-6 w-full",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsx(we,{data:s,margin:{top:0,right:0,bottom:0,left:0},children:e.jsx(ke,{type:"monotone",dataKey:"v",stroke:a,fill:a+"22",strokeWidth:1,dot:!1,isAnimationActive:!1})})})})]})}function kn({prices:t,supply:o,demand:n}){return e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:Object.entries(t||{}).map(([i,a])=>{const r=(o==null?void 0:o[i])||0,l=(n==null?void 0:n[i])||0,c=l>r?"text-red-400":"text-green-400",s=l>r?"‚Üë":"‚Üì";return e.jsxs("div",{className:"flex justify-between items-center text-xs bg-[#12121a] border border-[#1e1e2e] rounded px-2 py-1",children:[e.jsx("span",{style:{color:hn[i]},className:"font-mono capitalize",children:i}),e.jsxs("span",{className:`font-mono font-bold ${c}`,children:["$",a.toFixed(1)," ",s]})]},i)})})}function jn({value:t}){const o=(t*100).toFixed(1),n=t>.5?"#ef4444":t>.35?"#f59e0b":"#22c55e";return e.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-lg p-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-[#64748b] text-[10px] uppercase tracking-wider font-mono",children:"Gini"}),e.jsx("span",{className:"text-xs font-bold font-mono",style:{color:n},children:o})]}),e.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-1.5",children:e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-500",style:{width:`${Math.min(100,t*100)}%`,backgroundColor:n}})})]})}function Nn({event:t}){return e.jsxs("div",{className:"bg-[#1e1e2e] border border-[#334155] rounded px-2 py-0.5 text-[10px] flex items-center gap-1",children:[e.jsx("span",{children:t.icon}),e.jsx("span",{className:"text-[#e2e8f0] font-mono",children:t.name})]})}function Cn({policyIds:t,policies:o,onPolicyChange:n,policyLag:i,highlightPolicy:a}){return e.jsx("div",{className:"flex flex-col gap-2.5 mt-1.5 bg-[#0d0d14] rounded-lg p-2.5 border border-[#1a1a28]",children:t.map(r=>{const l=vn[r];if(!l)return null;const c=i==null?void 0:i[r],s=c?c.progress:void 0,d=c?c.target:void 0,p=a===r;return e.jsx("div",{children:l.type==="slider"?e.jsx(gn,{policy:l,value:(o==null?void 0:o[r])??l.min??0,onChange:n,lagProgress:s,lagTarget:d,highlighted:p}):e.jsx(xn,{policy:l,value:(o==null?void 0:o[r])??!1,onChange:n,highlighted:p})},r)})})}function Tn({section:t,metrics:o,market:n,policies:i,onPolicyChange:a,policyLag:r,highlightPolicy:l}){const c=(o==null?void 0:o.history)||{},s=yn[t]||[],d=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-[9px] text-[#475569] font-mono uppercase tracking-wider mt-2 mb-0.5 px-1",children:["Policy Levers (",s.length,")"]}),e.jsx(Cn,{policyIds:s,policies:i,onPolicyChange:a,policyLag:r,highlightPolicy:l})]});switch(t){case"economy":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(q,{label:"GDP",value:o.gdp,format:"currency",trend:o.gdpGrowth,color:"#6366f1",history:c.gdp||[]}),e.jsx(q,{label:"Unemployment",value:o.unemployment,format:"percent",color:o.unemployment>.15?"#ef4444":"#22c55e",history:c.unemployment||[]}),e.jsx(q,{label:"CPI",value:o.cpi,format:"index",color:o.cpi>120?"#f97316":"#e2e8f0",history:c.cpi||[]}),e.jsx(q,{label:"Avg Wage",value:o.avgWage,format:"currency",color:"#06b6d4"})]}),d()]});case"fiscal":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(q,{label:"Gov Debt",value:Math.abs(o.govDebt||0),format:"currency",color:(o.govDebt||0)>1e3?"#ef4444":"#64748b"}),e.jsx(q,{label:"Tax Revenue",value:o.taxRevenue||0,format:"currency",color:"#3b82f6"})]}),d()]});case"inequality":return e.jsxs(e.Fragment,{children:[e.jsx(jn,{value:o.gini}),e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(q,{label:"Poverty",value:o.povertyRate,format:"percent",color:o.povertyRate>.25?"#ef4444":"#94a3b8"}),e.jsx(q,{label:"Unrest",value:o.socialUnrest,format:"percent",color:o.socialUnrest>.5?"#ef4444":"#94a3b8",history:c.unrest||[]})]}),d()]});case"banking":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(q,{label:"Private Debt",value:o.totalPrivateDebt||0,format:"currency",color:"#f97316",history:c.privateDebt||[]}),e.jsx(q,{label:"Credit Score",value:o.avgCreditScore||500,color:o.avgCreditScore>650?"#22c55e":o.avgCreditScore>500?"#f59e0b":"#ef4444",history:c.creditScore||[]})]}),e.jsx(kn,{prices:n==null?void 0:n.prices,supply:n==null?void 0:n.supply,demand:n==null?void 0:n.demand}),d()]});case"public":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-1.5",children:[e.jsx(q,{label:"Businesses",value:o.businessCount,color:"#f59e0b"}),e.jsx(q,{label:"Crime Rate",value:o.crimeRate||0,unit:"per 1K",color:(o.crimeRate||0)>.3?"#ef4444":"#94a3b8",history:c.crime||[]})]}),d()]});case"weird":case"chaos":return d();default:return null}}const xt={danger:{bg:"#ef444415",border:"#ef444433",text:"#fca5a5"},warning:{bg:"#f59e0b15",border:"#f59e0b33",text:"#fcd34d"},good:{bg:"#22c55e15",border:"#22c55e33",text:"#86efac"},info:{bg:"#6366f115",border:"#6366f133",text:"#a5b4fc"}};function Sn({events:t,currentTick:o}){const n=[],i=new Set;for(let a=t.length-1;a>=0;a--){const r=t[a].text;i.has(r)||(i.add(r),n.push(t[a]))}return e.jsxs("div",{className:"bg-[#0d0d14] border border-[#1a1a28] rounded-lg p-2",children:[e.jsx("div",{className:"text-[9px] text-[#475569] font-mono uppercase tracking-wider mb-1",children:"Economic Events"}),e.jsx("div",{className:"flex flex-col gap-1",children:n.map((a,r)=>{const l=xt[a.severity]||xt.info,c=o-a.tick,s=c<52?`${c}w ago`:`${Math.floor(c/52)}y ago`;return e.jsxs("div",{className:"flex items-center gap-1.5 text-[10px] font-mono rounded px-1.5 py-0.5",style:{backgroundColor:l.bg,border:`1px solid ${l.border}`},children:[e.jsx("span",{children:a.icon}),e.jsx("span",{style:{color:l.text},className:"flex-1",children:a.text}),e.jsx("span",{className:"text-[#475569] flex-shrink-0",children:s})]},`${a.tick}-${r}`)})})]})}function Rn({tutorialLesson:t,tutorialLessonIndex:o,tutorialTotal:n,tutorialComplete:i,completedLessons:a,onTutorialNext:r,onTutorialSkip:l}){return e.jsxs("div",{className:"bg-[#161625] border border-[#6366f1] rounded-lg p-3 mb-2",style:{boxShadow:"0 0 20px #6366f133"},children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[Array.from({length:n},(c,s)=>{const d=a.includes(s),p=s===o;return e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-300",style:{width:p?16:8,backgroundColor:p?i?"#22c55e":"#6366f1":d?"#22c55e":"#334155"}},s)}),e.jsx("div",{className:"flex-1"}),e.jsxs("span",{className:"text-[10px] text-[#475569] font-mono",children:[a.length,"/",n," complete"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsx("span",{className:"text-sm font-bold text-white",children:t.title})]}),e.jsx("div",{className:"text-xs text-[#ef4444] bg-[#ef444411] rounded px-2 py-1.5 mb-2 leading-relaxed",children:t.problem}),e.jsx("div",{className:"text-xs text-[#6366f1] bg-[#6366f111] rounded px-2 py-1.5 mb-3 leading-relaxed font-mono",children:t.instruction}),i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-xs text-[#22c55e] bg-[#22c55e11] rounded px-2 py-1.5 mb-3 leading-relaxed",children:t.successMessage}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:l,className:"text-[10px] text-[#475569] hover:text-[#94a3b8] font-mono px-2 py-1",children:"Exit Tutorial"}),e.jsx("button",{onClick:r,className:"text-[10px] text-white font-mono px-3 py-1.5 rounded bg-[#22c55e] hover:bg-[#16a34a] transition-colors font-bold",children:o===n-1?"Finish Tutorial":"Next Lesson ‚Üí"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-[10px] text-[#475569] font-mono flex items-center gap-1",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full bg-[#f59e0b] animate-pulse"}),"Waiting for correct adjustment..."]}),e.jsx("div",{className:"flex-1"}),e.jsx("button",{onClick:l,className:"text-[10px] text-[#475569] hover:text-[#94a3b8] font-mono px-2 py-1",children:"Skip Tutorial"})]})]})}function Mn({metrics:t,market:o,activeEvents:n=[],approvalRating:i=50,policyLag:a={},policies:r,onPolicyChange:l,econFeed:c=[],agents:s,objectives:d,scenarioDurationYears:p,year:g,scenarioName:h,score:y=0,scoreHistory:M=[],achievements:S=[],milestoneProgress:de=0,totalMilestones:_=10,currentMilestone:A=null,tutorialLesson:w=null,tutorialLessonIndex:E=-1,tutorialTotal:k=0,tutorialComplete:D=!1,completedLessons:X=[],onTutorialNext:ie=null,onTutorialSkip:ae=null,activeSection:F="economy",onSectionChange:$,unlockedSections:re=new Set(["economy","fiscal"])}){const v=u.useRef(null);if(u.useEffect(()=>{w!=null&&w.section&&$&&$(w.section)},[w,$]),!t)return e.jsx("div",{className:"text-[#475569] text-sm font-mono p-4",children:"Loading..."});const Q=Object.keys(a).length,ee=(d==null?void 0:d.length)>0;return e.jsx("div",{ref:v,className:"flex flex-col h-full",children:e.jsxs("div",{className:"flex flex-col gap-2 p-3 overflow-y-auto flex-1",children:[w&&e.jsx(Rn,{tutorialLesson:w,tutorialLessonIndex:E,tutorialTotal:k,tutorialComplete:D,completedLessons:X,onTutorialNext:ie,onTutorialSkip:ae}),e.jsxs("div",{className:"text-[#475569] text-[10px] font-mono px-1 flex justify-between",children:[e.jsxs("span",{children:["Year ",t.year," ¬∑ Pop ",t.population]}),Q>0&&e.jsxs("span",{className:"text-amber-400",children:[Q," pending"]})]}),n.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:n.map(B=>e.jsx(Nn,{event:B},B.id))}),c.length>0&&e.jsx(Sn,{events:c,currentTick:t.tick}),e.jsx(Tn,{section:F,metrics:t,market:o,policies:r,onPolicyChange:l,policyLag:a,highlightPolicy:(w==null?void 0:w.section)===F?w.highlightPolicy:null}),ee&&e.jsx("div",{className:"border-t border-[#1e1e2e] pt-2",children:e.jsx(bn,{objectives:d,scenarioDurationYears:p,year:g,scenarioName:h})})]})})}function bt(t){return t==null||isNaN(t)?"0":Math.abs(t)>=1e6?(t/1e6).toFixed(1)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(1)+"K":Math.round(t).toString()}const Fn=[{label:"1√ó",value:1,title:"Leisurely ‚Äî watch the economy breathe"},{label:"2√ó",value:2,title:"Normal play"},{label:"5√ó",value:5,title:"Fast-forward"},{label:"10√ó",value:10,title:"Stress test"}];function In(t,o,n){if(!o)return"#475569";switch(t){case"economy":{const i=o.unemployment||0,a=o.gdpGrowth||0;return i>.2||a<-.1?"#ef4444":i>.1||a<0?"#f59e0b":"#22c55e"}case"fiscal":{const i=Math.abs(o.govDebt||0),a=o.gdp||1,r=i/a;return r>1.5?"#ef4444":r>.8?"#f59e0b":"#22c55e"}case"inequality":{const i=o.gini||0;return i>.5?"#ef4444":i>.35?"#f59e0b":"#22c55e"}case"banking":{const i=o.totalPrivateDebt||0,a=o.gdp||1;return i/a>2?"#ef4444":i/a>1?"#f59e0b":"#22c55e"}case"public":{const i=o.crimeRate||0;return i>.5?"#ef4444":i>.2?"#f59e0b":"#22c55e"}case"weird":case"chaos":return"#475569";default:return"#475569"}}function Pn({paused:t,speed:o,onPause:n,onResume:i,onReset:a,onSpeedChange:r,onScenarioOpen:l,onShockMe:c,scenarioName:s,year:d,score:p,achievementCount:g,narratorEnabled:h,narratorLoading:y,onNarratorToggle:M,llmStatus:S,llmProgress:de,llmReady:_,activeSection:A,onSectionChange:w,unlockedSections:E,metrics:k,approvalRating:D}){const[X,ie]=u.useState(!1),[ae,F]=u.useState(!1),$=u.useRef(null);u.useEffect(()=>{if(!ae)return;const v=Q=>{$.current&&!$.current.contains(Q.target)&&F(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[ae]);const re=()=>{navigator.clipboard&&(navigator.clipboard.writeText(window.location.href),ie(!0),setTimeout(()=>ie(!1),2e3)),F(!1)};return e.jsxs("header",{className:"flex items-center justify-between px-4 py-2 bg-[#0a0a0f] border-b border-[#1e1e2e] flex-wrap gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"üêæ"}),e.jsx("span",{className:"text-[#e2e8f0] font-bold font-mono text-sm hidden sm:block",children:"EconSim"})]}),e.jsxs("button",{onClick:l,className:"text-xs font-mono text-[#6366f1] hover:text-[#818cf8] border border-[#6366f133] hover:border-[#6366f166] rounded px-2 py-1 transition-colors",children:[s||"Free Market"," ","‚ñæ"]}),d!==void 0&&e.jsxs("span",{className:"text-[#475569] text-xs font-mono",children:["Year ",d]}),p!==void 0&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded border border-[#1e1e2e] bg-[#12121a]",children:[e.jsx("span",{className:"text-[10px] text-[#475569] font-mono",children:"SCORE"}),e.jsx("span",{className:`text-sm font-bold font-mono ${p>=70?"text-[#22c55e]":p>=40?"text-[#f59e0b]":"text-[#ef4444]"}`,children:p}),g>0&&e.jsxs("span",{className:"text-[10px] text-[#6366f1] font-mono",children:["üèÜ",g]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center gap-0.5 bg-[#12121a] border border-[#1e1e2e] rounded px-1",children:Fn.map(v=>e.jsx("button",{onClick:()=>r(v.value),title:v.title,className:`text-xs font-mono px-2 py-1 rounded transition-colors ${o===v.value?"bg-[#6366f1] text-white":"text-[#64748b] hover:text-[#e2e8f0]"}`,children:v.label},v.value))}),e.jsx("button",{onClick:t?i:n,className:`flex items-center gap-1 text-xs font-mono px-3 py-1.5 rounded border transition-colors
            border-[#1e1e2e] text-[#e2e8f0] hover:border-[#6366f1] hover:text-[#6366f1]`,children:t?"‚ñ∂ Play":"‚è∏ Pause"}),e.jsx("button",{onClick:c,className:`text-xs font-mono px-3 py-1.5 rounded border border-[#f59e0b33] text-[#f59e0b]
            hover:bg-[#f59e0b11] transition-colors`,title:"Trigger a random economic event",children:"‚ö° Shock"}),e.jsxs("div",{className:"relative",ref:$,children:[e.jsx("button",{onClick:()=>F(v=>!v),className:`text-xs font-mono px-2 py-1.5 rounded border border-[#1e1e2e] text-[#64748b]
              hover:border-[#6366f1] hover:text-[#94a3b8] transition-colors`,title:"More options",children:"‚ãØ"}),ae&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-[#12121a] border border-[#1e1e2e] rounded-lg shadow-xl z-50 min-w-[160px] py-1",children:[e.jsx("button",{onClick:()=>{a(),F(!1)},className:"w-full text-left text-xs font-mono px-3 py-2 text-[#64748b] hover:text-[#ef4444] hover:bg-[#ef444411] transition-colors",children:"‚Ü∫ Reset"}),e.jsx("button",{onClick:re,className:"w-full text-left text-xs font-mono px-3 py-2 text-[#64748b] hover:text-[#22c55e] hover:bg-[#22c55e11] transition-colors",children:X?"‚úì Copied!":"üîó Share"}),e.jsx("button",{onClick:()=>{M(),F(!1)},disabled:y,className:`w-full text-left text-xs font-mono px-3 py-2 transition-colors ${h?"text-[#06b6d4] hover:bg-[#06b6d411]":"text-[#475569] hover:text-[#06b6d4] hover:bg-[#06b6d411]"} ${y?"opacity-50 cursor-wait":""}`,children:y&&S!=="loading"?"‚è≥ Loading‚Ä¶":S==="loading"?`üß† AI ${de}%`:h&&_?"üîä AI Narrator":h?"üîä Voice":"üîá Voice Off"})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-0.5 w-full pt-1 px-2",children:It.map(v=>{const Q=We[v],ee=A===v,B=!(E!=null&&E.has(v)),Ue=In(v,k);return e.jsxs("button",{onClick:()=>!B&&(w==null?void 0:w(v)),disabled:B,className:`flex items-center gap-1 px-2 py-1 rounded text-[10px] font-mono font-bold transition-all ${ee?"bg-[#1e1e2e] text-white":B?"text-[#334155] cursor-not-allowed":"text-[#64748b] hover:text-[#94a3b8] hover:bg-[#0d0d14]"}`,style:ee?{boxShadow:`0 0 0 1px ${Q.color}`}:void 0,title:B?"Locked - keep playing to unlock":Q.title,children:[B?e.jsx("span",{className:"text-[#334155]",children:"üîí"}):e.jsx("span",{className:"w-1.5 h-1.5 rounded-full flex-shrink-0",style:{backgroundColor:Ue}}),e.jsx("span",{children:Q.icon}),e.jsx("span",{children:Q.title})]},v)})})]})}const oe=[{id:"story_ch1",number:1,title:"The Industrial Revolution",era:"1850 ‚Äì 1880",tagline:"Harness the power of industry ‚Äî without breaking the people who build it.",icon:"üè≠",color:"#f59e0b",durationYears:30,openingNarrative:`The year is 1850. Steam engines thunder. Factories rise where fields once stretched.

Your small nation stands at the threshold of the industrial age. Entrepreneurs are building mills and mines. Workers are flooding in from the countryside ‚Äî hungry, desperate, and ready to work for almost nothing.

You control the levers of power. How you shape this transformation will echo for generations.

Industrialise too fast and brutal inequality will tear your society apart. Go too slow and you'll fall behind competing nations. History rarely rewards caution ‚Äî but it punishes cruelty.

What kind of industrial nation will you build?`,kokoroNarration:"The year is 1850. Steam engines thunder. Factories rise where fields once stretched. Your nation stands at the threshold of the industrial age. Workers are flooding in from the countryside ‚Äî hungry, desperate, and ready to work for almost nothing. How you shape this transformation will echo for generations.",closingNarrative:{excellent:"Your industrial revolution was a model of managed progress. Workers were protected. Productivity soared. You proved that growth and dignity are not opposites. History will remember this era as a turning point for human welfare.",good:"Your industrial revolution delivered real growth ‚Äî but left scars. Inequality rose faster than wages. Some workers lived better; many did not. The foundations you built are strong, but the cracks will show in time.",poor:"The factories ran. The profits flowed ‚Äî to the few. Workers labored in brutal conditions, children among them. You fed the machine of progress with human suffering. The resentment has only begun to fester."},scenarioConfig:{agentCount:150,businessCount:12,wealthMultiplier:.8,wealthInequality:1.2,avgSkill:.35,policies:{incomeTax:.05,corporateTax:.05,minWage:0,ubi:0,interestRate:.08,antiMonopoly:!1,educationFunding:.1,unemploymentBenefit:0,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!0}},scheduledEvents:[{atTick:100,type:"techBreakthrough"},{atTick:350,type:"generalStrike"},{atTick:600,type:"immigrationWave"}],objectives:[{id:"industrialize",label:"Industrialise",icon:"‚öôÔ∏è",description:"Grow GDP to 3√ó starting value",metric:"gdp",operator:"gt_initial",threshold:3,sustainTicks:0,weight:.3,tip:"Reduce interest rates to encourage business investment"},{id:"contain_inequality",label:"Contain Inequality",icon:"‚öñÔ∏è",description:"Keep Gini coefficient below 0.65",metric:"gini",operator:"lt",threshold:.65,sustainTicks:52,weight:.35,tip:"Education funding and minimum wage slow inequality accumulation"},{id:"prevent_unrest",label:"Prevent Revolution",icon:"üî•",description:"Keep social unrest below 60%",metric:"socialUnrest",operator:"lt",threshold:.6,sustainTicks:52,weight:.35,tip:"Workers strike when inequality is extreme. Early labour protections help."}]},{id:"story_ch2",number:2,title:"The Great Depression",era:"1929 ‚Äì 1939",tagline:"The bubble has burst. The banks are failing. Can you stop the collapse?",icon:"üìâ",color:"#ef4444",durationYears:10,openingNarrative:`October 1929. The stock market has just crashed. Overnight, millions lost their savings.

Banks are failing. Factories are shutting. Unemployment lines stretch around the block. The industrial prosperity you inherited now threatens to become the greatest catastrophe in economic history.

Herbert Hoover is doing nothing. The markets will correct themselves, they say. They have not corrected. They are freefall.

You have a decade to stop the collapse, prevent total social breakdown, and set the stage for recovery. Every decision will be second-guessed by historians for the next hundred years.

What do you do?`,kokoroNarration:"October 1929. The stock market has just crashed. Banks are failing. Factories are shutting. Unemployment lines stretch around the block. You have one decade to stop the collapse. Every decision you make will be second-guessed by historians for the next hundred years.",closingNarrative:{excellent:"You navigated the Depression better than history did. The New Deal worked ‚Äî or something like it. Workers were put back to work, banks were stabilised, and the social contract held. Future generations will look back at this as the moment government proved its worth.",good:"Recovery came, but slowly and unevenly. Unemployment fell but never fully resolved. You avoided total collapse ‚Äî which is more than Hoover managed. The scars remain, but the patient survived.",poor:"The Depression deepened on your watch. Unemployment exceeded 30%. Hunger marches turned violent. The social fabric frayed. You've created the conditions for something dangerous to fill the vacuum."},scenarioConfig:{agentCount:200,businessCount:25,wealthMultiplier:1.5,wealthInequality:2.5,avgSkill:.45,startingGovDebt:2e3,policies:{incomeTax:.25,corporateTax:.15,minWage:0,ubi:0,interestRate:.06,antiMonopoly:!1,educationFunding:.2,unemploymentBenefit:0,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1}},scheduledEvents:[{atTick:10,type:"financialBubble"},{atTick:80,type:"bankRun"},{atTick:200,type:"recession"},{atTick:350,type:"cropFailure"}],objectives:[{id:"employment",label:"Reduce Unemployment",icon:"üë∑",description:"Get unemployment below 15%",metric:"unemployment",operator:"lt",threshold:.15,sustainTicks:104,weight:.4,tip:"Stimulus spending, guaranteed jobs, or UBI can absorb the unemployed"},{id:"no_collapse",label:"Prevent Social Collapse",icon:"üèõÔ∏è",description:"Keep social unrest below 70%",metric:"socialUnrest",operator:"lt",threshold:.7,sustainTicks:0,weight:.35,tip:"Hungry, unemployed people revolt. Food aid and benefits are not luxuries here."},{id:"gdp_recovery",label:"Stabilise GDP",icon:"üìà",description:"Stop GDP from falling below 50% of starting value",metric:"gdp",operator:"gt_initial",threshold:.5,sustainTicks:52,weight:.25,tip:"Austerity deepens depressions. Keynes said so. Try stimulus."}]},{id:"story_ch3",number:3,title:"The Golden Age",era:"1950 ‚Äì 1975",tagline:"Postwar prosperity. Build the welfare state ‚Äî before stagflation ends it.",icon:"‚ú®",color:"#22c55e",durationYears:25,openingNarrative:`The war is over. Soldiers have come home. Baby carriages fill the streets.

The economy is booming. Factories, infrastructure, education ‚Äî everything needs to be built. There is broad political consensus that government should provide education, healthcare, and a safety net. This is your window.

But the prosperity won't last forever. By the mid-1970s, oil shocks will trigger stagflation ‚Äî high inflation and high unemployment at the same time, the nightmare scenario that breaks every economic model.

Your task: build a welfare state that is both generous and resilient enough to survive when the oil runs out.`,kokoroNarration:"The war is over. Soldiers have come home. The economy is booming. This is your window to build the welfare state. But the prosperity won't last forever. By the mid-seventies, oil shocks will trigger stagflation ‚Äî the nightmare scenario that breaks every economic model. Build something resilient.",closingNarrative:{excellent:"You built the most successful welfare state in history. Education, healthcare, housing ‚Äî all delivered. When stagflation hit, your economy had the resilience to absorb the shock. This will be remembered as the Golden Age it promised to be.",good:"You built a reasonable welfare state and survived stagflation with manageable damage. Not Sweden, but not collapse either. The middle class is large. Inequality is moderate. The foundations are solid.",poor:"The Golden Age became the Age of Stagflation on your watch. Inflation spiralled, unemployment spiked, and the welfare programs you couldn't afford to maintain were cut. The social contract is fraying."},scenarioConfig:{agentCount:220,businessCount:28,wealthMultiplier:1.2,wealthInequality:1.3,avgSkill:.55,policies:{incomeTax:.35,corporateTax:.28,minWage:8,ubi:0,interestRate:.04,antiMonopoly:!0,educationFunding:.5,unemploymentBenefit:80,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!0,wealthTax:0,openBorders:!1,subsidiesFarming:!0}},scheduledEvents:[{atTick:50,type:"boom"},{atTick:200,type:"techBreakthrough"},{atTick:600,type:"recession"},{atTick:750,type:"hyperinflation"}],objectives:[{id:"welfare",label:"Build Welfare State",icon:"üè•",description:"Keep poverty rate below 15%",metric:"povertyRate",operator:"lt",threshold:.15,sustainTicks:104,weight:.35,tip:"Healthcare, education, unemployment benefits ‚Äî all reduce poverty"},{id:"growth",label:"Sustained Growth",icon:"üìà",description:"Maintain positive GDP growth for 5 years",metric:"gdpGrowth",operator:"gt",threshold:0,sustainTicks:260,weight:.35,tip:"The postwar boom is yours to manage. Don't break it."},{id:"survive_stagflation",label:"Survive Stagflation",icon:"üõ°Ô∏è",description:"Keep inflation below 15% when it hits",metric:"inflation",operator:"lt",threshold:15,sustainTicks:52,weight:.3,tip:"Tight monetary policy can fight inflation ‚Äî but it triggers recession"}]},{id:"story_ch4",number:4,title:"The Neoliberal Turn",era:"1980 ‚Äì 2000",tagline:"Deregulate everything. But who gets left behind?",icon:"ü¶Å",color:"#8b5cf6",durationYears:20,openingNarrative:`Reagan is in the White House. Thatcher is at 10 Downing Street. The message is clear: government is the problem. Markets are the solution.

Inflation has been crushed ‚Äî but at the cost of brutal unemployment. The industrial heartland is hollowing out. Financialisation is replacing manufacturing. Inequality is rising faster than at any time since the Gilded Age.

The tech revolution is beginning. This could be a tremendous era of growth ‚Äî or the beginning of a 40-year inequality explosion.

The choice is yours. Deregulate and grow fast, or manage the transition and protect those left behind?`,kokoroNarration:"Reagan is in the White House. Thatcher is at Downing Street. The message is clear ‚Äî government is the problem. Markets are the solution. Inflation has been crushed. The tech revolution is beginning. This could be tremendous growth ‚Äî or the beginning of a 40-year inequality explosion. The choice is yours.",closingNarrative:{excellent:"You managed the neoliberal era with rare wisdom ‚Äî capturing the growth benefits of deregulation while protecting workers from its worst effects. Inequality rose modestly. The middle class survived. The tech revolution was distributed, not just captured by the elite.",good:"Growth was real. So was the inequality. The 1990s produced genuine prosperity for many, but the gap between the top and bottom widened considerably. The seeds of future discontent were planted, but the economy is functional.",poor:"Trickle-down didn't trickle. Deregulation unleashed a financial sector that captured all the gains. Workers who lost manufacturing jobs never found equivalent work. The economy is a casino ‚Äî and the house always wins."},scenarioConfig:{agentCount:240,businessCount:30,wealthMultiplier:1.4,wealthInequality:1.8,avgSkill:.5,policies:{incomeTax:.28,corporateTax:.35,minWage:5,ubi:0,interestRate:.15,antiMonopoly:!1,educationFunding:.3,unemploymentBenefit:60,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!0,subsidiesFarming:!1}},scheduledEvents:[{atTick:80,type:"techBreakthrough"},{atTick:250,type:"financialBubble"},{atTick:400,type:"brainDrain"},{atTick:600,type:"boom"}],objectives:[{id:"growth_neo",label:"Deliver Growth",icon:"üìà",description:"Grow GDP to 2√ó starting value",metric:"gdp",operator:"gt_initial",threshold:2,sustainTicks:0,weight:.3,tip:"Low rates and deregulation stimulate growth ‚Äî short-term"},{id:"inequality_neo",label:"Contain Inequality",icon:"‚öñÔ∏è",description:"Keep Gini below 0.55",metric:"gini",operator:"lt",threshold:.55,sustainTicks:104,weight:.4,tip:"The hardest challenge of this era. Redistribution fights against market forces."},{id:"employment_neo",label:"Full Employment",icon:"üë∑",description:"Keep unemployment below 8%",metric:"unemployment",operator:"lt",threshold:.08,sustainTicks:104,weight:.3,tip:"Technology displaces workers. Education and retraining are your best tools."}]},{id:"story_ch5",number:5,title:"The Age of Crises",era:"2008 ‚Äì Now",tagline:"Financial crash. Pandemic. Inequality explosion. Can you hold it together?",icon:"üåç",color:"#6366f1",durationYears:20,openingNarrative:`September 2008. Lehman Brothers has just filed for bankruptcy. The global financial system is in cardiac arrest.

Everything you built over the previous decades is now being tested. The debt is enormous. The inequality is extreme. The financial sector is insolvent. And in a decade, a pandemic will arrive that shuts down the entire world economy.

This is the final chapter. The cumulative weight of every previous decision ‚Äî industrial exploitation, Depression policy, welfare choices, neoliberal inequality ‚Äî comes due now.

Can you hold civilisation together? Or will this be where it finally breaks?`,kokoroNarration:"September 2008. Lehman Brothers has just filed for bankruptcy. The global financial system is in cardiac arrest. Everything you built over decades is being tested. And in a decade, a pandemic will arrive. This is the final chapter. Can you hold it together?",closingNarrative:{excellent:"Against extraordinary odds, you navigated the Age of Crises. The 2008 crash was contained. The pandemic was managed. Inequality, while still high, was brought back to manageable levels. This is what competent governance looks like in the hardest times.",good:"The crises were severe but not fatal. Recovery was slow and uneven. The wealthy recovered faster than the workers ‚Äî as always. But the system held. Democracy survived. This is the realistic best-case outcome.",poor:"The crises broke what the previous decades had strained. Unemployment, inequality, social unrest ‚Äî all reached historic highs. The social contract you inherited lies in ruins. Whatever comes next won't look like what came before."},scenarioConfig:{agentCount:250,businessCount:35,wealthMultiplier:2,wealthInequality:3,avgSkill:.6,startingGovDebt:3500,policies:{incomeTax:.3,corporateTax:.25,minWage:10,ubi:0,interestRate:.05,antiMonopoly:!1,educationFunding:.4,unemploymentBenefit:100,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1}},scheduledEvents:[{atTick:10,type:"financialBubble"},{atTick:100,type:"bankRun"},{atTick:250,type:"recession"},{atTick:500,type:"pandemic"},{atTick:650,type:"hyperinflation"}],objectives:[{id:"survive_crash",label:"Survive the Crash",icon:"üè¶",description:"Keep GDP above 60% of starting value",metric:"gdp",operator:"gt_initial",threshold:.6,sustainTicks:52,weight:.3,tip:"Stimulus, QE, and deposit guarantees are your tools for the crash"},{id:"inequality_final",label:"Reduce Inequality",icon:"‚öñÔ∏è",description:"Bring Gini below 0.5",metric:"gini",operator:"lt",threshold:.5,sustainTicks:104,weight:.35,tip:"This is the defining challenge of the 21st century. Wealth taxes, UBI, education."},{id:"stability_final",label:"Social Stability",icon:"üïäÔ∏è",description:"Keep social unrest below 50%",metric:"socialUnrest",operator:"lt",threshold:.5,sustainTicks:52,weight:.35,tip:"People who have nothing to lose are dangerous. Safety nets buy stability."}]}];function _n(t=[]){if(!t.length)return 50;const o=t.reduce((i,a)=>i+(a.weight||1),0),n=t.reduce((i,a)=>i+(a.completed?a.weight||1:0),0);return Math.round(n/o*100)}function Pt(t){return t>=85?{grade:"S",label:"Excellent",color:"#f59e0b"}:t>=65?{grade:"A",label:"Good",color:"#22c55e"}:t>=40?{grade:"B",label:"Adequate",color:"#6366f1"}:t>=20?{grade:"C",label:"Poor",color:"#f97316"}:{grade:"F",label:"Failed",color:"#ef4444"}}function An(t){return t>=65?"excellent":t>=35?"good":"poor"}const _t=[{id:"usa",name:"United States",flag:"üá∫üá∏",desc:"Mixed economy. Moderate taxes, limited safety net, strong private sector.",policies:{incomeTax:.25,corporateTax:.21,capitalGainsTax:.15,minWage:7,ubi:0,interestRate:.05,educationFunding:.3,unemploymentBenefit:50,publicHealthcare:!1,wealthTax:0,policeFunding:.5,financialOversight:.3,reserveRequirement:.1,depositInsurance:!0,maxLoanToValue:.8,antiMonopoly:!1,subsidiesFarming:!0,openBorders:!1}},{id:"nordic",name:"Nordic Model",flag:"üá∏üá™",desc:"High taxes, universal services, strong unions, open markets.",policies:{incomeTax:.45,corporateTax:.22,capitalGainsTax:.3,minWage:18,ubi:0,interestRate:.03,educationFunding:.9,unemploymentBenefit:200,publicHealthcare:!0,wealthTax:.01,policeFunding:.4,financialOversight:.5,reserveRequirement:.1,depositInsurance:!0,maxLoanToValue:.85,antiMonopoly:!0,subsidiesFarming:!0,openBorders:!0,mandatoryProfitShare:.1}},{id:"singapore",name:"Singapore",flag:"üá∏üá¨",desc:"Low taxes, minimal welfare, pro-business, strong regulation.",policies:{incomeTax:.15,corporateTax:.17,capitalGainsTax:0,minWage:0,ubi:0,interestRate:.03,educationFunding:.7,unemploymentBenefit:0,publicHealthcare:!0,wealthTax:0,policeFunding:.6,financialOversight:.7,reserveRequirement:.1,depositInsurance:!0,maxLoanToValue:.75,antiMonopoly:!0,subsidiesFarming:!1,openBorders:!0}},{id:"eu",name:"European Union",flag:"üá™üá∫",desc:"Social market economy. Strong labor protections, moderate taxes.",policies:{incomeTax:.35,corporateTax:.25,capitalGainsTax:.25,minWage:12,ubi:0,interestRate:.04,educationFunding:.6,unemploymentBenefit:120,publicHealthcare:!0,wealthTax:0,policeFunding:.4,financialOversight:.4,reserveRequirement:.08,depositInsurance:!0,maxLoanToValue:.8,antiMonopoly:!0,subsidiesFarming:!0,openBorders:!0,fourDayWeek:!1}},{id:"libertarian",name:"Libertarian",flag:"üóΩ",desc:"Minimal government. No income tax, no welfare, gold-standard banking.",policies:{incomeTax:0,corporateTax:0,capitalGainsTax:0,minWage:0,ubi:0,interestRate:.02,educationFunding:0,unemploymentBenefit:0,publicHealthcare:!1,wealthTax:0,policeFunding:.2,financialOversight:0,reserveRequirement:.3,depositInsurance:!1,maxLoanToValue:.6,antiMonopoly:!1,subsidiesFarming:!1,openBorders:!0}}],Se={default:{id:"default",name:"Balanced Start",subtitle:"US-inspired defaults. Tweak as you go.",description:"A mixed economy with moderate taxes, basic safety nets, and room to experiment. Good starting point for learning.",icon:"‚öñÔ∏è",difficulty:"Easy",color:"#6366f1",isHistorical:!1,policies:{},agentCount:200,businessCount:20,wealthMultiplier:1,wealthInequality:1,avgSkill:.5,lesson:"Every policy has tradeoffs. Start here and learn what each lever does."},freeMarket:{id:"freeMarket",name:"Free Market Utopia",subtitle:"No rules. Pure capitalism.",description:"Zero regulation. No minimum wage, no taxes, no safety net. Watch monopolies form naturally and see who wins ‚Äî and who gets left behind.",icon:"ü¶Ö",difficulty:"Observe",color:"#3b82f6",isHistorical:!1,policies:{incomeTax:0,corporateTax:0,minWage:0,ubi:0,interestRate:.02,antiMonopoly:!1,educationFunding:0,unemploymentBenefit:0,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:20,wealthMultiplier:1.2,wealthInequality:1.5,avgSkill:.5,lesson:"Natural monopolies emerge quickly. The rich get richer. But GDP grows fast at first."},debtSpiral:{id:"debtSpiral",name:"The Debt Spiral",subtitle:"Borrowed too much. Now what?",description:"The government spent heavily on social programs. Debt is high, deficit is growing. Austerity or default ‚Äî pick your poison.",icon:"üí∏",difficulty:"Hard",color:"#ef4444",isHistorical:!1,policies:{incomeTax:.45,corporateTax:.35,minWage:15,ubi:200,interestRate:.12,antiMonopoly:!0,educationFunding:.8,unemploymentBenefit:150,priceControlFood:!1,priceControlHousing:!1,printMoney:5,publicHealthcare:!0,wealthTax:.02,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:18,wealthMultiplier:.8,wealthInequality:.8,avgSkill:.55,startGovDebt:5e3,lesson:"Cutting programs causes pain now. Keeping them causes pain later. The political economy of austerity."},techDisruption:{id:"techDisruption",name:"Tech Disruption",subtitle:"Automation is coming for jobs.",description:"A stable, balanced economy. Then a tech breakthrough hits ‚Äî half the jobs can be automated. Will you adapt or collapse?",icon:"ü§ñ",difficulty:"Medium",color:"#8b5cf6",isHistorical:!1,policies:{incomeTax:.28,corporateTax:.21,minWage:12,ubi:0,interestRate:.05,antiMonopoly:!1,educationFunding:.5,unemploymentBenefit:80,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:20,wealthMultiplier:1,wealthInequality:1,avgSkill:.5,scheduledEvents:[{type:"techBreakthrough",atTick:200}],lesson:"Automation creates wealth but destroys jobs. UBI or retraining ‚Äî which policy saves more people?"},greatDepression:{id:"greatDepression",name:"The Great Depression",subtitle:"October 1929. The markets have collapsed.",description:'GDP has fallen 30%. Unemployment is climbing toward 25%. Banks are failing daily. Hoover says "be patient." Do you agree?',icon:"üìâ",difficulty:"Very Hard",color:"#78716c",isHistorical:!0,era:"1929‚Äì1939 ¬∑ United States",durationYears:15,policies:{incomeTax:.02,corporateTax:.12,minWage:0,ubi:0,interestRate:.06,antiMonopoly:!1,educationFunding:.1,unemploymentBenefit:0,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:12,wealthMultiplier:.35,wealthInequality:2,avgSkill:.4,scheduledEvents:[{type:"recession",atTick:1},{type:"financialBubble",atTick:80}],lesson:"Austerity deepened the Depression. FDR's New Deal proved government spending could restart demand."},weimarHyperinflation:{id:"weimarHyperinflation",name:"Weimar Hyperinflation",subtitle:"A loaf of bread costs a wheelbarrow of cash.",description:"Post-WWI Germany is printing money to pay reparations. Inflation is doubling daily. The middle class is being wiped out. Can you stabilize the currency before society collapses?",icon:"üíπ",difficulty:"Expert",color:"#dc2626",isHistorical:!0,era:"1921‚Äì1924 ¬∑ Germany",durationYears:10,policies:{incomeTax:.15,corporateTax:.1,minWage:0,ubi:0,interestRate:.01,antiMonopoly:!1,educationFunding:.2,unemploymentBenefit:0,priceControlFood:!0,priceControlHousing:!1,printMoney:40,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:180,businessCount:15,wealthMultiplier:.5,wealthInequality:1.8,avgSkill:.45,scheduledEvents:[],lesson:"Stopping hyperinflation requires cold turkey: halt money printing, issue new credible currency, accept short-term pain."},stagflation1970s:{id:"stagflation1970s",name:"1970s Stagflation",subtitle:"Inflation up. Unemployment up. Nothing works.",description:"OPEC's oil embargo just hit. Prices are surging but the economy is stagnating. Your standard policy tools are pointing in opposite directions. What do you do?",icon:"‚õΩ",difficulty:"Hard",color:"#d97706",isHistorical:!0,era:"1973‚Äì1982 ¬∑ United States",durationYears:12,policies:{incomeTax:.3,corporateTax:.48,minWage:8,ubi:0,interestRate:.06,antiMonopoly:!1,educationFunding:.4,unemploymentBenefit:100,priceControlFood:!1,priceControlHousing:!1,printMoney:8,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:18,wealthMultiplier:.85,wealthInequality:1.1,avgSkill:.5,scheduledEvents:[{type:"cropFailure",atTick:20},{type:"recession",atTick:150}],lesson:"Stagflation broke Keynesian consensus. Volcker's painful rate hikes eventually worked ‚Äî but cost millions their jobs."},crisisOf2008:{id:"crisisOf2008",name:"2008 Financial Crisis",subtitle:"Lehman just failed. The banks are frozen.",description:"The US housing bubble has burst. Banks are insolvent. Credit is frozen. The global economy is in freefall. Bail out the banks, let them fail, or something else?",icon:"üè¶",difficulty:"Hard",color:"#7c3aed",isHistorical:!0,era:"2008‚Äì2015 ¬∑ Global",durationYears:10,policies:{incomeTax:.28,corporateTax:.35,minWage:10,ubi:0,interestRate:.05,antiMonopoly:!1,educationFunding:.4,unemploymentBenefit:100,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:16,wealthMultiplier:.7,wealthInequality:1.6,avgSkill:.5,scheduledEvents:[{type:"financialBubble",atTick:1},{type:"recession",atTick:30}],lesson:"Bailouts prevented a depression but rewarded recklessness. The political consequences lasted a decade."},japanLostDecade:{id:"japanLostDecade",name:"Japan's Lost Decade",subtitle:"Zero rates. Zero growth. Zero inflation.",description:"Japan's asset bubble burst in 1991. Interest rates are near zero. Stimulus packages come and go. Nothing works. Can you escape the deflationary trap that trapped Japan for 20 years?",icon:"üóæ",difficulty:"Expert",color:"#0891b2",isHistorical:!0,era:"1991‚Äì2010 ¬∑ Japan",durationYears:15,policies:{incomeTax:.33,corporateTax:.38,minWage:6,ubi:0,interestRate:.005,antiMonopoly:!1,educationFunding:.6,unemploymentBenefit:80,priceControlFood:!1,priceControlHousing:!1,printMoney:2,publicHealthcare:!0,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:20,wealthMultiplier:.9,wealthInequality:.9,avgSkill:.65,scheduledEvents:[{type:"financialBubble",atTick:1},{type:"recession",atTick:10}],lesson:"Half-measures and zombie banks prolonged Japan's stagnation for 20 years. Swift, decisive action matters."},nordicMiracle:{id:"nordicMiracle",name:"Build the Nordic Model",subtitle:"High taxes. High trust. High happiness.",description:"You're building a new nation. Can you achieve the Nordic balance: low inequality, high productivity, strong safety net, and sustained growth? This is what success looks like.",icon:"üåç",difficulty:"Blueprint",color:"#059669",isHistorical:!0,era:"Reference Model ¬∑ Scandinavia",durationYears:20,policies:{incomeTax:.45,corporateTax:.25,minWage:18,ubi:0,interestRate:.03,antiMonopoly:!0,educationFunding:.9,unemploymentBenefit:200,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!0,wealthTax:.01,openBorders:!1,subsidiesFarming:!0},agentCount:200,businessCount:22,wealthMultiplier:1,wealthInequality:.7,avgSkill:.6,avgEducation:.65,scheduledEvents:[],lesson:"The Nordic model requires high institutional trust, universal services, AND open competitive markets. All three."}};for(const t of oe)Se[t.id]={id:t.id,name:t.title,subtitle:t.era,description:t.tagline,icon:t.icon,difficulty:`Chapter ${t.number}`,color:t.color,isHistorical:!1,isStory:!0,storyChapterNumber:t.number,durationYears:t.durationYears,era:t.era,lesson:t.tagline,scheduledEvents:t.scheduledEvents||[],...t.scenarioConfig,policies:t.scenarioConfig.policies};const it=Object.values(Se),En=it.filter(t=>!t.isHistorical&&!t.isStory),Dn=it.filter(t=>t.isHistorical);it.filter(t=>t.isStory);const W=[{id:"tut_inflation",title:"Inflation Crisis",icon:"üî•",problem:"Prices are out of control! The government has been printing money recklessly and CPI has skyrocketed past 150. Citizens can barely afford food. Your economy is melting down.",instruction:"Raise the Interest Rate above 10% to cool the economy. Watch CPI drop below 120.",section:"economy",highlightPolicy:"interestRate",scenarioConfig:{policies:{printMoney:40,interestRate:.01,incomeTax:.2,corporateTax:.15,minWage:8,ubi:0,educationFunding:.3,unemploymentBenefit:50,publicHealthcare:!1,wealthTax:0,policeFunding:.3,financialOversight:.2,reserveRequirement:.05,depositInsurance:!0,maxLoanToValue:.9,antiMonopoly:!1,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:20,wealthMultiplier:1,wealthInequality:1,avgSkill:.5},conditions:[{metric:"cpi",op:"lte",value:120}],successMessage:"Higher interest rates make borrowing expensive, which slows spending and cools inflation. This is exactly what central banks do in real life ‚Äî the Volcker shock of 1981 used 20% rates to break inflation."},{id:"tut_unemployment",title:"Mass Unemployment",icon:"üíº",problem:"The previous government raised interest rates too high and crushed the economy. Unemployment has soared past 30%. Businesses are closing. People are desperate for work.",instruction:"Lower the Interest Rate below 3% to stimulate borrowing and hiring. Get unemployment below 20%.",section:"economy",highlightPolicy:"interestRate",scenarioConfig:{policies:{printMoney:0,interestRate:.18,incomeTax:.35,corporateTax:.3,minWage:15,ubi:0,educationFunding:.3,unemploymentBenefit:30,publicHealthcare:!1,wealthTax:0,policeFunding:.3,financialOversight:.2,reserveRequirement:.15,depositInsurance:!0,maxLoanToValue:.7,antiMonopoly:!1,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:10,wealthMultiplier:.5,wealthInequality:1.5,avgSkill:.4},conditions:[{metric:"unemployment",op:"lte",value:.2}],successMessage:"Cheap borrowing lets businesses expand and hire. This is the classic Keynesian stimulus response ‚Äî lower rates to fight recession. But be careful: too low for too long and you risk inflation."},{id:"tut_debt",title:"Government Debt Spiral",icon:"üí∏",problem:"The government has been spending far more than it collects. Debt has ballooned past $5,000 and services are collapsing. Creditors are losing faith. You need revenue ‚Äî fast.",instruction:"Raise Income Tax above 30% to increase revenue. Bring government debt below $4,000.",section:"fiscal",highlightPolicy:"incomeTax",scenarioConfig:{policies:{printMoney:5,interestRate:.05,incomeTax:.08,corporateTax:.05,minWage:10,ubi:200,educationFunding:.8,unemploymentBenefit:150,publicHealthcare:!0,wealthTax:0,policeFunding:.5,financialOversight:.3,reserveRequirement:.1,depositInsurance:!0,maxLoanToValue:.8,antiMonopoly:!1,openBorders:!1,subsidiesFarming:!0},agentCount:200,businessCount:18,wealthMultiplier:.8,wealthInequality:.8,avgSkill:.5,startGovDebt:5e3},conditions:[{metric:"govDebt",op:"lte",value:4e3}],successMessage:"Raising taxes is politically painful but sometimes necessary to avoid sovereign default. In real life, austerity vs. stimulus is one of the biggest debates in economics."},{id:"tut_inequality",title:"Inequality Emergency",icon:"‚öñÔ∏è",problem:"The top 1% own almost everything. Gini coefficient is above 0.8. Poverty is rampant, social unrest is rising, and crime is spiking. The people demand fairness.",instruction:"Enable Wealth Tax (set above 0%) and raise Minimum Wage above $12. Bring Gini below 0.65.",section:"inequality",highlightPolicy:"minWage",scenarioConfig:{policies:{printMoney:0,interestRate:.03,incomeTax:.1,corporateTax:.05,minWage:0,ubi:0,educationFunding:.1,unemploymentBenefit:0,publicHealthcare:!1,wealthTax:0,policeFunding:.2,financialOversight:.1,reserveRequirement:.05,depositInsurance:!1,maxLoanToValue:.9,antiMonopoly:!1,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:15,wealthMultiplier:1.5,wealthInequality:3,avgSkill:.4},conditions:[{metric:"gini",op:"lte",value:.65}],successMessage:"Wealth taxes directly reduce concentration at the top while minimum wage lifts the floor. Combining redistribution with wage floors is more effective than either alone."},{id:"tut_crime",title:"Crime Wave",icon:"üö®",problem:"Crime has exploded. Street crime and corporate fraud are both rampant. Citizens don't feel safe. Businesses are being robbed. The justice system is overwhelmed.",instruction:"Raise Police Funding above 60% to restore order. Bring the crime rate below 0.15 per 1K.",section:"crime",highlightPolicy:"policeFunding",scenarioConfig:{policies:{printMoney:0,interestRate:.05,incomeTax:.15,corporateTax:.1,minWage:3,ubi:0,educationFunding:.1,unemploymentBenefit:0,publicHealthcare:!1,wealthTax:0,policeFunding:.05,financialOversight:.05,reserveRequirement:.1,depositInsurance:!0,maxLoanToValue:.8,antiMonopoly:!1,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:15,wealthMultiplier:.7,wealthInequality:2,avgSkill:.35},conditions:[{metric:"crimeRate",op:"lte",value:.15}],successMessage:"Police funding deters street crime through higher arrest rates. But notice ‚Äî fixing poverty and inequality would address the root causes. Enforcement treats symptoms; policy treats causes."},{id:"tut_banking",title:"Banking Crisis",icon:"üè¶",problem:"Banks lent recklessly with almost no reserves. Now loans are defaulting, banks are failing, and a credit crunch is freezing the economy. The financial system is on the brink.",instruction:"Raise Reserve Requirement above 30% to stabilize the banks. Reduce debt spirals to under 10 agents.",section:"banking",highlightPolicy:"reserveRequirement",scenarioConfig:{policies:{printMoney:10,interestRate:.02,incomeTax:.2,corporateTax:.15,minWage:8,ubi:0,educationFunding:.3,unemploymentBenefit:50,publicHealthcare:!1,wealthTax:0,policeFunding:.3,financialOversight:.1,reserveRequirement:.02,depositInsurance:!1,maxLoanToValue:.95,antiMonopoly:!1,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:18,wealthMultiplier:.8,wealthInequality:1.3,avgSkill:.5},conditions:[{metric:"agentsInDebtSpiral",op:"lte",value:10}],successMessage:"Higher reserve requirements mean banks keep more cash on hand and lend less aggressively. This is exactly what regulators did after the 2008 crisis with Basel III rules. Safer banks mean a more stable economy."}];function yt({scenario:t,onSelect:o}){return e.jsx("button",{onClick:()=>o(t.id),className:"w-full text-left p-3 rounded-xl border border-[#1e1e2e] bg-[#12121a] hover:border-[#6366f1] hover:bg-[#6366f108] transition-all group",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-white font-bold text-xs group-hover:text-[#818cf8]",children:t.name}),e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded font-mono flex-shrink-0",style:{backgroundColor:t.color+"22",color:t.color},children:t.difficulty}),t.durationYears&&e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded font-mono bg-[#1e1e2e] text-[#64748b] flex-shrink-0",children:[t.durationYears,"yr"]})]}),t.era&&e.jsx("div",{className:"text-[9px] text-[#475569] font-mono",children:t.era}),e.jsx("p",{className:"text-[#64748b] text-[10px] leading-relaxed mt-0.5",children:t.description})]})]})})}function Bn({chapter:t,storyProgress:o,onSelect:n}){var s;const i=t.number<=o.unlockedChapter,a=(s=o.scores)==null?void 0:s[t.id],r=a!==void 0,{grade:l,color:c}=r?Pt(a):{};return e.jsxs("button",{onClick:()=>i&&n(t.id),disabled:!i,className:`w-full text-left p-3 rounded-xl border transition-all relative group ${i?"border-[#1e1e2e] bg-[#12121a] hover:border-[#6366f1] hover:bg-[#6366f108]":"border-[#1e1e2e] bg-[#0a0a0f] opacity-40 cursor-not-allowed"}`,children:[!i&&e.jsx("div",{className:"absolute top-2 right-2 text-[#334155] text-xs",children:"üîí"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{className:"text-[9px] font-mono px-1.5 py-0.5 rounded",style:{backgroundColor:t.color+"22",color:t.color},children:["Ch.",t.number]}),e.jsx("span",{className:"text-white font-bold text-xs group-hover:text-[#818cf8]",children:t.title}),r&&e.jsxs("span",{className:"text-[9px] font-mono font-bold ml-auto",style:{color:c},children:[l," ¬∑ ",a,"/100"]})]}),e.jsx("div",{className:"text-[9px] font-mono text-[#475569] mt-0.5",children:t.era}),e.jsx("p",{className:"text-[#64748b] text-[10px] mt-0.5 leading-relaxed",children:t.tagline})]})]}),r&&e.jsx("div",{className:"mt-2 w-full bg-[#1e1e2e] rounded-full h-0.5",children:e.jsx("div",{className:"h-0.5 rounded-full",style:{width:`${a}%`,backgroundColor:c}})})]})}const vt=[{id:"freeplay",label:"üéÆ Free Play",desc:"No time limit. No objectives. Experiment freely."},{id:"tutorial",label:"üéì Tutorial",desc:"Learn by doing. Fix broken economies one policy at a time."},{id:"historical",label:"üìú Historical",desc:"Real crises. Can you do better than history?"},{id:"story",label:"üìñ Story Mode",desc:"5-chapter campaign through economic history."}];function Gn({onSelect:t,storyProgress:o,completedLessons:n=[]}){var c;const[i,a]=u.useState("freeplay"),r=Object.keys((o==null?void 0:o.scores)||{}).length,l=oe.length;return e.jsxs("div",{className:"fixed inset-0 z-50 bg-[#0a0a0f] flex flex-col",children:[e.jsxs("div",{className:"flex-shrink-0 text-center pt-10 pb-6 px-4",children:[e.jsx("div",{className:"text-4xl mb-2",children:"üêæ"}),e.jsx("h1",{className:"text-white font-bold text-2xl font-mono tracking-tight",children:"EconSim"}),e.jsx("p",{className:"text-[#64748b] text-sm mt-1 font-mono",children:"A particle economy simulator"})]}),e.jsx("div",{className:"flex-shrink-0 flex justify-center px-4 mb-4",children:e.jsx("div",{className:"flex gap-1 bg-[#12121a] rounded-xl p-1 max-w-md w-full",children:vt.map(s=>e.jsxs("button",{onClick:()=>a(s.id),className:`flex-1 text-center py-2.5 rounded-lg text-xs font-mono transition-all ${i===s.id?"bg-[#1e1e2e] text-white font-bold shadow-sm":"text-[#475569] hover:text-[#94a3b8]"}`,children:[s.label,s.id==="tutorial"&&n.length>0&&e.jsxs("span",{className:"ml-1 text-[9px] text-[#22c55e]",children:[n.length,"/",W.length]}),s.id==="story"&&r>0&&e.jsxs("span",{className:"ml-1 text-[9px] text-[#6366f1]",children:[r,"/",l]})]},s.id))})}),e.jsx("div",{className:"flex-shrink-0 text-center px-4 mb-4",children:e.jsx("div",{className:"text-xs text-[#475569] font-mono",children:(c=vt.find(s=>s.id===i))==null?void 0:c.desc})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-8",children:e.jsxs("div",{className:"max-w-xl mx-auto flex flex-col gap-2",children:[i==="freeplay"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-[10px] font-mono text-[#64748b] uppercase tracking-wider mb-2",children:"Start with an economic model"}),e.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:_t.map(s=>e.jsxs("button",{onClick:()=>t("_model:"+s.id),className:"text-left p-3 rounded-xl border border-[#1e1e2e] bg-[#12121a] hover:border-[#6366f1] hover:bg-[#6366f108] transition-all group",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("span",{className:"text-sm",children:s.flag}),e.jsx("span",{className:"text-[11px] text-white font-bold font-mono group-hover:text-[#818cf8]",children:s.name})]}),e.jsx("div",{className:"text-[9px] text-[#475569] leading-snug",children:s.desc})]},s.id))})]}),e.jsx("div",{className:"text-[10px] font-mono text-[#64748b] uppercase tracking-wider mb-2",children:"Or pick a scenario"}),En.map(s=>e.jsx(yt,{scenario:s,onSelect:t},s.id))]}),i==="tutorial"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[10px] font-mono text-[#334155] mb-1",children:"Each lesson gives you a broken economy. Fix it by adjusting the right policy."}),W.map((s,d)=>{const p=n.includes(d);return e.jsx("div",{className:`w-full text-left p-3 rounded-xl border bg-[#12121a] ${p?"border-[#22c55e33]":"border-[#1e1e2e]"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-xl",children:s.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-white font-bold text-xs",children:s.title}),p?e.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded font-mono bg-[#22c55e22] text-[#22c55e] font-bold",children:"Completed"}):e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded font-mono bg-[#6366f122] text-[#6366f1]",children:["Lesson ",d+1]})]}),e.jsx("p",{className:"text-[#64748b] text-[10px] leading-relaxed mt-0.5",children:s.instruction})]}),p&&e.jsx("span",{className:"text-[#22c55e] text-sm flex-shrink-0",children:"‚úì"})]})},s.id)}),n.length===W.length&&e.jsxs("div",{className:"p-3 rounded-xl bg-[#22c55e11] border border-[#22c55e33] text-center",children:[e.jsx("div",{className:"text-[#22c55e] font-mono font-bold text-sm",children:"All Lessons Complete!"}),e.jsx("div",{className:"text-[#94a3b8] text-xs mt-1",children:"You've mastered the basics. Try Free Play or a Historical crisis."})]}),e.jsx("button",{onClick:()=>t("_tutorial"),className:"w-full py-3 rounded-xl bg-[#6366f1] hover:bg-[#5558e6] text-white font-bold text-sm font-mono transition-colors mt-2",children:n.length===0?"Start Tutorial":n.length<W.length?"Continue Tutorial":"Replay Tutorial"})]}),i==="historical"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[10px] font-mono text-[#334155] mb-1",children:"Real economic crises, simulated. Your decisions are compared to what actually happened."}),Dn.map(s=>e.jsx(yt,{scenario:s,onSelect:t},s.id))]}),i==="story"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-[10px] font-mono text-[#334155] mb-1",children:"A 5-chapter campaign through the history of capitalism. Each chapter unlocks after completing the previous one."}),oe.map((s,d)=>e.jsx(Bn,{chapter:s,storyProgress:o,onSelect:t},s.id)),r===l&&e.jsxs("div",{className:"p-3 rounded-xl bg-[#f59e0b11] border border-[#f59e0b33] text-center",children:[e.jsx("div",{className:"text-[#f59e0b] font-mono font-bold text-sm",children:"üèÜ Campaign Complete!"}),e.jsx("div",{className:"text-[#94a3b8] text-xs mt-1",children:"You've navigated 200 years of economic history."})]}),r>0&&e.jsx("button",{onClick:()=>{window.confirm("Reset story progress? This cannot be undone.")&&t("_reset_story")},className:"text-[9px] font-mono text-[#334155] hover:text-[#ef4444] text-center py-1 transition-colors",children:"Reset story progress"})]})]})}),e.jsx("div",{className:"flex-shrink-0 text-center py-3 border-t border-[#1e1e2e]",children:e.jsx("div",{className:"text-[#334155] text-[10px] font-mono",children:"Select a game mode to begin"})})]})}const Wn={monopoly_forming:{title:"Monopoly Alert",emoji:"üè¢",body:"One business now controls over 60% of its market. Without competition, prices rise and quality drops.",realWorld:"Standard Oil controlled 91% of US oil in 1904. The Sherman Antitrust Act (1890) broke it up. Today, similar debates surround Big Tech.",color:"#ef4444"},high_inequality:{title:"Inequality Spike",emoji:"üìä",body:"Wealth concentration is extreme. The Gini coefficient measures this: 0 = perfect equality, 1 = one person owns everything.",realWorld:"The US Gini is ~0.41. Scandinavia: ~0.28. Brazil: ~0.53. High inequality correlates with lower social mobility and higher crime.",color:"#f59e0b"},high_unemployment:{title:"Unemployment Crisis",emoji:"üìâ",body:"Mass unemployment creates a vicious cycle: fewer workers ‚Üí less spending ‚Üí fewer sales ‚Üí more layoffs.",realWorld:"Keynes' insight: in a recession, government spending can break this cycle by creating demand when the private sector won't.",color:"#ef4444"},inflation_spiral:{title:"Inflation Warning",emoji:"üî•",body:"Prices are rising faster than wages. Your money buys less each day. The purchasing power of savings erodes.",realWorld:"Zimbabwe's hyperinflation (2008) reached 89.7 sextillion % monthly. The cure: independent central banks that raise rates.",color:"#f97316"},min_wage_tradeoff:{title:"Minimum Wage Tradeoff",emoji:"‚öñÔ∏è",body:"A higher minimum wage raised living standards ‚Äî but some businesses can no longer afford to hire.",realWorld:"Seattle's $15 minimum wage (2015) study: restaurant employment rose in some areas, fell in others. Context matters enormously.",color:"#6366f1"},budget_surplus:{title:"Fiscal Surplus!",emoji:"üí∞",body:"Tax revenue exceeds spending. The government can pay down debt or invest in future growth.",realWorld:"The US ran surpluses 1998-2001. Norway's oil fund (built from surpluses) now exceeds $1.4 trillion.",color:"#22c55e"},stagnation:{title:"Stagflation Risk",emoji:"üò∞",body:"The economy is shrinking AND unemployment is rising ‚Äî the worst of both worlds. Traditional policy tools conflict.",realWorld:"The 1970s oil crisis created stagflation. Volcker killed it (1980) by raising interest rates to 20% ‚Äî causing a painful recession.",color:"#8b5cf6"},poverty_trap:{title:"Poverty Trap",emoji:"ü™§",body:"Workers in poverty can't afford better nutrition, education, or healthcare ‚Äî which keeps them in poverty.",realWorld:"The poverty trap: every dollar earned reduces welfare by $1. Effective marginal tax rates for the poor can exceed 80%.",color:"#ef4444"},dutch_disease:{title:"Resource Dependency",emoji:"‚õΩ",body:"One sector dominates, crowding out others. High-earning sectors attract all workers, leaving other industries struggling.",realWorld:`The "Dutch Disease": Netherlands' 1960s natural gas discovery boosted the guilder, making exports uncompetitive.`,color:"#f59e0b"},ubi_effect:{title:"UBI Effect Observed",emoji:"üéØ",body:"Universal Basic Income is reducing poverty and providing security. Some people are taking more risks ‚Äî starting businesses.",realWorld:"Finland's UBI experiment (2017-18): recipients reported better wellbeing, mental health improved. Employment was neutral.",color:"#22c55e"}};function Hn({insight:t,onDismiss:o}){const[n,i]=u.useState(!1);if(u.useEffect(()=>{t&&i(!0)},[t]),!t||!n)return null;const a=Wn[t.id]||{title:t.title,emoji:"üí°",body:t.body,realWorld:t.realWorld,color:"#6366f1"},r=()=>{i(!1),setTimeout(()=>o==null?void 0:o(),300)};return e.jsx("div",{className:`fixed bottom-6 right-6 z-40 max-w-sm transition-all duration-300 ${n?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:e.jsx("div",{className:"bg-[#0d0d14] border rounded-xl p-4 shadow-2xl",style:{borderColor:a.color+"66"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl flex-shrink-0",children:a.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h4",{className:"text-white font-bold text-sm",children:a.title}),e.jsx("button",{onClick:r,className:"text-[#475569] hover:text-white text-sm ml-2",children:"‚úï"})]}),e.jsx("p",{className:"text-[#94a3b8] text-xs leading-relaxed mb-2",children:a.body}),e.jsxs("div",{className:"text-[10px] text-[#64748b] leading-relaxed border-l-2 pl-2 italic",style:{borderColor:a.color+"66"},children:["üåç ",a.realWorld]}),e.jsxs("div",{className:"text-[9px] text-[#334155] mt-2 font-mono",children:["Year ",t.year," ¬∑ ",t.id]})]})]})})})}function $n(t){const o=t.id,n=t.effectOverride||{},i=[];return n.demandMultiplier!==void 0&&i.push(n.demandMultiplier>.7?"‚Üë GDP recovery":"‚Üì GDP contraction"),n.wealthCrashPhase!==void 0&&i.push(n.wealthCrashPhase>.5?"‚Üó Softer crash":"‚Üò Hard crash"),n.deathRateMultiplier!==void 0&&i.push(n.deathRateMultiplier>2?"‚Üë‚Üë Deaths":"‚Üë Fewer deaths"),n.techProductivityMultiplier!==void 0&&(i.push(n.techProductivityMultiplier>1.5?"‚Üë GDP spike":"‚Üí Moderate growth"),i.push(n.otherJobsAutomatedRate>.1?"‚Üì‚Üì Jobs lost":"‚Üì Some jobs lost")),n.foodSupplyMultiplier!==void 0&&i.push(n.foodPriceMultiplier>1.8?"‚Üë‚Üë Food prices":"‚Üë Food prices"),t.govDebtPenalty&&i.push(`‚Üë Debt +${t.govDebtPenalty}`),o==="do_nothing"&&(i.push("‚Üí Default market response"),i.push("? Outcome uncertain")),i}function On({choice:t,selected:o,onSelect:n}){const i=$n(t),a=t.id==="do_nothing";return e.jsx("button",{onClick:()=>n(t.id),className:`w-full text-left p-4 rounded-xl border-2 transition-all ${o?"border-[#6366f1] bg-[#6366f111]":a?"border-[#334155] border-dashed bg-[#12121a] hover:border-[#475569]":"border-[#1e1e2e] bg-[#12121a] hover:border-[#334155] hover:bg-[#1a1a28]"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl flex-shrink-0 mt-0.5",children:t.emoji}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-white text-sm mb-1",children:t.label}),e.jsx("p",{className:"text-[#94a3b8] text-xs leading-relaxed mb-2",children:t.description}),e.jsxs("div",{className:"flex items-start gap-1.5 mb-2",children:[e.jsx("span",{className:"text-[#f59e0b] text-[10px] flex-shrink-0 mt-0.5",children:"‚ö†"}),e.jsx("span",{className:"text-[#f59e0b] text-[10px] leading-relaxed",children:t.tradeoff})]}),i.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:i.map((r,l)=>e.jsx("span",{className:`text-[9px] font-mono px-1.5 py-0.5 rounded ${r.startsWith("‚Üë")||r.startsWith("‚Üó")?"bg-[#22c55e22] text-[#22c55e]":r.startsWith("‚Üì")||r.startsWith("‚Üò")?"bg-[#ef444422] text-[#ef4444]":"bg-[#1e1e2e] text-[#64748b]"}`,children:r},l))})]})]})})}function qn({event:t,onChoose:o}){var s,d;const[n,i]=u.useState(null),[a,r]=u.useState(!1);if(!t)return null;const l=()=>{if(n){if(!a){r(!0);return}o(t.id,n)}},c=(s=t.choices)==null?void 0:s.find(p=>p.id===n);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-[#0d0d14] border border-[#334155] rounded-2xl p-6 max-w-xl w-full mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"text-4xl",children:t.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:t.name}),e.jsx("p",{className:"text-[#94a3b8] text-sm",children:t.description})]})]}),e.jsxs("div",{className:"border-t border-[#1e1e2e] pt-4 mb-4",children:[e.jsx("p",{className:"text-[#64748b] text-xs font-mono uppercase tracking-wider mb-3",children:"‚ö° Simulation paused ‚Äî your decision required"}),e.jsx("div",{className:"flex flex-col gap-2",children:(d=t.choices)==null?void 0:d.map(p=>e.jsx(On,{choice:p,selected:n===p.id,onSelect:i},p.id))})]}),a&&c&&e.jsxs("div",{className:"mb-4 p-3 bg-[#1e1e2e] rounded-lg border border-[#334155]",children:[e.jsx("div",{className:"text-[#64748b] text-[10px] uppercase tracking-wider font-mono mb-1",children:"üìö What history did"}),e.jsx("p",{className:"text-[#94a3b8] text-xs leading-relaxed italic",children:c.historicalNote})]}),e.jsx("button",{onClick:l,disabled:!n,className:`w-full py-3 rounded-xl font-mono font-bold text-sm transition-colors ${n?"bg-[#6366f1] hover:bg-[#818cf8] text-white":"bg-[#1e1e2e] text-[#475569] cursor-not-allowed"}`,children:n?a?"‚ñ∂ Apply and continue":"Confirm ‚Äî see what history did ‚Üí":"Select a response"})]})})}const Ln={greatDepression:{summary:"The US experienced 10 years of contraction. GDP fell 46% peak-to-trough. Unemployment peaked at 25% in 1933. Deflation wiped out savings.",turningPoint:"FDR's New Deal (1933): bank reform, work programs (CCC, WPA), agricultural relief, and abandoning the gold standard.",whatWorked:"Government spending restarted demand. Banking reform restored confidence. Devaluing the dollar stopped deflation.",whatFailed:"Initial Hoover austerity and Smoot-Hawley tariffs deepened the slump. Balanced-budget orthodoxy was catastrophically wrong.",historicalGrade:"D+",metrics:{gdpChangePercent:-46,peakUnemployment:25,inflationAvg:-6,gini:.63,povertyRate:35,recoveryYears:10},quote:'"The only thing we have to fear is fear itself." ‚Äî FDR, 1933'},weimarHyperinflation:{summary:"Germany printed money to pay WWI reparations. By Nov 1923 a loaf of bread cost 200 billion marks. The middle class was wiped out.",turningPoint:"The Rentenmark (Nov 1923): a new currency backed by land assets, issued by an independent body. Printing stopped cold.",whatWorked:"Completely stopping money creation. Issuing a credible new currency. International loans (Dawes Plan) stabilized reparations.",whatFailed:"There was no painless exit. Savings were permanently destroyed. The political fallout helped fuel the rise of extremism.",historicalGrade:"C",metrics:{gdpChangePercent:-25,peakUnemployment:30,inflationAvg:29500,gini:.7,povertyRate:45,recoveryYears:6},quote:'"Inflation is the most important single factor in the politico-economic history of the Weimar Republic." ‚Äî Adam Fergusson'},stagflation1970s:{summary:"OPEC oil embargo (1973) triggered both high inflation AND high unemployment simultaneously ‚Äî violating Keynesian assumptions.",turningPoint:"Volcker Shock (1979‚Äì82): Federal Reserve raised rates to 20%, deliberately causing a recession to break inflationary expectations.",whatWorked:"Aggressive interest rate hikes eventually tamed inflation. Supply-side reforms improved productivity.",whatFailed:"Wage-price controls (Nixon 1971) temporarily masked inflation then made it worse. Easy money in the early 70s was a mistake.",historicalGrade:"C+",metrics:{gdpChangePercent:-3,peakUnemployment:13,inflationAvg:11,gini:.4,povertyRate:15,recoveryYears:8},quote:'"Inflation is always and everywhere a monetary phenomenon." ‚Äî Milton Friedman'},crisisOf2008:{summary:"US housing bubble collapsed. Lehman Brothers failed Sep 2008. Global credit froze. Worst recession since the Great Depression.",turningPoint:"TARP bank bailouts ($700B), Fed QE programs ($4T), Obama stimulus ($787B). Slow but sustained recovery 2009‚Äì2019.",whatWorked:"Massive fiscal stimulus, quantitative easing, and bank recapitalization prevented a second Great Depression.",whatFailed:"Austerity in Europe caused a double-dip recession. Too little debt relief for homeowners prolonged household balance sheet repair.",historicalGrade:"B-",metrics:{gdpChangePercent:-4.3,peakUnemployment:10,inflationAvg:1.5,gini:.47,povertyRate:15,recoveryYears:6},quote:'"We came very close to a complete collapse of the financial system." ‚Äî Ben Bernanke'},japanLostDecade:{summary:"Japan's asset bubble burst in 1991. Despite near-zero rates and stimulus, GDP stagnated for 20+ years. Deflation became entrenched.",turningPoint:"Abenomics (2012): aggressive QE, fiscal stimulus, structural reforms. Partially effective ‚Äî ended deflation but growth remained weak.",whatWorked:"Eventually: currency devaluation, quantitative easing at scale, negative interest rates.",whatFailed:"Years of half-measures and zombie bank forbearance. Failure to force bad debt write-offs kept the economy in stasis.",historicalGrade:"D",metrics:{gdpChangePercent:10,peakUnemployment:5.5,inflationAvg:-.2,gini:.34,povertyRate:16,recoveryYears:20},quote:`"Japan's experience suggests that it's very hard to escape deflation once it becomes entrenched." ‚Äî Ben Bernanke`},nordicMiracle:{summary:"Nordic countries (esp. Sweden 1990s) combined high taxes, strong unions, universal welfare, and open markets into sustained prosperity.",turningPoint:"Sweden's 1990s bank crisis resolution: swift bank nationalization, transparent debt writedowns, then re-privatization. Full recovery in 3 years.",whatWorked:"Universal education and healthcare create a productive workforce. Strong safety nets allow risk-taking. Transparent institutions reduce corruption.",whatFailed:"Model requires high trust, homogeneity, and strong institutions to function. Difficult to replicate in larger, more diverse economies.",historicalGrade:"A",metrics:{gdpChangePercent:35,peakUnemployment:8,inflationAvg:2.1,gini:.27,povertyRate:8,recoveryYears:3},quote:`"The Nordic model is not socialism. It's a highly competitive market economy with strong social insurance." ‚Äî Daron Acemoglu`}};function Un(t){return Ln[t]||null}const At={"A+":"#22c55e",A:"#22c55e",B:"#84cc16",C:"#eab308",D:"#f97316",F:"#ef4444"};function Ze({label:t,score:o}){const n=o>=70?"#22c55e":o>=45?"#eab308":"#ef4444";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1 text-xs font-mono",children:[e.jsx("span",{className:"text-[#94a3b8]",children:t}),e.jsxs("span",{style:{color:n},children:[o,"/100"]})]}),e.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-1.5",children:e.jsx("div",{className:"h-1.5 rounded-full transition-all duration-700",style:{width:`${o}%`,backgroundColor:n}})})]})}function Yn({obj:t}){const o=t.completed?"‚úÖ":t.met?"üîÑ":"‚ùå",n=t.completed?"#22c55e":t.met?"#f59e0b":"#ef4444";return e.jsxs("div",{className:"flex items-start gap-2 py-1.5 border-b border-[#1e1e2e] last:border-0",children:[e.jsx("span",{className:"text-sm flex-shrink-0 mt-0.5",children:o}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-mono text-[#e2e8f0]",children:[t.icon," ",t.label]}),e.jsx("span",{className:"text-xs font-mono",style:{color:n},children:t.completed?"Done":t.met?"In progress":`${Math.round(t.progress*100)}%`})]}),e.jsx("div",{className:"text-[10px] text-[#475569] mt-0.5",children:t.description})]})]})}function zn({playerOutcome:t,historicalOutcome:o}){var i;if(!o)return null;const n=[{label:"GDP Change",player:`${t.gdpChangePercent>0?"+":""}${t.gdpChangePercent}%`,history:`${o.metrics.gdpChangePercent}%`,betterIfHigher:!0,playerVal:t.gdpChangePercent,histVal:o.metrics.gdpChangePercent},{label:"Peak Unemployment",player:`${t.peakUnemployment}%`,history:`${o.metrics.peakUnemployment}%`,betterIfHigher:!1,playerVal:t.peakUnemployment,histVal:o.metrics.peakUnemployment},{label:"Avg Inflation",player:`${t.inflationAvg}%`,history:`${o.metrics.inflationAvg}%`,betterIfHigher:null,playerVal:Math.abs(t.inflationAvg),histVal:Math.abs(o.metrics.inflationAvg)},{label:"Gini Coefficient",player:t.gini.toFixed(2),history:o.metrics.gini.toFixed(2),betterIfHigher:!1,playerVal:t.gini,histVal:o.metrics.gini},{label:"Poverty Rate",player:`${t.povertyRate}%`,history:`${o.metrics.povertyRate}%`,betterIfHigher:!1,playerVal:t.povertyRate,histVal:o.metrics.povertyRate}];return e.jsxs("div",{children:[e.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-3",children:"You vs History"}),e.jsxs("div",{className:"bg-[#0d0d14] rounded-xl overflow-hidden border border-[#1e1e2e]",children:[e.jsxs("div",{className:"grid grid-cols-3 text-[10px] font-mono text-[#475569] px-3 py-1.5 border-b border-[#1e1e2e]",children:[e.jsx("span",{children:"Metric"}),e.jsx("span",{className:"text-center text-[#6366f1]",children:"You"}),e.jsx("span",{className:"text-center",children:"History"})]}),n.map(a=>{let r="#e2e8f0";return a.betterIfHigher===!0?r=a.playerVal>=a.histVal?"#22c55e":"#ef4444":a.betterIfHigher===!1&&(r=a.playerVal<=a.histVal?"#22c55e":"#ef4444"),e.jsxs("div",{className:"grid grid-cols-3 px-3 py-1.5 text-xs font-mono border-b border-[#0a0a0f] last:border-0",children:[e.jsx("span",{className:"text-[#64748b]",children:a.label}),e.jsx("span",{className:"text-center font-bold",style:{color:r},children:a.player}),e.jsx("span",{className:"text-center text-[#475569]",children:a.history})]},a.label)})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs font-mono text-[#475569] px-1",children:[e.jsxs("span",{children:["History's grade: ",e.jsx("span",{style:{color:At[o.historicalGrade]||"#94a3b8"},className:"font-bold",children:o.historicalGrade})]}),e.jsxs("span",{className:"text-[10px] italic",children:['"',(i=o.quote)==null?void 0:i.slice(0,50),'‚Ä¶"']})]})]})}function Kn({report:t,onRetry:o,onNextScenario:n}){var l;if(!t)return null;const i=Un(t.scenarioId),a=At[t.grade]||"#94a3b8",r=i&&t.finalScore>({"A+":95,A:85,B:70,C:55,D:40,F:20}[i.historicalGrade]||50);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/85 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-[#0d0d14] border border-[#1e1e2e] rounded-2xl p-6 max-w-lg w-full mx-4 max-h-[92vh] overflow-y-auto shadow-2xl",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"text-6xl font-bold font-mono mb-1",style:{color:a},children:t.grade}),e.jsx("div",{className:"text-white font-bold text-lg",children:t.scenarioName}),e.jsxs("div",{className:"text-[#64748b] text-sm",children:["Year ",t.year," ¬∑ Score ",t.finalScore,"/100"]}),r&&e.jsx("div",{className:"mt-2 text-[#22c55e] text-sm font-mono",children:"üèÜ You did better than history!"})]}),e.jsxs("div",{className:"bg-[#12121a] rounded-xl p-4 mb-4 flex flex-col gap-2.5",children:[e.jsx(Ze,{label:"Equality",score:t.domains.equality.score}),e.jsx(Ze,{label:"Growth",score:t.domains.growth.score}),e.jsx(Ze,{label:"Stability",score:t.domains.stability.score})]}),((l=t.objectives)==null?void 0:l.length)>0&&e.jsxs("div",{className:"bg-[#12121a] rounded-xl p-4 mb-4",children:[e.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:"Objectives"}),t.objectives.map(c=>e.jsx(Yn,{obj:c},c.id))]}),i&&e.jsxs("div",{className:"bg-[#12121a] rounded-xl p-4 mb-4",children:[e.jsx(zn,{playerOutcome:t.playerOutcome,historicalOutcome:i}),e.jsxs("div",{className:"mt-3 border-t border-[#1e1e2e] pt-3",children:[e.jsx("div",{className:"text-[10px] text-[#475569] font-mono uppercase tracking-wider mb-1",children:"What worked in history"}),e.jsx("p",{className:"text-[#64748b] text-xs leading-relaxed",children:i.whatWorked})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:o,className:"flex-1 py-3 rounded-xl border border-[#1e1e2e] text-[#94a3b8] hover:border-[#6366f1] hover:text-[#6366f1] font-mono text-sm transition-colors",children:"‚Ü∫ Try Again"}),e.jsx("button",{onClick:n,className:"flex-1 py-3 rounded-xl bg-[#6366f1] hover:bg-[#818cf8] text-white font-mono font-bold text-sm transition-colors",children:"Next Challenge ‚Üí"})]})]})})}const J={contentStyle:{background:"#0d0d14",border:"1px solid #334155",borderRadius:8,fontSize:11,fontFamily:"monospace",boxShadow:"0 4px 12px rgba(0,0,0,0.5)"},labelStyle:{color:"#94a3b8",marginBottom:2},itemStyle:{color:"#e2e8f0",padding:"1px 0"},cursor:{stroke:"#6366f144",strokeWidth:1}},C={tick:{fill:"#475569",fontSize:9,fontFamily:"monospace"},axisLine:{stroke:"#1e1e2e"},tickLine:!1},ce="#f59e0b0a",Z="#ef44440d",Et="#22c55e08",Re="#f59e0b55",je="#ef444455",qe="#22c55e44";function L({title:t,subtitle:o,color:n="#6366f1",children:i,wide:a=!1}){return e.jsxs("div",{className:`bg-[#0d0d14] border border-[#1e1e2e] rounded-xl p-3 flex flex-col gap-1 ${a?"col-span-2":""}`,children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("div",{className:"text-xs font-mono font-bold",style:{color:n},children:t}),o&&e.jsx("div",{className:"text-[10px] font-mono text-[#475569]",children:o})]}),e.jsx("div",{style:{height:140,width:"100%"},children:i})]})}function Vn({approvalHistory:t}){const o=(t||[]).map((n,i)=>({i,approval:n}));return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(we,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"approvalGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:.02})]})}),e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),e.jsx(N,{y1:0,y2:20,fill:Z}),e.jsx(N,{y1:20,y2:30,fill:ce}),e.jsx(N,{y1:80,y2:100,fill:Et}),e.jsx(z,{dataKey:"i",...C,tickFormatter:n=>`${Math.round(n/52)}y`,interval:Math.floor((o.length-1)/5)}),e.jsx(K,{...C,domain:[0,100],width:28}),e.jsx(V,{...J,formatter:n=>[(n==null?void 0:n.toFixed(1))+"%","Approval"],labelFormatter:n=>`Year ${Math.round(n/52)}`}),e.jsx(T,{y:20,stroke:je,strokeDasharray:"3 3",label:{value:"Regime Risk",fill:"#ef4444",fontSize:8,position:"insideBottomLeft"}}),e.jsx(T,{y:80,stroke:qe,strokeDasharray:"3 3",label:{value:"Mandate",fill:"#22c55e",fontSize:8,position:"insideTopLeft"}}),e.jsx(ke,{type:"monotone",dataKey:"approval",stroke:"#06b6d4",fill:"url(#approvalGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function Jn({history:t}){const o=(t.gdp||[]).map((i,a)=>({i:a,gdp:i})),n=o.length>0?o[0].gdp:0;return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(we,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"gdpGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:.02})]})}),e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),n>0&&e.jsx(N,{y1:0,y2:n*.5,fill:Z}),n>0&&e.jsx(N,{y1:n*.5,y2:n*.8,fill:ce}),e.jsx(z,{dataKey:"i",...C,tickFormatter:i=>`${Math.round(i/52)}y`,interval:Math.floor((o.length-1)/5)}),e.jsx(K,{...C,tickFormatter:i=>i>=1e6?`${(i/1e6).toFixed(0)}M`:i>=1e3?`${(i/1e3).toFixed(0)}K`:i,width:36}),e.jsx(V,{...J,formatter:i=>["$"+Le(i),"GDP"],labelFormatter:i=>`Year ${Math.round(i/52)}`}),n>0&&e.jsx(T,{y:n,stroke:"#47556944",strokeDasharray:"3 3",label:{value:"Start",fill:"#475569",fontSize:8,position:"insideTopRight"}}),e.jsx(ke,{type:"monotone",dataKey:"gdp",stroke:"#6366f1",fill:"url(#gdpGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function Zn({history:t}){const o=Math.min((t.unemployment||[]).length,(t.inflation||[]).length),n=Array.from({length:o},(i,a)=>({i:a,unemployment:t.unemployment[a],inflation:t.inflation[a]}));return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(_e,{data:n,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),e.jsx(N,{y1:10,y2:20,fill:ce}),e.jsx(N,{y1:20,y2:100,fill:Z}),e.jsx(z,{dataKey:"i",...C,tickFormatter:i=>`${Math.round(i/52)}y`,interval:Math.floor((n.length-1)/5)}),e.jsx(K,{...C,tickFormatter:i=>i.toFixed(0)+"%",width:36}),e.jsx(V,{...J,formatter:(i,a)=>[i.toFixed(1)+"%",a==="unemployment"?"Unemployment":"Inflation"],labelFormatter:i=>`Year ${Math.round(i/52)}`}),e.jsx(T,{y:5,stroke:qe,strokeDasharray:"3 3",label:{value:"Healthy",fill:"#22c55e",fontSize:8,position:"insideTopLeft"}}),e.jsx(T,{y:10,stroke:Re,strokeDasharray:"3 3"}),e.jsx(T,{y:20,stroke:je,strokeDasharray:"3 3",label:{value:"Crisis",fill:"#ef4444",fontSize:8,position:"insideTopLeft"}}),e.jsx(fe,{type:"monotone",dataKey:"unemployment",stroke:"#f59e0b",strokeWidth:2,dot:!1,isAnimationActive:!1}),e.jsx(fe,{type:"monotone",dataKey:"inflation",stroke:"#ef4444",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}const Dt={food:"#22c55e",housing:"#06b6d4",tech:"#6366f1",luxury:"#f59e0b"};function Xn({sectorPrices:t}){const o=t||{},n=Math.max(...Object.values(o).map(r=>(r==null?void 0:r.length)||0),0),i=Array.from({length:n},(r,l)=>{var c,s,d,p;return{i:l,food:(c=o.food)==null?void 0:c[l],housing:(s=o.housing)==null?void 0:s[l],tech:(d=o.tech)==null?void 0:d[l],luxury:(p=o.luxury)==null?void 0:p[l]}}),a=i.length>0&&i[0].food||10;return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(_e,{data:i,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),e.jsx(N,{y1:a*3,y2:a*100,fill:Z}),e.jsx(z,{dataKey:"i",...C,tickFormatter:r=>`${Math.round(r/52)}y`,interval:Math.floor((i.length-1)/5)}),e.jsx(K,{...C,tickFormatter:r=>"$"+(r==null?void 0:r.toFixed(0)),width:36}),e.jsx(V,{...J,formatter:(r,l)=>["$"+(r||0).toFixed(1),l],labelFormatter:r=>`Year ${Math.round(r/52)}`}),e.jsx(T,{y:a,stroke:"#47556944",strokeDasharray:"3 3",label:{value:"Base",fill:"#475569",fontSize:8,position:"insideTopRight"}}),Object.entries(Dt).map(([r,l])=>e.jsx(fe,{type:"monotone",dataKey:r,stroke:l,strokeWidth:1.5,dot:!1,isAnimationActive:!1},r))]})})}function Qn({history:t}){const o=Math.min((t.gini||[]).length,(t.poverty||[]).length),n=Array.from({length:o},(i,a)=>({i:a,gini:t.gini[a]*100,poverty:t.poverty[a]}));return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(_e,{data:n,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),e.jsx(N,{y1:35,y2:50,fill:ce}),e.jsx(N,{y1:50,y2:100,fill:Z}),e.jsx(z,{dataKey:"i",...C,tickFormatter:i=>`${Math.round(i/52)}y`,interval:Math.floor((n.length-1)/5)}),e.jsx(K,{...C,tickFormatter:i=>i.toFixed(0),width:28,domain:[0,100]}),e.jsx(V,{...J,formatter:(i,a)=>[i.toFixed(1),a==="gini"?"Gini x100":"Poverty %"],labelFormatter:i=>`Year ${Math.round(i/52)}`}),e.jsx(T,{y:35,stroke:Re,strokeDasharray:"3 3",label:{value:"High",fill:"#f59e0b",fontSize:8,position:"insideTopLeft"}}),e.jsx(T,{y:50,stroke:je,strokeDasharray:"3 3",label:{value:"Extreme",fill:"#ef4444",fontSize:8,position:"insideTopLeft"}}),e.jsx(fe,{type:"monotone",dataKey:"gini",stroke:"#ec4899",strokeWidth:2,dot:!1,isAnimationActive:!1}),e.jsx(fe,{type:"monotone",dataKey:"poverty",stroke:"#f97316",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function eo({history:t}){const o=(t.govBudget||[]).map((n,i)=>({i,budget:n,fill:n>=0?"#22c55e":"#ef4444"}));return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(nn,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),e.jsx(N,{y1:-999999,y2:0,fill:Z}),e.jsx(z,{dataKey:"i",...C,tickFormatter:n=>`${Math.round(n/52)}y`,interval:Math.floor((o.length-1)/5)}),e.jsx(K,{...C,tickFormatter:n=>n>=1e3?`${(n/1e3).toFixed(0)}K`:n,width:36}),e.jsx(V,{...J,formatter:n=>[Le(n),n>=0?"Surplus":"Deficit"],labelFormatter:n=>`Year ${Math.round(n/52)}`}),e.jsx(T,{y:0,stroke:"#475569",label:{value:"Balanced",fill:"#475569",fontSize:8,position:"insideTopLeft"}}),e.jsx(on,{dataKey:"budget",radius:[1,1,0,0],isAnimationActive:!1,children:o.map((n,i)=>e.jsx(an,{fill:n.fill},i))})]})})}function to({history:t}){const o=(t.population||[]).map((i,a)=>({i:a,pop:i})),n=o.length>0?o[0].pop:0;return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(we,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"popGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:.02})]})}),e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),n>0&&e.jsx(N,{y1:0,y2:n*.3,fill:Z}),n>0&&e.jsx(N,{y1:n*.3,y2:n*.6,fill:ce}),e.jsx(z,{dataKey:"i",...C,tickFormatter:i=>`${Math.round(i/52)}y`,interval:Math.floor((o.length-1)/5)}),e.jsx(K,{...C,width:28}),e.jsx(V,{...J,formatter:i=>[i,"Population"],labelFormatter:i=>`Year ${Math.round(i/52)}`}),n>0&&e.jsx(T,{y:n*.5,stroke:je,strokeDasharray:"3 3",label:{value:"Collapse",fill:"#ef4444",fontSize:8,position:"insideTopLeft"}}),e.jsx(ke,{type:"monotone",dataKey:"pop",stroke:"#06b6d4",fill:"url(#popGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function no({history:t}){const o=(t.privateDebt||[]).map((a,r)=>({i:r,debt:a})),n=t.gdp||[],i=n.length>0?n.reduce((a,r)=>a+r,0)/n.length:0;return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(we,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"debtGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#f97316",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.02})]})}),e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),i>0&&e.jsx(N,{y1:i,y2:i*2,fill:ce}),i>0&&e.jsx(N,{y1:i*2,y2:i*100,fill:Z}),e.jsx(z,{dataKey:"i",...C,tickFormatter:a=>`${Math.round(a/52)}y`,interval:Math.floor((o.length-1)/5)}),e.jsx(K,{...C,tickFormatter:a=>a>=1e3?`${(a/1e3).toFixed(0)}K`:a,width:36}),e.jsx(V,{...J,formatter:a=>["$"+Le(a),"Private Debt"],labelFormatter:a=>`Year ${Math.round(a/52)}`}),i>0&&e.jsx(T,{y:i,stroke:Re,strokeDasharray:"3 3",label:{value:"Debt=GDP",fill:"#f59e0b",fontSize:8,position:"insideTopLeft"}}),e.jsx(ke,{type:"monotone",dataKey:"debt",stroke:"#f97316",fill:"url(#debtGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function oo({history:t}){const o=(t.creditScore||[]).map((n,i)=>({i,score:n}));return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(we,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"creditGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:.02})]})}),e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),e.jsx(N,{y1:300,y2:500,fill:Z}),e.jsx(N,{y1:500,y2:600,fill:ce}),e.jsx(N,{y1:700,y2:850,fill:Et}),e.jsx(z,{dataKey:"i",...C,tickFormatter:n=>`${Math.round(n/52)}y`,interval:Math.floor((o.length-1)/5)}),e.jsx(K,{...C,domain:[300,850],width:32}),e.jsx(V,{...J,formatter:n=>[Math.round(n),"Avg Credit Score"],labelFormatter:n=>`Year ${Math.round(n/52)}`}),e.jsx(T,{y:500,stroke:je,strokeDasharray:"3 3",label:{value:"Poor",fill:"#ef4444",fontSize:8,position:"insideBottomLeft"}}),e.jsx(T,{y:600,stroke:Re,strokeDasharray:"3 3",label:{value:"Fair",fill:"#f59e0b",fontSize:8,position:"insideBottomLeft"}}),e.jsx(T,{y:700,stroke:qe,strokeDasharray:"3 3",label:{value:"Good",fill:"#22c55e",fontSize:8,position:"insideTopLeft"}}),e.jsx(ke,{type:"monotone",dataKey:"score",stroke:"#8b5cf6",fill:"url(#creditGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function io({history:t}){const o=t.crime||[],n=t.prisonPop||[],i=Math.max(o.length,n.length),a=Array.from({length:i},(r,l)=>({i:l,crime:o[l]??0,prison:n[l]??0}));return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(_e,{data:a,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),e.jsx(N,{y1:.3,y2:.5,fill:ce}),e.jsx(N,{y1:.5,y2:100,fill:Z}),e.jsx(z,{dataKey:"i",...C,tickFormatter:r=>`${Math.round(r/52)}y`,interval:Math.floor((a.length-1)/5)}),e.jsx(K,{...C,width:32}),e.jsx(V,{...J,formatter:(r,l)=>[r.toFixed(1),l==="crime"?"Crime Rate":"Prison Pop"],labelFormatter:r=>`Year ${Math.round(r/52)}`}),e.jsx(T,{y:.3,stroke:Re,strokeDasharray:"3 3",label:{value:"High",fill:"#f59e0b",fontSize:8,position:"insideTopLeft"}}),e.jsx(T,{y:.5,stroke:je,strokeDasharray:"3 3",label:{value:"Crisis",fill:"#ef4444",fontSize:8,position:"insideTopLeft"}}),e.jsx(fe,{type:"monotone",dataKey:"crime",stroke:"#ef4444",strokeWidth:2,dot:!1,isAnimationActive:!1}),e.jsx(fe,{type:"monotone",dataKey:"prison",stroke:"#f97316",strokeWidth:1.5,dot:!1,isAnimationActive:!1})]})})}function ue({color:t,label:o}){return e.jsxs("span",{className:"flex items-center gap-1 text-[10px] font-mono text-[#64748b]",children:[e.jsx("span",{className:"w-2 h-2 rounded-full inline-block flex-shrink-0",style:{background:t}}),o]})}function ao({history:t}){const o=t.inflation||[],n=t.inflationExp||[],i=Math.min(o.length,n.length),a=Array.from({length:i},(r,l)=>({i:l,actual:o[l],expected:n[l]}));return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(_e,{data:a,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),e.jsx(N,{y1:5,y2:10,fill:ce}),e.jsx(N,{y1:10,y2:200,fill:Z}),e.jsx(z,{dataKey:"i",...C,tickFormatter:r=>`${Math.round(r/52)}y`,interval:Math.floor((a.length-1)/5)}),e.jsx(K,{...C,tickFormatter:r=>(r==null?void 0:r.toFixed(0))+"%",width:36}),e.jsx(V,{...J,formatter:(r,l)=>[(r||0).toFixed(1)+"%",l==="actual"?"Actual Inflation":"Expected Inflation"],labelFormatter:r=>`Year ${Math.round(r/52)}`}),e.jsx(T,{y:2,stroke:qe,strokeDasharray:"3 3",label:{value:"Target 2%",fill:"#22c55e",fontSize:8,position:"insideTopLeft"}}),e.jsx(T,{y:5,stroke:Re,strokeDasharray:"3 3"}),e.jsx(T,{y:10,stroke:je,strokeDasharray:"3 3",label:{value:"Hyper",fill:"#ef4444",fontSize:8,position:"insideTopLeft"}}),e.jsx(fe,{type:"monotone",dataKey:"actual",stroke:"#ef4444",strokeWidth:2,dot:!1,isAnimationActive:!1}),e.jsx(fe,{type:"monotone",dataKey:"expected",stroke:"#f59e0b",strokeWidth:2,dot:!1,isAnimationActive:!1,strokeDasharray:"5 3"})]})})}function ro({history:t}){const o=(t.marketCap||[]).map((i,a)=>({i:a,cap:i})),n=o.length>0?o[0].cap:0;return e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(we,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"stockGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8b5cf6",stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:"#8b5cf6",stopOpacity:.02})]})}),e.jsx(Y,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),n>0&&e.jsx(N,{y1:0,y2:n*.5,fill:Z}),n>0&&e.jsx(N,{y1:n*.5,y2:n*.8,fill:ce}),e.jsx(z,{dataKey:"i",...C,tickFormatter:i=>`${Math.round(i/52)}y`,interval:Math.floor((o.length-1)/5)}),e.jsx(K,{...C,tickFormatter:i=>i>=1e3?`${(i/1e3).toFixed(0)}K`:i,width:36}),e.jsx(V,{...J,formatter:i=>["$"+Le(i),"Market Cap"],labelFormatter:i=>`Year ${Math.round(i/52)}`}),n>0&&e.jsx(T,{y:n,stroke:"#47556944",strokeDasharray:"3 3",label:{value:"IPO",fill:"#475569",fontSize:8,position:"insideTopRight"}}),e.jsx(ke,{type:"monotone",dataKey:"cap",stroke:"#8b5cf6",fill:"url(#stockGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function so({metrics:t,market:o,approvalHistory:n,activeSection:i="economy"}){const a=(t==null?void 0:t.history)||{},r=h=>{switch(h){case"gdp":return e.jsx(L,{title:"GDP",subtitle:"Total economic output",color:"#6366f1",children:e.jsx(Jn,{history:a})},h);case"unemployment_inflation":return e.jsxs(L,{title:"Unemployment & Inflation",color:"#f59e0b",children:[e.jsx(Zn,{history:a}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx(ue,{color:"#f59e0b",label:"Unemployment %"}),e.jsx(ue,{color:"#ef4444",label:"Inflation %"})]})]},h);case"approval":return e.jsx(L,{title:"Approval Rating",subtitle:"20% = no confidence, 80% = mandate",color:"#06b6d4",wide:!0,children:e.jsx(Vn,{approvalHistory:n})},h);case"gov_budget":return e.jsx(L,{title:"Gov Budget",subtitle:"Green = surplus, Red = deficit",color:"#22c55e",children:e.jsx(eo,{history:a})},h);case"inequality":return e.jsxs(L,{title:"Inequality",subtitle:"Gini x100 & Poverty %",color:"#ec4899",children:[e.jsx(Qn,{history:a}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx(ue,{color:"#ec4899",label:"Gini"}),e.jsx(ue,{color:"#f97316",label:"Poverty"})]})]},h);case"population":return e.jsx(L,{title:"Population",subtitle:"Total alive agents",color:"#06b6d4",children:e.jsx(to,{history:a})},h);case"private_debt":return e.jsx(L,{title:"Private Debt",subtitle:"Total outstanding loans",color:"#f97316",children:e.jsx(no,{history:a})},h);case"credit_score":return e.jsx(L,{title:"Credit Score",subtitle:"Average credit score",color:"#8b5cf6",children:e.jsx(oo,{history:a})},h);case"crime":return e.jsxs(L,{title:"Crime",subtitle:"Crime rate & prison population",color:"#ef4444",children:[e.jsx(io,{history:a}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx(ue,{color:"#ef4444",label:"Crime Rate"}),e.jsx(ue,{color:"#f97316",label:"Prison Pop"})]})]},h);case"sector_prices":return e.jsxs(L,{title:"Sector Prices",color:"#22c55e",children:[e.jsx(Xn,{sectorPrices:a.sectorPrices}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:Object.entries(Dt).map(([y,M])=>e.jsx(ue,{color:M,label:y},y))})]},h);case"inflation_expectations":return e.jsxs(L,{title:"Inflation vs Expectations",subtitle:"Actual vs expected",color:"#ef4444",children:[e.jsx(ao,{history:a}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsx(ue,{color:"#ef4444",label:"Actual"}),e.jsx(ue,{color:"#f59e0b",label:"Expected"})]})]},h);case"stock_market":return e.jsx(L,{title:"Stock Market",subtitle:"Total market capitalization",color:"#8b5cf6",children:e.jsx(ro,{history:a})},h);default:return null}},l={economy:["gdp","unemployment_inflation","stock_market"],fiscal:["gov_budget","approval"],inequality:["inequality","population"],banking:["private_debt","credit_score"],public:["crime","sector_prices"],weird:["inflation_expectations","sector_prices"],chaos:["approval","gdp"]},c=["approval","gdp","unemployment_inflation","inflation_expectations","stock_market","sector_prices","inequality","private_debt","gov_budget","population","crime","credit_score"],[s,d]=u.useState(!1),p=l[i]||c.slice(0,3),g=c.filter(h=>!p.includes(h));return e.jsxs("div",{className:"flex flex-col gap-3 overflow-y-auto h-full p-2",children:[e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3",children:p.map(h=>r(h))}),g.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>d(h=>!h),className:"text-[10px] font-mono text-[#475569] hover:text-[#94a3b8] transition-colors self-start px-1",children:s?"‚ñ≤ Hide other charts":`‚ñº Show all charts (${g.length} more)`}),s&&e.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-3",children:g.map(h=>r(h))})]})]})}function Le(t){return t==null||isNaN(t)?"0":Math.abs(t)>=1e6?(t/1e6).toFixed(1)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(1)+"K":Math.round(t).toString()}const wt=[{key:"gdp",label:"GDP",metric:"gdpGrowth",format:"trend",tab:"economy",thresholds:{good:.02,warn:0,danger:-.05}},{key:"jobs",label:"Jobs",metric:"unemployment",format:"percent",tab:"inequality",thresholds:{good:.05,warn:.15,danger:.25},invert:!0},{key:"prices",label:"Prices",metric:"inflation",format:"percentRaw",tab:"economy",thresholds:{good:3,warn:8,danger:15},invert:!0},{key:"approval",label:"Approval",metric:"approvalRating",format:"bar",tab:"fiscal",thresholds:{good:60,warn:30,danger:15},useRoot:!0},{key:"fx",label:"FX",metric:"fxRate",format:"number",tab:"economy",thresholds:{good:.3,warn:.6,danger:1},deviation:!0}];function lo(t,o){if(o==null)return"#475569";const n=t.thresholds;if(t.deviation){const i=Math.abs(o-1);return i<=n.good?"#22c55e":i<=n.warn?"#f59e0b":"#ef4444"}return t.invert?o<=n.good?"#22c55e":o<=n.warn?"#f59e0b":"#ef4444":o>=n.good?"#22c55e":o>=n.warn?"#f59e0b":"#ef4444"}function co(t,o){if(o==null)return"--";switch(t.format){case"trend":return`${o>=0?"‚Üë":"‚Üì"}${Math.abs(o*100).toFixed(1)}%`;case"percent":return`${(o*100).toFixed(1)}%`;case"percentRaw":return`${o.toFixed(1)}%`;case"bar":return`${Math.round(o)}%`;case"number":return o.toFixed(2);default:return String(o)}}function uo({metrics:t,approvalRating:o,onTabSwitch:n}){const i=u.useMemo(()=>t?wt.map(a=>{var l,c;const r=a.useRoot?o:a.metric==="inflation"?(c=(l=t.history)==null?void 0:l.inflation)==null?void 0:c.slice(-1)[0]:t[a.metric];return{...a,value:r,color:lo(a,r)}}):wt.map(a=>({...a,value:void 0,color:"#475569"})),[t,o]);return e.jsx("div",{className:"bg-[#0d0d14] border-b border-[#1e1e2e] px-3 py-1.5 flex items-center gap-2 overflow-x-auto",children:i.map(a=>e.jsxs("button",{onClick:()=>n==null?void 0:n(a.tab),className:"flex items-center gap-1.5 px-2.5 py-1 rounded-full border transition-all hover:bg-[#12121a] flex-shrink-0",style:{borderColor:a.color+"44"},title:`${a.label} - Click to view ${a.tab} tab`,children:[e.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:a.color}}),e.jsx("span",{className:"text-[10px] font-mono text-[#64748b] uppercase",children:a.label}),e.jsx("span",{className:"text-xs font-mono font-bold",style:{color:a.color},children:co(a,a.value)}),a.format==="bar"&&a.value!==void 0&&e.jsx("div",{className:"w-8 h-1.5 bg-[#1e1e2e] rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${Math.min(100,a.value)}%`,backgroundColor:a.color}})})]},a.key))})}function fo({chapter:t,onBegin:o,onBack:n,chapterScore:i}){const[a,r]=u.useState(!0),l=t.openingNarrative.trim().split(`

`);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",children:e.jsxs("div",{className:"max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto rounded-2xl border p-8 shadow-2xl",style:{borderColor:t.color+"55",background:"#0a0a0f"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("span",{className:"text-5xl",children:t.icon}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-xs font-mono uppercase tracking-widest mb-1",style:{color:t.color},children:["Chapter ",t.number," ¬∑ ",t.era]}),e.jsx("h2",{className:"text-white font-bold text-2xl leading-tight",children:t.title}),e.jsx("p",{className:"text-[#64748b] text-sm mt-0.5 italic",children:t.tagline})]})]}),i!==void 0&&e.jsx("div",{className:"mb-5 p-3 rounded-lg border text-xs font-mono",style:{borderColor:t.color+"33",background:t.color+"11"},children:e.jsxs("span",{style:{color:t.color},children:["‚óÄ Chapter ",t.number-1," score: ",i,"/100 ‚Äî you've earned this chapter"]})}),e.jsx("div",{className:"mb-6 space-y-4",children:l.map((c,s)=>e.jsx("p",{className:`font-mono leading-relaxed ${s===0?"text-white text-sm font-bold":"text-[#94a3b8] text-sm"}`,children:c},s))}),e.jsxs("div",{className:"mb-6 p-4 rounded-xl border border-[#1e1e2e] bg-[#12121a]",children:[e.jsx("div",{className:"text-[10px] font-mono text-[#475569] uppercase tracking-wider mb-3",children:"Your objectives"}),e.jsx("div",{className:"flex flex-col gap-2",children:t.objectives.map(c=>e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-base flex-shrink-0",children:c.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-mono font-bold text-[#e2e8f0]",children:c.label}),e.jsx("div",{className:"text-[10px] text-[#64748b]",children:c.description})]})]},c.id))}),e.jsxs("div",{className:"mt-3 text-[10px] font-mono text-[#334155]",children:["‚è± You have ",t.durationYears," in-game years"]})]}),e.jsxs("div",{className:"flex gap-3",children:[n&&e.jsx("button",{onClick:n,className:"flex-none px-4 py-2.5 rounded-xl text-xs font-mono border border-[#1e1e2e] text-[#475569] hover:text-[#94a3b8] transition-colors",children:"‚Üê Back"}),e.jsxs("button",{onClick:o,className:"flex-1 py-3 rounded-xl font-mono font-bold text-sm text-white transition-colors",style:{background:t.color},children:["‚ñ∂ Begin Chapter ",t.number]})]})]})})}function po({grade:t,color:o}){return e.jsx("div",{className:"w-20 h-20 rounded-full border-4 flex items-center justify-center flex-shrink-0",style:{borderColor:o},children:e.jsx("span",{className:"text-3xl font-bold font-mono",style:{color:o},children:t})})}function ho({obj:t}){const o=t.completed?"#22c55e":"#ef4444",n=t.completed?"‚úì":"‚úó";return e.jsxs("div",{className:"flex items-center gap-2 py-1.5 border-b border-[#1e1e2e] last:border-0",children:[e.jsx("span",{className:"text-sm font-bold",style:{color:o},children:n}),e.jsx("span",{className:"text-sm",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-xs font-mono font-bold",style:{color:t.completed?"#e2e8f0":"#64748b"},children:t.label}),e.jsx("div",{className:"text-[10px] text-[#475569]",children:t.description})]}),e.jsx("div",{className:"w-12 h-1.5 rounded-full bg-[#1e1e2e] overflow-hidden flex-shrink-0",children:e.jsx("div",{className:"h-1.5 rounded-full transition-all",style:{width:`${Math.round((t.progress||0)*100)}%`,backgroundColor:o}})})]})}function mo({chapter:t,objectives:o=[],score:n,onNextChapter:i,onReplay:a,isLastChapter:r}){const{grade:l,label:c,color:s}=Pt(n),d=An(n),g=t.closingNarrative[d].trim().split(`

`);return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",children:e.jsxs("div",{className:"max-w-xl w-full mx-4 max-h-[90vh] overflow-y-auto rounded-2xl border p-6 shadow-2xl",style:{borderColor:s+"55",background:"#0a0a0f"},children:[e.jsxs("div",{className:"flex items-center gap-4 mb-5",children:[e.jsx(po,{grade:l,color:s}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-[10px] font-mono text-[#475569] uppercase tracking-widest mb-0.5",children:["Chapter ",t.number," Complete"]}),e.jsx("h2",{className:"text-white font-bold text-xl",children:t.title}),e.jsxs("div",{className:"text-sm font-mono mt-0.5",style:{color:s},children:[c," ‚Äî ",n,"/100"]})]})]}),e.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-2 mb-5",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-1000",style:{width:`${n}%`,backgroundColor:s}})}),e.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-xl p-3 mb-4",children:[e.jsx("div",{className:"text-[10px] font-mono text-[#475569] uppercase tracking-wider mb-2",children:"Objectives"}),o.map(h=>e.jsx(ho,{obj:h},h.id))]}),e.jsxs("div",{className:"mb-5 p-4 rounded-xl",style:{background:s+"11",border:`1px solid ${s}33`},children:[e.jsx("div",{className:"text-[10px] font-mono uppercase tracking-wider mb-2",style:{color:s},children:"Historical verdict"}),g.map((h,y)=>e.jsx("p",{className:"text-[#94a3b8] text-xs leading-relaxed mb-1.5",children:h},y))]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:a,className:"flex-none px-4 py-2.5 rounded-xl text-xs font-mono border border-[#1e1e2e] text-[#475569] hover:text-[#94a3b8] transition-colors",children:"‚Ü∫ Replay"}),r?e.jsx("button",{onClick:i,className:"flex-1 py-3 rounded-xl font-mono font-bold text-sm text-white bg-[#6366f1] hover:bg-[#818cf8] transition-colors",children:"üèÜ Campaign Complete"}):e.jsxs("button",{onClick:i,className:"flex-1 py-3 rounded-xl font-mono font-bold text-sm text-white transition-colors",style:{background:s},children:["‚Üí Chapter ",t.number+1]})]})]})})}const et=48,Te=typeof window<"u"?Math.min(window.devicePixelRatio||1,2):2,ge=et*Te;function go({state:t="disabled",progress:o=0,analyserNode:n,onClick:i}){const a=u.useRef(null),r=u.useRef(null),l=u.useCallback(c=>{const s=a.current;if(!s)return;const d=s.getContext("2d"),p=ge/2,g=ge/2,h=ge*.32;if(d.clearRect(0,0,ge,ge),t==="disabled"){d.beginPath(),d.arc(p,g,h*.75,0,Math.PI*2),d.strokeStyle="rgba(99,102,241,0.35)",d.lineWidth=1.5*Te,d.stroke();const y=d.createRadialGradient(p,g,0,p,g,h*.7);y.addColorStop(0,"rgba(99,102,241,0.45)"),y.addColorStop(1,"rgba(99,102,241,0.05)"),d.beginPath(),d.arc(p,g,h*.7,0,Math.PI*2),d.fillStyle=y,d.fill(),d.beginPath(),d.arc(p,g,h*.2,0,Math.PI*2),d.fillStyle="rgba(99,102,241,0.5)",d.fill()}else if(t==="idle"){const y=1+.08*Math.sin(c/1200),M=h*y;d.beginPath(),d.arc(p,g,M*.85,0,Math.PI*2),d.strokeStyle="rgba(6,182,212,0.3)",d.lineWidth=1.5*Te,d.stroke();const S=d.createRadialGradient(p,g,0,p,g,M);S.addColorStop(0,"rgba(99,102,241,0.8)"),S.addColorStop(.5,"rgba(6,182,212,0.35)"),S.addColorStop(1,"rgba(6,182,212,0)"),d.beginPath(),d.arc(p,g,M,0,Math.PI*2),d.fillStyle=S,d.fill(),d.beginPath(),d.arc(p,g,h*.2,0,Math.PI*2),d.fillStyle="rgba(99,102,241,0.9)",d.fill()}else if(t==="loading"){const y=c/600%(Math.PI*2),M=Math.PI*1.2;d.beginPath(),d.arc(p,g,h*.7,0,Math.PI*2),d.strokeStyle="rgba(99,102,241,0.3)",d.lineWidth=3*Te,d.stroke(),d.beginPath(),d.arc(p,g,h*.7,y,y+M),d.strokeStyle="rgba(6,182,212,0.8)",d.lineWidth=3*Te,d.lineCap="round",d.stroke(),d.fillStyle="rgba(226,232,240,0.8)",d.font=`bold ${10*Te}px monospace`,d.textAlign="center",d.textBaseline="middle",d.fillText(`${o}%`,p,g)}else if(t==="speaking"){let y=.5;if(n){const w=new Uint8Array(n.frequencyBinCount);n.getByteFrequencyData(w);let E=0;for(let k=0;k<w.length;k++)E+=w[k];y=E/(w.length*255)}const M=1+y*.4,S=h*M,de=.2+y*.5,_=d.createRadialGradient(p,g,S*.5,p,g,S*1.3);_.addColorStop(0,`rgba(6,182,212,${de})`),_.addColorStop(1,"rgba(6,182,212,0)"),d.beginPath(),d.arc(p,g,S*1.3,0,Math.PI*2),d.fillStyle=_,d.fill();const A=d.createRadialGradient(p,g,0,p,g,S);A.addColorStop(0,"rgba(99,102,241,0.9)"),A.addColorStop(.5,`rgba(6,182,212,${.4+y*.3})`),A.addColorStop(1,"rgba(6,182,212,0)"),d.beginPath(),d.arc(p,g,S,0,Math.PI*2),d.fillStyle=A,d.fill(),d.beginPath(),d.arc(p,g,h*.2,0,Math.PI*2),d.fillStyle=`rgba(255,255,255,${.6+y*.3})`,d.fill()}r.current=requestAnimationFrame(l)},[t,o,n]);return u.useEffect(()=>(r.current=requestAnimationFrame(l),()=>{r.current&&cancelAnimationFrame(r.current)}),[l]),e.jsx("canvas",{ref:a,width:ge,height:ge,onClick:i,title:t==="disabled"?"Enable AI narrator":t==="loading"?`Loading AI model (${o}%)`:t==="speaking"?"AI narrator speaking":"AI narrator idle ‚Äî click to disable",style:{position:"fixed",bottom:16,right:16,width:et,height:et,cursor:"pointer",zIndex:50}})}function xo(t,o){const n={incomeTax:[0,.6],corporateTax:[0,.5],minWage:[0,50],ubi:[0,1e3],interestRate:[0,.2],educationFunding:[0,1],unemploymentBenefit:[0,500],printMoney:[0,100],wealthTax:[0,.05],reserveRequirement:[0,.5],maxLoanToValue:[.5,1],robotTax:[0,.5],mandatoryProfitShare:[0,.3],landValueTax:[0,.05],policeFunding:[0,1],financialOversight:[0,1],helicopterMoney:[0,500],maximumWage:[0,500],wealthConfiscation:[0,.5],punitiveTargiffs:[0,2],capitalGainsTax:[0,.5]};if(t in n){const[i,a]=n[t];return pn(Number(o),i,a)}return o}const Bt="ecomsim_save",at="ecomsim_story";function kt(t){try{localStorage.setItem(Bt+"_scenario",t)}catch{}}function bo(){try{return localStorage.getItem(Bt+"_scenario")||"freeMarket"}catch{return"freeMarket"}}function yo(t){try{localStorage.setItem(at,JSON.stringify(t))}catch{}}function vo(){try{const t=localStorage.getItem(at);return t?JSON.parse(t):{unlockedChapter:1,scores:{}}}catch{return{unlockedChapter:1,scores:{}}}}function wo(){try{localStorage.removeItem(at)}catch{}}let tt=null,rt=!1,Xe=!1,nt=[],Ce=null,be=null,ot=!1,He=null,ve=null,Pe=[],pe=!1,Ie=null,$e=null,ko=0,Me={};const jo="af_sky",he={monopoly_forming:"Warning. One company now dominates the market. Without competition, prices are rising and innovation is slowing.",high_inequality:"Inequality has reached extreme levels. The Gini coefficient indicates the top few now own most of the wealth.",high_unemployment:"Mass unemployment is spreading. A vicious cycle: fewer workers means less spending, which means even more layoffs.",inflation_spiral:"Inflation warning. Prices are rising faster than wages. Your population's purchasing power is eroding.",min_wage_tradeoff:"Minimum wage tradeoff observed. Living standards improved, but some small businesses can no longer afford to hire.",budget_surplus:"Fiscal surplus achieved. Tax revenue now exceeds government spending.",stagnation:"Stagflation risk. The economy is shrinking while unemployment rises ‚Äî the classic policy dilemma.",poverty_trap:"Poverty trap forming. Workers in poverty cannot afford education or healthcare, keeping them trapped.",ubi_effect:"Universal Basic Income is reducing poverty. Some residents are using the security to start new businesses.",policy_fourDayWeek_on:"The four-day work week is now law. Workers rejoice. Friday afternoons are sacred. Economists nervously check productivity spreadsheets.",policy_fourDayWeek_off:"The four-day work week has been repealed. Monday through Friday, back to the grind.",policy_robotTax_on:"A robot tax has been introduced. For every job automated away, the tech sector must pay. Silicon Valley is not pleased.",policy_breadAndCircuses_on:"Bread and circuses for all! The government is handing out free food and entertainment. Unrest is falling. Economists are horrified.",policy_breadAndCircuses_off:"The bread and circuses program has ended. Let's see how long the calm lasts.",policy_mandatoryProfitShare_on:"Mandatory profit sharing is now law. Businesses must distribute a cut of profits to every worker. Workers approve. Shareholders do not.",policy_mandatoryProfitShare_off:"Mandatory profit sharing repealed. The windfall stays with the owners again.",policy_landValueTax_on:"A land value tax has been enacted. Henry George would be proud. Landowners are furious. Economists say this is actually the most efficient tax possible.",policy_banAdvertising_on:"Advertising is banned. No more billboards, no more commercials, no more targeted manipulation. The luxury sector is experiencing an identity crisis.",policy_banAdvertising_off:"The advertising ban is lifted. The bombardment of commercial messages resumes immediately.",policy_debtJubilee_on:"DEBT JUBILEE! All debts are cancelled ‚Äî right now, this instant. It is a Biblical reset. The slate is wiped clean. This happens only once.",policy_lotteryRedistribution_on:"The wealth lottery is running. Random rich citizens are paying a luck tax directly to random poor ones. It's chaotic. It's arbitrary. It's weirdly effective.",policy_lotteryRedistribution_off:"The wealth lottery has ended. The rich breathe a sigh of relief.",policy_sumptuary_on:"Sumptuary laws are in effect. The wealthy may no longer spend freely on luxury goods. Medieval rulers used this to maintain social order. It also destroyed the luxury economy.",policy_sumptuary_off:"Sumptuary laws repealed. The luxury market roars back to life.",policy_degrowth_on:"Degrowth policy enacted. The government has officially stopped chasing GDP growth. Economists are having a meltdown. Everyone else is working less and feeling healthier.",policy_degrowth_off:"Degrowth policy abandoned. Back to the infinite growth imperative.",policy_algoCentralPlanning_on:"Algorithmic central planning is online. An AI now sets all prices. The market volatility disappears. So does the spontaneous order. It is efficient. It is cold. It is watching.",policy_algoCentralPlanning_off:"The algorithm has been shut down. Prices will now rediscover chaos on their own.",policy_universalBankAccount_on:"Universal bank accounts issued to every citizen. No one is unbanked. The poorest residents finally have somewhere safe to store their savings.",policy_universalBankAccount_off:"Universal bank accounts discontinued. Financial exclusion returns for the poorest citizens.",policy_helicopterMoney_on:"Helicopter money is airborne. Cash is literally raining from the sky. Every citizen is richer ‚Äî briefly. Inflation is watching from below, grinning.",policy_helicopterMoney_off:"The helicopter has landed. The free money spigot is closed. Prices remain elevated.",policy_maximumWage_on:"A maximum wage is now law. No one earns above the cap. Executives are furious. Economists are concerned about brain drain. The people are delighted.",policy_maximumWage_off:"Maximum wage repealed. Compensation limits removed. The talent exodus risk is over.",policy_wealthConfiscation_on:"Wealth confiscation is in effect. Government agents are seizing assets above the threshold. The rich are moving money offshore as fast as they can.",policy_wealthConfiscation_off:"Wealth confiscation has ended. Assets are safe again ‚Äî for now.",policy_nationalizeIndustries_on:"All industries are now nationalized. The government owns the means of production. Five-year plans are being drafted. Entrepreneurs are unemployed. Productivity is in freefall.",policy_nationalizeIndustries_off:"Privatization has begun. Industries are returning to private hands. Markets are chaotic but slowly returning to life.",policy_punitiveTargiffs_on:"Punitive tariffs are in place. All goods are now more expensive. This is to protect the economy, apparently. Consumers are paying the price ‚Äî literally.",policy_punitiveTargiffs_off:"Tariffs removed. Trade barriers down. Prices begin to normalize.",policy_guaranteedJobs_on:"A guaranteed jobs program is active. Every unemployed citizen now works for the government. Unemployment is officially zero. The budget is officially catastrophic.",policy_guaranteedJobs_off:"Guaranteed jobs program ended. Government workers are being released back to the private market.",global_oil_crisis:"A global oil crisis has erupted. Energy prices are surging worldwide. Import costs are skyrocketing. Your foreign reserves are under pressure.",global_recession:"The world economy is in recession. Global demand has collapsed. Your export markets are drying up. Foreign reserves are draining fast.",global_trade_war:"A global trade war has broken out. Tariffs and counter-tariffs are flying. Supply chains are fracturing. Every nation is paying the price.",global_commodity_cycle:"A global commodity supercycle is underway. Raw material prices are surging worldwide. Food and housing costs are spiking across borders.",global_tech_deflation:"Global tech deflation. Foreign technology is flooding the market at rock-bottom prices. Your domestic tech sector is being undercut.",currency_crisis:"Currency crisis! Your exchange rate is in freefall. Imports are becoming unaffordable. Foreign reserves are critically low.",pandemic:"A pandemic has struck. Health is dropping, businesses are closing, and workers are staying home.",cropFailure:"Crop failure. Poor harvests are causing food prices to spike. The poorest citizens are suffering most.",techBreakthrough:"Technology breakthrough! Productivity in the tech sector has doubled ‚Äî but automation is threatening other jobs.",financialBubble:"A financial bubble is growing. Asset prices are inflating rapidly ‚Äî and history suggests what comes next.",corruption:"Corruption scandal. Government tax revenue is being diverted. Public services are beginning to collapse.",immigrationWave:"An immigration wave has arrived. Skilled workers are boosting productivity, but job competition is increasing.",recession:"Recession begins. Consumer demand is falling, businesses are struggling, and unemployment is rising.",boom:"Economic boom! Consumer confidence has surged. Businesses are hiring and wages are growing.",hyperinflation:"Hyperinflation. Prices are doubling faster than wages can keep up. The currency is becoming worthless. Wheelbarrows of cash are not yet required ‚Äî but give it time.",generalStrike:"General strike! Workers across every sector have walked off the job. Production has stopped. The economy is frozen. History will judge what you do next.",bankRun:"Bank run! Panic is spreading. Citizens are lining up to withdraw everything. The financial system has hours before it collapses. Decide fast.",brainDrain:"Brain drain underway. Your most skilled citizens are packing their bags. Once expertise leaves, it rarely comes back. The productivity gap will compound for decades.",revolution:"REVOLUTION. The people have had enough. Years of inequality, poverty, and broken promises have erupted into open revolt. The guillotine is ready. History is watching."};function Gt(t){return new Promise((o,n)=>{const i=++ko;Me[i]={resolve:o,reject:n},tt.postMessage({...t,id:i})})}function No(t){const{type:o,id:n}=t.data,i=Me[n];o==="READY"?(rt=!0,nt.forEach(a=>a()),nt=[],i&&(i.resolve(),delete Me[n])):o==="AUDIO"?i&&(i.resolve({buffer:t.data.buffer,samplingRate:t.data.samplingRate}),delete Me[n]):o==="ERROR"&&(console.warn("[Narrator] Worker error:",t.data.error),i&&(i.reject(new Error(t.data.error)),delete Me[n]))}async function Wt(){if(rt)return!0;if(Xe)return new Promise(t=>nt.push(t));Xe=!0;try{return tt=new Worker(new URL("/ecomsim/assets/ttsWorker-B_475nn1.js",import.meta.url),{type:"module"}),tt.onmessage=No,await Gt({type:"INIT"}),!0}catch(t){return console.warn("[Narrator] Failed to init TTS worker:",t),Xe=!1,!1}}function Co(){return Ce||(Ce=new(window.AudioContext||window.webkitAudioContext)),!be&&Ce&&(be=Ce.createAnalyser(),be.fftSize=256,be.connect(Ce.destination)),Ce}function me(t,o={}){return t?new Promise(n=>{Pe.push({text:t,options:o,resolve:n}),Fe()}):Promise.resolve()}function Fe(){pe||Pe.length===0||To()}async function To(){if(Pe.length===0){pe=!1;return}pe=!0;const{text:t,options:o,resolve:n}=Pe.shift(),i={aborted:!1};$e=i;try{if(!await Wt()||i.aborted){n(),pe=!1,Fe();return}const r=await Gt({type:"GENERATE",text:t,voice:o.voice||jo});if(i.aborted){n(),pe=!1,Fe();return}const l=Co(),c=l.createBuffer(1,r.buffer.length,r.samplingRate);c.copyToChannel(new Float32Array(r.buffer),0);const s=l.createBufferSource();s.buffer=c,o.rate&&(s.playbackRate.value=o.rate),be?s.connect(be):s.connect(l.destination),s.start(),Ie=s,ot=!0,He==null||He(),s.onended=()=>{Ie=null,ot=!1,ve==null||ve(),n(),pe=!1,Fe()}}catch(a){console.warn("[Narrator] Narration error:",a),n(),pe=!1,Fe()}}function So(){if($e&&($e.aborted=!0,$e=null),Ie){try{Ie.stop()}catch{}Ie=null}ot=!1,ve==null||ve();const t=Pe.splice(0);for(const o of t)o.resolve();pe=!1}function Ro(t){const o=he[t];o&&me(o)}function Mo(t){const o=he[t];o&&me(o)}function Fo(t,o){const n=`policy_${t}_on`,i=`policy_${t}_off`;if(o===!0||o===!1){const a=o?he[n]:he[i];a&&me(a);return}o>0&&he[n]&&me(he[n])}function Io(){Wt()}function Po(){return rt}function _o(){return be}function jt(t){He=t}function Nt(t){ve=t}function Ao(t){var a,r,l;if(!(t!=null&&t.metrics))return null;const o=t.metrics,n=[];t.year&&n.push(`Year ${t.year}`);const i=o.population??o.alive;if(i!==void 0&&n.push(`Population: ${i}`),o.gdp!==void 0){const c=o.gdp>=1e6?`${(o.gdp/1e6).toFixed(1)}M`:o.gdp>=1e3?`${(o.gdp/1e3).toFixed(1)}K`:o.gdp.toFixed(0);n.push(`GDP: $${c}`)}if(o.gdpGrowth!==void 0){const c=o.gdpGrowth>=0?"+":"";n.push(`GDP Growth: ${c}${(o.gdpGrowth*100).toFixed(1)}%`)}if(o.unemployment!==void 0&&n.push(`Unemployment: ${(o.unemployment*100).toFixed(1)}%`),o.inflation!==void 0&&n.push(`Inflation: ${(o.inflation*100).toFixed(1)}%`),o.gini!==void 0&&n.push(`Gini: ${o.gini.toFixed(2)}`),o.povertyRate!==void 0&&n.push(`Poverty: ${(o.povertyRate*100).toFixed(1)}%`),o.unrest!==void 0&&n.push(`Unrest: ${(o.unrest*100).toFixed(0)}%`),((a=o.gdpHistory)==null?void 0:a.length)>=3){const c=o.gdpHistory.slice(-3),s=c[2]>c[0]?"rising":c[2]<c[0]?"falling":"flat";n.push(`GDP trend: ${s}`)}if(((r=t.activeEvents)==null?void 0:r.length)>0){const c=t.activeEvents.map(s=>s.name||s.type).slice(0,3);n.push(`Active events: ${c.join(", ")}`)}if(((l=t.econFeed)==null?void 0:l.length)>0){const c=t.econFeed.slice(-3).map(s=>s.text||s).join("; ");n.push(`Recent: ${c}`)}return n.join(". ")+"."}let xe=null,U="idle",Ct=0,Eo=0;const ye=new Map;let Tt=0;const Do=3e4;let G=null;function St(t){G=t}function Bo(){if(!xe&&!(U==="loading"||U==="ready"))try{xe=new Worker(new URL("/ecomsim/assets/llmWorker-q5z9uDRU.js",import.meta.url),{type:"module"}),xe.onmessage=t=>{const o=t.data;if(o.type==="STATUS"&&(U=o.status,Ct=o.progress||0,G==null||G({status:U,progress:Ct})),o.type==="NARRATIVE"){const n=ye.get(o.id);n&&(ye.delete(o.id),n.resolve(o.text))}if(o.type==="ERROR"){const n=ye.get(o.id);n&&(ye.delete(o.id),n.resolve(null))}},xe.onerror=()=>{U="error",G==null||G({status:U,progress:0})},U="loading",G==null||G({status:U,progress:0}),xe.postMessage({type:"INIT"})}catch(t){console.warn("[LLM Narrator] Failed to create worker:",t),U="error",G==null||G({status:U,progress:0})}}function Go(t){return new Promise(o=>{if(U!=="ready"||!xe){o(null);return}const n=Date.now();if(n-Tt<Do){o(null);return}Tt=n;const i=Ao(t);if(!i){o(null);return}const a=++Eo;ye.set(a,{resolve:o}),setTimeout(()=>{ye.has(a)&&(ye.delete(a),o(null))},15e3),xe.postMessage({type:"GENERATE",id:a,prompt:i})})}function Wo(){return U==="ready"}function Ho(){const[t,o]=u.useState(!1),[n,i]=u.useState(!1),[a,r]=u.useState(!1),l=u.useRef(!1),[c,s]=u.useState("idle"),[d,p]=u.useState(0),[g,h]=u.useState(!1);u.useEffect(()=>(jt(()=>h(!0)),Nt(()=>h(!1)),()=>{jt(null),Nt(null)}),[]),u.useEffect(()=>(St(({status:k,progress:D})=>{s(k),p(D)}),()=>St(null)),[]);const y=u.useCallback(async()=>{o(!0),l.current=!0,i(!0),Io(),Bo();const k=setInterval(()=>{Po()&&(r(!0),i(!1),clearInterval(k),me("Economy simulator narrator ready."))},500);setTimeout(()=>clearInterval(k),3e4)},[]),M=u.useCallback(()=>{o(!1),l.current=!1,So()},[]),S=u.useCallback(k=>{l.current&&Ro(k)},[]),de=u.useCallback(k=>{l.current&&Mo(k)},[]),_=u.useCallback(k=>{l.current&&me(k)},[]),A=u.useCallback((k,D)=>{l.current&&Fo(k,D)},[]),w=u.useCallback(async(k,D)=>{if(l.current){if(Wo()){const X=await Go(k);if(X&&X.length>10&&X.length<500){me(X);return}}D&&he[D]&&me(he[D])}},[]);return{enabled:t,loading:n,ready:a,enable:y,disable:M,onInsight:S,onEvent:de,speak:_,onPolicy:A,generateAndSpeak:w,narratorState:t?g?"speaking":c==="loading"||n?"loading":"idle":"disabled",llmStatus:c,llmProgress:d,llmReady:c==="ready",speaking:g,analyserNode:_o()}}const Ht="ecomsim_unlocked_sections";function $o(){try{const t=JSON.parse(localStorage.getItem(Ht)||"[]"),o=new Set(t);return o.add("economy"),o.add("fiscal"),o}catch{return new Set(["economy","fiscal"])}}function Rt(t){localStorage.setItem(Ht,JSON.stringify([...t]))}function Oo(t,o,n,i,a){const r=[];for(const l of It){if(a.has(l))continue;const c=wn[l];if(!c)continue;if(c.always){r.push(l);continue}let s=!1;if(c.year&&o>=c.year&&(s=!0),!s&&c.metric&&t){const d=t[c.metric]||0;c.op==="gte"&&d>=c.threshold&&(s=!0)}!s&&c.event==="bank"&&(t==null?void 0:t.bankCount)!==void 0&&t.bankCount<2&&(s=!0),!s&&c.scoreThreshold&&n>=c.scoreThreshold&&(s=!0),!s&&c.achievement&&(i==null?void 0:i.length)>0&&(s=!0),s&&r.push(l)}return r}function qo(){var lt,ct,dt,ut,ft;const t=Ho(),o=u.useRef(null),[n,i]=u.useState(null),[a,r]=u.useState(!1),[l,c]=u.useState(1),[s,d]=u.useState(bo()),[p,g]=u.useState(!0),[h,y]=u.useState(null),[M,S]=u.useState(null),[de,_]=u.useState(null),[A,w]=u.useState("economy"),[E,k]=u.useState($o),[D,X]=u.useState(vo),[ie,ae]=u.useState(null),[F,$]=u.useState(null),[re,v]=u.useState(-1),[Q,ee]=u.useState(!1),[B,Ue]=u.useState(()=>{try{return JSON.parse(localStorage.getItem("ecomsim_tutorial_progress")||"[]")}catch{return[]}}),[Ae,Ee]=u.useState([]);u.useEffect(()=>{if(Ae.length===0)return;const f=setInterval(()=>{Ee(x=>{const b=x.filter(m=>Date.now()-m.ts<5e3);return b.length===x.length?x:b})},1e3);return()=>clearInterval(f)},[Ae.length]),u.useEffect(()=>{if(!(n!=null&&n.metrics))return;const f=Oo(n.metrics,n.year||0,n.score||0,n.achievements,E);if(f.length>0){k(b=>{const m=new Set(b);return f.forEach(j=>m.add(j)),Rt(m),m});const x=Date.now();Ee(b=>[...b,...f.map(m=>({id:`unlock_${m}`,icon:We[m].icon,name:`${We[m].title} Unlocked`,description:`New policy area: ${We[m].title}`,ts:x,isUnlock:!0}))])}},[n==null?void 0:n.metrics,n==null?void 0:n.year,n==null?void 0:n.score,n==null?void 0:n.achievements]),u.useEffect(()=>{const f=new Worker(new URL("/ecomsim/assets/simWorker-KeKxCRyB.js",import.meta.url),{type:"module"});return f.addEventListener("message",x=>{var Ge;const{type:b,state:m,event:j,insight:I,report:pt}=x.data;switch(b){case"STATE_UPDATE":if(((Ge=m.newAchievements)==null?void 0:Ge.length)>0){const O=Date.now();Ee(le=>{const ht=new Set(le.map(ne=>ne.id)),P=m.newAchievements.filter(ne=>!ht.has(ne.id)).map(ne=>({...ne,ts:O}));return P.length?[...le,...P]:le})}if(m.policies){const O=Ye.current;for(const le of Object.keys(O))m.policies[le]===O[le]?delete O[le]:m.policies[le]=O[le]}i(m),m.metrics&&v(O=>(O<0||O>=W.length||W[O].conditions.every(P=>{var mt;const ne=P.metric?m.metrics[P.metric]:(mt=m.policies)==null?void 0:mt[P.policy];return ne===void 0?!1:P.op==="gte"?ne>=P.value:P.op==="lte"?ne<=P.value:P.op==="gt"?ne>P.value:P.op==="lt"?ne<P.value:!1})&&ee(!0),O));break;case"EVENT":t.llmReady?t.generateAndSpeak(De.current,j==null?void 0:j.type):t.onEvent(j==null?void 0:j.type);break;case"CHOICE_REQUIRED":S(j);break;case"INSIGHT":y(I),t.llmReady?t.generateAndSpeak(De.current,I.id):t.onInsight(I.id);break;case"SCENARIO_COMPLETE":$t(pt);break}}),f.postMessage({type:"INIT",scenarioId:s}),o.current=f,()=>f.terminate()},[]);const De=u.useRef(null);De.current=n,u.useEffect(()=>{if(!t.enabled||!t.llmReady)return;const f=setInterval(()=>{if(a)return;const x=De.current;x&&t.generateAndSpeak(x)},35e3);return()=>clearInterval(f)},[t.enabled,t.llmReady,a,t.generateAndSpeak]);const $t=u.useCallback(f=>{const x=Se[s];if(x!=null&&x.isStory){const b=oe.find(m=>m.id===s);if(b){const m=_n((f==null?void 0:f.objectives)||[]);if(X(j=>{const I={unlockedChapter:Math.max(j.unlockedChapter,b.number+1),scores:{...j.scores,[b.id]:m}};return yo(I),I}),$({chapter:b,objectives:(f==null?void 0:f.objectives)||[],score:m}),r(!0),t.enabled){const j=m>=65?"excellent":m>=35?"good":"poor";t.speak(b.closingNarrative[j])}return}}_(f),r(!0)},[s,t]),R=u.useCallback(f=>{var x;(x=o.current)==null||x.postMessage(f)},[]),Ne=u.useRef(null),Ye=u.useRef({}),te=u.useCallback((f,x=null)=>{i(null),y(null),S(null),_(null),$(null),Ye.current={};const b=new Set(["economy","fiscal"]);k(b),Rt(b),w("economy"),R({type:"RESET",scenarioId:f,scenarioConfig:x||Ne.current}),r(!1)},[R]),Ot=u.useCallback(()=>{r(!0),R({type:"PAUSE"})},[R]),qt=u.useCallback(()=>{r(!1),R({type:"RESUME"})},[R]),ze=u.useCallback(()=>{te(s)},[te,s]),Lt=u.useCallback(f=>{c(f),R({type:"SET_SPEED",speed:f})},[R]),Ut=u.useCallback((f,x)=>{const b=xo(f,x);Ye.current[f]=b,R({type:"SET_POLICY",policy:f,value:b}),i(m=>m&&{...m,policies:{...m.policies,[f]:b}}),t.onPolicy(f,b)},[R,t]),Yt=u.useCallback(()=>{Ue(m=>{const j=m.includes(re)?m:[...m,re];return localStorage.setItem("ecomsim_tutorial_progress",JSON.stringify(j)),j});const f=re+1;if(f>=W.length){v(-1),ee(!1),g(!0);return}v(f),ee(!1);const x=W[f],b={id:"default",name:x.title,...x.scenarioConfig};Ne.current=b,te("default",b)},[re,te]),zt=u.useCallback(()=>{v(-1),ee(!1),g(!0)},[]),Ke=u.useCallback(f=>{w(f)},[]),Ve=u.useCallback(f=>{if(f==="_tutorial"){const m=B.length<W.length?W.findIndex((pt,Ge)=>!B.includes(Ge)):0;v(m),ee(!1);const j=W[m],I={id:"default",name:j.title,...j.scenarioConfig};Ne.current=I,d("default"),te("default",I);return}if(v(-1),ee(!1),f==="_reset_story"){wo(),X({unlockedChapter:1,scores:{}});return}if(f.startsWith("_model:")){const m=f.slice(7),j=_t.find(I=>I.id===m);if(j){const I={id:"default",name:j.name+" Economy",policies:j.policies,agentCount:200,businessCount:20,wealthMultiplier:1,wealthInequality:1,avgSkill:.5};Ne.current=I,d("default"),kt("default"),te("default",I);return}}Ne.current=null;const x=Se[f],b=x!=null&&x.isStory?oe.find(m=>m.id===f):null;d(f),kt(f),b?(ae(b),te(f),r(!0),R({type:"PAUSE"}),t.enabled&&t.speak(b.kokoroNarration)):te(f)},[te,R,t]),Kt=u.useCallback(()=>{R({type:"FORCE_SHOCK"})},[R]),Vt=u.useCallback((f,x)=>{S(null),R({type:"RESOLVE_CHOICE",eventId:f,choiceId:x})},[R]),Jt=u.useCallback(()=>{_(null),ze()},[ze]),Zt=u.useCallback(()=>{_(null),g(!0)},[]),Xt=u.useCallback(()=>{$(null),te(s);const f=oe.find(x=>x.id===s);f&&ae(f)},[te,s]),Qt=u.useCallback(()=>{const f=oe.find(b=>b.id===s),x=oe.find(b=>b.number===((f==null?void 0:f.number)||0)+1);$(null),x?Ve(x.id):g(!0)},[s,Ve]),en=u.useCallback(()=>{ae(null),R({type:"RESUME"}),r(!1)},[R]),st=((lt=Ne.current)==null?void 0:lt.name)||((ct=Se[s])==null?void 0:ct.name)||"Free Market",Je=Se[s],Be=Je==null?void 0:Je.isStory,se=Be?oe.find(f=>f.id===s):null;return e.jsxs("div",{className:"h-screen flex flex-col bg-[#0a0a0f] text-[#e2e8f0] overflow-hidden font-mono",children:[e.jsx(Pn,{paused:a,speed:l,onPause:Ot,onResume:qt,onReset:ze,onSpeedChange:Lt,onScenarioOpen:()=>g(!0),onShockMe:Kt,scenarioName:Be&&se?`Ch.${se.number} ${se.title}`:st,year:n==null?void 0:n.year,score:n==null?void 0:n.score,achievementCount:((dt=n==null?void 0:n.achievements)==null?void 0:dt.length)||0,narratorEnabled:t.enabled,narratorLoading:t.loading,onNarratorToggle:t.enabled?t.disable:t.enable,llmStatus:t.llmStatus,llmProgress:t.llmProgress,llmReady:t.llmReady,activeSection:A,onSectionChange:Ke,unlockedSections:E,metrics:n==null?void 0:n.metrics,approvalRating:(n==null?void 0:n.approvalRating)??50}),e.jsx(uo,{metrics:n==null?void 0:n.metrics,approvalRating:(n==null?void 0:n.approvalRating)??50,onTabSwitch:Ke}),Be&&se&&!ie&&!F&&e.jsx("div",{className:"flex justify-center py-1 bg-[#0a0a0f]",children:e.jsxs("div",{className:"px-4 py-1 rounded-full text-xs font-mono font-bold",style:{background:se.color+"22",border:`1px solid ${se.color}44`,color:se.color},children:["Chapter ",se.number,": ",se.title," ¬∑ ",se.era]})}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx("div",{className:"w-[440px] flex-shrink-0 border-r border-[#1e1e2e] bg-[#0a0a0f] overflow-hidden",children:e.jsx(Mn,{metrics:n==null?void 0:n.metrics,market:n==null?void 0:n.market,activeEvents:n==null?void 0:n.activeEvents,approvalRating:(n==null?void 0:n.approvalRating)??50,policyLag:(n==null?void 0:n.policyLag)||{},policies:n==null?void 0:n.policies,onPolicyChange:Ut,econFeed:(n==null?void 0:n.econFeed)||[],agents:n==null?void 0:n.agents,objectives:n==null?void 0:n.objectives,scenarioDurationYears:n==null?void 0:n.scenarioDurationYears,year:n==null?void 0:n.year,scenarioName:st,score:n==null?void 0:n.score,scoreHistory:n==null?void 0:n.scoreHistory,achievements:n==null?void 0:n.achievements,milestoneProgress:n==null?void 0:n.milestoneProgress,totalMilestones:n==null?void 0:n.totalMilestones,currentMilestone:n==null?void 0:n.currentMilestone,tutorialLesson:re>=0?W[re]:null,tutorialLessonIndex:re,tutorialTotal:W.length,tutorialComplete:Q,completedLessons:B,onTutorialNext:Yt,onTutorialSkip:zt,activeSection:A,onSectionChange:Ke,unlockedSections:E})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-[#08080d]",children:e.jsx(so,{metrics:n==null?void 0:n.metrics,market:n==null?void 0:n.market,approvalHistory:(n==null?void 0:n.approvalHistory)||[],activeSection:A})})]}),Ae.length>0&&e.jsx("div",{className:"fixed top-16 right-4 z-50 flex flex-col gap-2",children:Ae.map(f=>e.jsx("div",{className:"bg-[#161625] border rounded-lg pl-4 pr-2 py-3 shadow-lg",style:{animation:"slideIn 0.3s ease-out",borderColor:f.isUnlock?"#3b82f6":"#f59e0b",boxShadow:`0 0 20px ${f.isUnlock?"#3b82f633":"#f59e0b33"}`},children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:f.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[10px] font-mono uppercase tracking-wider",style:{color:f.isUnlock?"#3b82f6":"#f59e0b"},children:f.isUnlock?"Area Unlocked":"Achievement Unlocked"}),e.jsx("div",{className:"text-sm font-bold text-white",children:f.name}),e.jsx("div",{className:"text-[10px] text-[#94a3b8]",children:f.description})]}),e.jsx("button",{onClick:()=>Ee(x=>x.filter(b=>b.id!==f.id)),className:"text-[#64748b] hover:text-white text-sm px-1 self-start",children:"‚úï"})]})},f.id))}),h&&e.jsx(Hn,{insight:h,onDismiss:()=>y(null)}),M&&e.jsx(qn,{event:M,onChoose:Vt}),de&&!Be&&e.jsx(Kn,{report:de,onRetry:Jt,onNextScenario:Zt}),ie&&e.jsx(fo,{chapter:ie,onBegin:en,onBack:()=>{ae(null),g(!0)},chapterScore:ie.number>1?(ft=D.scores)==null?void 0:ft[(ut=oe[ie.number-2])==null?void 0:ut.id]:void 0}),F&&e.jsx(mo,{chapter:F.chapter,objectives:F.objectives,score:F.score,onReplay:Xt,onNextChapter:Qt,isLastChapter:F.chapter.number===oe.length}),p&&e.jsx(Gn,{onSelect:f=>{Ve(f),g(!1)},storyProgress:D,completedLessons:B}),e.jsx(go,{state:t.narratorState,progress:t.llmProgress,analyserNode:t.analyserNode,onClick:t.enabled?t.disable:t.enable})]})}Qe.createRoot(document.getElementById("root")).render(e.jsx(rn.StrictMode,{children:e.jsx(qo,{})}));
