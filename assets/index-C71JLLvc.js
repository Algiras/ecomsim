import{r as c,a as pe,R as O,A as xe,b as be,B as ge,X as H,Y as q,T as z,c as ye,C as ve,L as we,d as K,e as je}from"./charts-CSEo9cJk.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();var J={exports:{}},B={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ke=c,Ne=Symbol.for("react.element"),Se=Symbol.for("react.fragment"),Ce=Object.prototype.hasOwnProperty,Te=ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Ee={key:!0,ref:!0,__self:!0,__source:!0};function Q(e,r,o){var s,n={},i=null,a=null;o!==void 0&&(i=""+o),r.key!==void 0&&(i=""+r.key),r.ref!==void 0&&(a=r.ref);for(s in r)Ce.call(r,s)&&!Ee.hasOwnProperty(s)&&(n[s]=r[s]);if(e&&e.defaultProps)for(s in r=e.defaultProps,r)n[s]===void 0&&(n[s]=r[s]);return{$$typeof:Ne,type:e,key:i,ref:a,props:n,_owner:Te.current}}B.Fragment=Se;B.jsx=Q;B.jsxs=Q;J.exports=B;var t=J.exports,$={},G=pe;$.createRoot=G.createRoot,$.hydrateRoot=G.hydrateRoot;function Ie(e,r,o){return Math.max(r,Math.min(o,e))}function Pe(e,r=20){if(!e||e.length===0)return[];const o=[...e].sort((i,a)=>i-a),s=o.reduce((i,a)=>i+a,0);if(s===0)return[];const n=[{population:0,wealth:0}];for(let i=1;i<=r;i++){const a=Math.floor(i/r*o.length),l=o.slice(0,a).reduce((u,d)=>u+d,0);n.push({population:i/r*100,wealth:l/s*100})}return n}const N=[{threshold:0,color:[220,38,38]},{threshold:100,color:[234,88,12]},{threshold:300,color:[100,116,139]},{threshold:800,color:[59,130,246]},{threshold:2e3,color:[6,182,212]},{threshold:5e3,color:[234,179,8]},{threshold:1e4,color:[251,191,36]}];function ee(e){const r=Math.max(0,e);let o=N[0],s=N[N.length-1];for(let d=0;d<N.length-1;d++)if(r>=N[d].threshold&&r<N[d+1].threshold){o=N[d],s=N[d+1];break}const n=s.threshold-o.threshold,i=n>0?(r-o.threshold)/n:1,a=Math.round(o.color[0]+(s.color[0]-o.color[0])*i),l=Math.round(o.color[1]+(s.color[1]-o.color[1])*i),u=Math.round(o.color[2]+(s.color[2]-o.color[2])*i);return`rgb(${a},${l},${u})`}const D={food:"#22c55e",housing:"#f59e0b",tech:"#6366f1",luxury:"#ec4899"},Me=800,Re=600,Ae=4;function _e(e,r,o,s){for(const n of r)n.alive&&Be(e,n,n.id===o,s)}function Be(e,r,o,s){const{x:n,y:i,state:a,wealth:l,happiness:u,unrest:d,employed:m,isOwner:f,age:h}=r,p=Ae;e.save(),d>.5?(e.shadowColor="rgba(239,68,68,0.7)",e.shadowBlur=8):l>5e3&&(e.shadowColor="rgba(251,191,36,0.5)",e.shadowBlur=6);const w=ee(l);if(e.beginPath(),f||a==="owner"?(e.moveTo(n,i-p*1.4),e.lineTo(n+p*1,i),e.lineTo(n,i+p*1.4),e.lineTo(n-p*1,i),e.closePath()):a==="child"||h<18*52?e.arc(n,i,p*.65,0,Math.PI*2):a==="retired"?e.rect(n-p*.9,i-p*.9,p*1.8,p*1.8):e.arc(n,i,p,0,Math.PI*2),e.fillStyle=w,e.fill(),a==="unemployed"?(e.strokeStyle="#ef4444",e.lineWidth=1.5,e.setLineDash([2,2]),e.stroke(),e.setLineDash([])):(m||f)&&(e.strokeStyle="rgba(255,255,255,0.6)",e.lineWidth=1,e.stroke()),l<100&&a!=="child"){const j=.3+.3*Math.sin(s*.1);e.strokeStyle=`rgba(239,68,68,${j})`,e.lineWidth=2,e.setLineDash([]),e.beginPath(),e.arc(n,i,p+3,0,Math.PI*2),e.stroke()}o&&(e.strokeStyle="#ffffff",e.lineWidth=2,e.setLineDash([]),e.beginPath(),e.arc(n,i,p+4,0,Math.PI*2),e.stroke()),e.restore()}function Fe(e,r,o,s=.12){e.save(),e.lineWidth=.5;for(const n of r){if(!n.alive||!n.employed||!n.employerId)continue;const i=o.find(a=>a.id===n.employerId);i&&(e.beginPath(),e.strokeStyle=`rgba(99,102,241,${s})`,e.moveTo(n.x,n.y),e.lineTo(i.x,i.y),e.stroke())}e.restore()}function We(e,r,o){for(const s of r)s.alive&&Le(e,s,o)}function Le(e,r,o){const{x:s,y:n,sector:i,employeeCount:a,radius:l,pulse:u,dominance:d,capital:m}=r,f=D[i]||"#94a3b8";e.save(),d>.4?(e.shadowColor=f,e.shadowBlur=15+d*20):m>2e3&&(e.shadowColor=f,e.shadowBlur=8);const h=l||10;if(e.beginPath(),Y(e,s,n,h),e.fillStyle=f+"33",e.fill(),e.strokeStyle=f,e.lineWidth=2,e.stroke(),e.fillStyle=f,e.font=`${Math.max(8,h*.8)}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(Oe[i]||"?",s,n),a>0&&(e.fillStyle="rgba(0,0,0,0.7)",e.beginPath(),e.arc(s+h*.8,n-h*.8,6,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.font="7px sans-serif",e.fillText(a,s+h*.8,n-h*.8)),m<100){const p=.4+.4*Math.sin(o*.15);e.strokeStyle=`rgba(239,68,68,${p})`,e.lineWidth=2,e.beginPath(),Y(e,s,n,h+4),e.stroke()}e.restore()}function Y(e,r,o,s){e.beginPath();for(let n=0;n<6;n++){const i=Math.PI/3*n-Math.PI/6,a=r+s*Math.cos(i),l=o+s*Math.sin(i);n===0?e.moveTo(a,l):e.lineTo(a,l)}e.closePath()}const Oe={food:"ðŸŒ¾",housing:"ðŸ ",tech:"ðŸ’»",luxury:"ðŸ’Ž"};function $e(e,r,o,s){e.save();for(const n of r){if(!n.alive)continue;const i=D[n.sector]||"#94a3b8",a=30+n.employeeCount*5,l=e.createRadialGradient(n.x,n.y,0,n.x,n.y,a);l.addColorStop(0,i+"15"),l.addColorStop(1,"transparent"),e.fillStyle=l,e.beginPath(),e.arc(n.x,n.y,a,0,Math.PI*2),e.fill()}e.restore()}const I=[];function De(e,r){for(let o=0;o<6;o++){const s=Math.PI*2/6*o;I.push({type:"sparkle",x:e,y:r,vx:Math.cos(s)*2,vy:Math.sin(s)*2,life:1,color:"#22c55e",size:3})}}function Ue(e,r){for(let o=0;o<8;o++){const s=Math.random()*Math.PI*2;I.push({type:"fade",x:e+(Math.random()-.5)*10,y:r+(Math.random()-.5)*10,vx:Math.cos(s)*1.5,vy:Math.sin(s)*1.5,life:1,color:"#ef4444",size:2})}}function He(e){for(let r=I.length-1;r>=0;r--){const o=I[r];switch(e.save(),e.globalAlpha=o.life,o.type){case"sparkle":e.fillStyle=o.color,e.beginPath(),e.arc(o.x,o.y,o.size*o.life,0,Math.PI*2),e.fill(),o.x+=o.vx,o.y+=o.vy,o.vx*=.95,o.vy*=.95,o.life-=.04;break;case"fade":e.fillStyle=o.color,e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fill(),o.x+=o.vx,o.y+=o.vy,o.life-=.06;break;case"wave":e.strokeStyle=o.color,e.lineWidth=1.5,e.beginPath(),e.arc(o.x,o.y,o.radius,0,Math.PI*2),e.stroke(),o.radius=o.radius+(o.maxRadius-o.radius)*.08,o.life-=.03;break}e.restore(),o.life<=0&&I.splice(r,1)}}function qe({simState:e,onAgentClick:r,selectedAgentId:o}){const s=c.useRef(null),n=c.useRef(null),i=c.useRef(0),a=c.useRef(new Set),l=c.useCallback(()=>{const d=s.current;if(!d)return;const m=d.getContext("2d");i.current++;const f=i.current;if(m.fillStyle="#0a0a0f",m.fillRect(0,0,d.width,d.height),!e){m.fillStyle="#334155",m.font="14px monospace",m.textAlign="center",m.fillText("Initializing simulation...",d.width/2,d.height/2);return}const{agents:h=[],businesses:p=[]}=e,w=new Set(h.filter(x=>x.alive).map(x=>x.id)),j=a.current;for(const x of j)if(!w.has(x)){const g=h.find(v=>v.id===x);g&&Ue(g.x,g.y)}for(const x of w)if(!j.has(x)){const g=h.find(v=>v.id===x);g&&De(g.x,g.y)}a.current=w,$e(m,p,d.width,d.height),Fe(m,h,p),We(m,p,f),_e(m,h,o,f),He(m),n.current=requestAnimationFrame(l)},[e,o]);c.useEffect(()=>(n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}),[l]);const u=c.useCallback(d=>{if(!(e!=null&&e.agents)||!r)return;const m=s.current,f=m.getBoundingClientRect(),h=m.width/f.width,p=m.height/f.height,w=(d.clientX-f.left)*h,j=(d.clientY-f.top)*p;let x=null,g=12;for(const v of e.agents){if(!v.alive)continue;const M=Math.sqrt((v.x-w)**2+(v.y-j)**2);M<g&&(g=M,x=v)}r(x)},[e,r]);return t.jsx("canvas",{ref:s,width:Me,height:Re,className:"w-full h-full cursor-crosshair",style:{imageRendering:"pixelated",display:"block"},onClick:u})}function S({label:e,value:r,unit:o="",trend:s,color:n="#6366f1",history:i=[],format:a="number"}){const l=c.useMemo(()=>a==="percent"?(r*100).toFixed(1)+"%":a==="currency"?"$"+V(r):a==="index"?r.toFixed(1):V(r),[r,a]),u=i.slice(-40).map((d,m)=>({i:m,v:d}));return t.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-lg p-3 flex flex-col gap-1",children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono",children:e}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("span",{className:"text-white text-xl font-bold font-mono",style:{color:n},children:l}),o&&t.jsx("span",{className:"text-[#64748b] text-xs mb-1",children:o}),s!==void 0&&t.jsxs("span",{className:`text-xs mb-1 ${s>=0?"text-green-400":"text-red-400"}`,children:[s>=0?"â†‘":"â†“"," ",Math.abs(s*100).toFixed(1),"%"]})]}),u.length>5&&t.jsx("div",{className:"h-8 w-full",children:t.jsx(O,{width:"100%",height:"100%",children:t.jsx(xe,{data:u,margin:{top:0,right:0,bottom:0,left:0},children:t.jsx(be,{type:"monotone",dataKey:"v",stroke:n,fill:n+"22",strokeWidth:1,dot:!1,isAnimationActive:!1})})})})]})}function ze({prices:e,supply:r,demand:o}){return t.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-lg p-3",children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:"Market Prices"}),t.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:Object.entries(e||{}).map(([s,n])=>{const i=(r==null?void 0:r[s])||0,a=(o==null?void 0:o[s])||0,l=a>i?"text-red-400":"text-green-400",u=a>i?"â†‘":"â†“";return t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsx("span",{style:{color:D[s]},className:"font-mono capitalize",children:s}),t.jsxs("span",{className:`font-mono font-bold ${l}`,children:["$",n.toFixed(1)," ",u]})]},s)})})]})}function Ke({value:e}){const r=(e*100).toFixed(1),o=e>.5?"#ef4444":e>.35?"#f59e0b":"#22c55e";return t.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-lg p-3",children:[t.jsxs("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:["Inequality (Gini) â€” ",r]}),t.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-2 mb-1",children:t.jsx("div",{className:"h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,e*100)}%`,backgroundColor:o}})}),t.jsxs("div",{className:"flex justify-between text-[10px] text-[#475569]",children:[t.jsx("span",{children:"Perfect Equality (0)"}),t.jsx("span",{children:"Total Inequality (1)"})]})]})}function Ge({event:e}){return t.jsxs("div",{className:"bg-[#1e1e2e] border border-[#334155] rounded px-2 py-1 text-xs flex items-center gap-1",children:[t.jsx("span",{children:e.icon}),t.jsx("span",{className:"text-[#e2e8f0] font-mono",children:e.name})]})}function Ye({metrics:e,market:r,activeEvents:o=[]}){if(!e)return t.jsx("div",{className:"text-[#475569] text-sm font-mono p-4",children:"Loading metrics..."});const{history:s={}}=e;return t.jsxs("div",{className:"flex flex-col gap-2 overflow-y-auto h-full",children:[o.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1 px-1",children:o.map(n=>t.jsx(Ge,{event:n},n.id))}),t.jsxs("div",{className:"text-[#475569] text-xs font-mono px-1",children:["Year ",e.year," Â· Tick ",e.tick," Â· Pop ",e.population]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(S,{label:"GDP",value:e.gdp,format:"currency",trend:e.gdpGrowth,color:"#6366f1",history:s.gdp||[]}),t.jsx(S,{label:"Unemployment",value:e.unemployment,format:"percent",color:e.unemployment>.15?"#ef4444":"#22c55e",history:s.unemployment||[]}),t.jsx(S,{label:"Inflation (CPI)",value:e.cpi,format:"index",color:e.cpi>120?"#f97316":"#e2e8f0",history:s.cpi||[]}),t.jsx(S,{label:"Avg Wage",value:e.avgWage,format:"currency",color:"#06b6d4"})]}),t.jsx(Ke,{value:e.gini}),t.jsx(ze,{prices:r==null?void 0:r.prices,supply:r==null?void 0:r.supply,demand:r==null?void 0:r.demand}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(S,{label:"Poverty Rate",value:e.povertyRate,format:"percent",color:e.povertyRate>.25?"#ef4444":"#94a3b8"}),t.jsx(S,{label:"Social Unrest",value:e.socialUnrest,format:"percent",color:e.socialUnrest>.5?"#ef4444":"#94a3b8",history:s.unrest||[]}),t.jsx(S,{label:"Businesses",value:e.businessCount,color:"#f59e0b"}),t.jsx(S,{label:"Gov Debt",value:Math.abs(e.govDebt||0),format:"currency",color:(e.govDebt||0)>1e3?"#ef4444":"#64748b"})]})]})}function V(e){return e==null||isNaN(e)?"0":Math.abs(e)>=1e9?(e/1e9).toFixed(1)+"B":Math.abs(e)>=1e6?(e/1e6).toFixed(1)+"M":Math.abs(e)>=1e3?(e/1e3).toFixed(1)+"K":Math.round(e).toString()}const Ve=[{id:"incomeTax",name:"Income Tax",category:"fiscal",type:"slider",min:0,max:.6,step:.01,format:"percent",icon:"ðŸ›ï¸",description:"Tax on worker wages. Funds public spending. Too high reduces work incentive.",tradeoff:"â†‘ Revenue but â†“ Worker take-home pay"},{id:"corporateTax",name:"Corporate Tax",category:"fiscal",type:"slider",min:0,max:.5,step:.01,format:"percent",icon:"ðŸ¢",description:"Tax on business profits. High rates may deter investment.",tradeoff:"â†‘ Revenue but â†“ Business investment"},{id:"minWage",name:"Minimum Wage",category:"labor",type:"slider",min:0,max:30,step:1,format:"currency",icon:"ðŸ’¼",description:"Floor on wages. Protects workers but may price out low-skill labor.",tradeoff:"â†‘ Worker wages but â†‘ Unemployment risk"},{id:"ubi",name:"Universal Basic Income",category:"welfare",type:"slider",min:0,max:500,step:10,format:"currency",icon:"ðŸŽ",description:"Unconditional payment to all citizens. Eliminates poverty floor. Very expensive.",tradeoff:"â†‘ Equality but â†‘â†‘ Government spending"},{id:"interestRate",name:"Interest Rate",category:"monetary",type:"slider",min:0,max:.2,step:.005,format:"percent",icon:"ðŸ¦",description:"Cost of borrowing money. High rates fight inflation but slow growth.",tradeoff:"â†‘ Fights inflation but â†“ Business investment"},{id:"antiMonopoly",name:"Anti-Monopoly Laws",category:"regulation",type:"toggle",icon:"âš–ï¸",description:"Break up businesses that dominate a market. Prevents price gouging.",tradeoff:"â†‘ Competition but â†“ Economies of scale"},{id:"educationFunding",name:"Education Spending",category:"public",type:"slider",min:0,max:1,step:.05,format:"percent",icon:"ðŸ“š",description:"Invests in workforce quality over time. Slow payoff, lasting effect.",tradeoff:"â†‘ Long-term productivity but â†‘ Government spending now"},{id:"unemploymentBenefit",name:"Unemployment Benefits",category:"welfare",type:"slider",min:0,max:300,step:10,format:"currency",icon:"ðŸ›¡ï¸",description:"Payments to unemployed workers. Maintains demand but may reduce job search urgency.",tradeoff:"â†‘ Stability but may â†‘ Unemployment duration"},{id:"priceControlFood",name:"Food Price Controls",category:"regulation",type:"toggle",icon:"ðŸŒ¾",description:"Caps food prices to protect the poor. May cause shortages if price is too low.",tradeoff:"â†‘ Affordability but â†“ Farm investment"},{id:"priceControlHousing",name:"Rent Controls",category:"regulation",type:"toggle",icon:"ðŸ ",description:"Limits housing rent increases. Helps existing tenants, discourages new supply.",tradeoff:"â†‘ Affordability but â†“ New housing construction"},{id:"printMoney",name:"Quantitative Easing",category:"monetary",type:"slider",min:0,max:50,step:1,format:"number",icon:"ðŸ–¨ï¸",description:"Inject money into the economy. Boosts demand but causes inflation.",tradeoff:"â†‘ Short-term demand but â†‘â†‘ Inflation risk"},{id:"publicHealthcare",name:"Public Healthcare",category:"public",type:"toggle",icon:"ðŸ¥",description:"Government-funded health. Improves health, reduces death rate, increases happiness.",tradeoff:"â†‘ Health + happiness but â†‘â†‘ Government spending"},{id:"wealthTax",name:"Wealth Tax",category:"fiscal",type:"slider",min:0,max:.05,step:.001,format:"percent",icon:"ðŸ’Ž",description:"Annual tax on total wealth above threshold. Directly reduces inequality.",tradeoff:"â†‘ Equality but â†“ Capital accumulation"},{id:"openBorders",name:"Open Immigration",category:"labor",type:"toggle",icon:"ðŸŒ",description:"Allow skilled immigrants. Boosts labor supply and productivity, may suppress wages.",tradeoff:"â†‘ Productivity but â†‘ Job competition"},{id:"subsidiesFarming",name:"Farm Subsidies",category:"fiscal",type:"toggle",icon:"ðŸšœ",description:"Government support for food production. Lowers food prices but costs taxpayers.",tradeoff:"â†‘ Food supply + lower prices but â†‘ Spending"}],Xe={fiscal:{label:"Fiscal Policy",color:"#3b82f6"},monetary:{label:"Monetary Policy",color:"#f59e0b"},labor:{label:"Labor Market",color:"#22c55e"},welfare:{label:"Welfare",color:"#ec4899"},regulation:{label:"Regulation",color:"#8b5cf6"},public:{label:"Public Services",color:"#06b6d4"}};function Ze({policy:e,value:r,onChange:o}){const s=n=>e.format==="percent"?(n*100).toFixed(0)+"%":e.format==="currency"?"$"+n:n;return t.jsxs("div",{className:"group",children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-sm",children:e.icon}),t.jsx("span",{className:"text-xs text-[#e2e8f0] font-mono",children:e.name})]}),t.jsx("span",{className:"text-xs font-bold font-mono text-[#6366f1]",children:s(r)})]}),t.jsx("input",{type:"range",min:e.min,max:e.max,step:e.step,value:r,onChange:n=>o(e.id,parseFloat(n.target.value)),className:"w-full h-1.5 rounded-full appearance-none cursor-pointer",style:{background:`linear-gradient(to right, #6366f1 0%, #6366f1 ${(r-e.min)/(e.max-e.min)*100}%, #1e1e2e ${(r-e.min)/(e.max-e.min)*100}%, #1e1e2e 100%)`},title:e.description}),t.jsx("div",{className:"hidden group-hover:block text-[10px] text-[#475569] mt-1 leading-tight",children:e.tradeoff})]})}function Je({policy:e,value:r,onChange:o}){return t.jsxs("div",{className:"flex items-center justify-between group",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-sm",children:e.icon}),t.jsx("span",{className:"text-xs text-[#e2e8f0] font-mono",children:e.name})]}),t.jsx("button",{onClick:()=>o(e.id,!r),className:`relative w-9 h-5 rounded-full transition-colors duration-200 flex-shrink-0 ${r?"bg-[#6366f1]":"bg-[#334155]"}`,children:t.jsx("span",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform duration-200 ${r?"translate-x-4":"translate-x-0.5"}`})})]})}function Qe({policies:e,onPolicyChange:r}){const[o,s]=c.useState("fiscal"),[n,i]=c.useState(!0),a=Ve.filter(l=>l.category===o);return t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"text-xs uppercase tracking-widest text-[#64748b] font-mono",children:"Policy Controls"}),t.jsx("button",{onClick:()=>i(!n),className:"text-[#475569] hover:text-[#e2e8f0] text-xs",children:n?"â–¼":"â–¶"})]}),n&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:Object.entries(Xe).map(([l,u])=>t.jsx("button",{onClick:()=>s(l),className:`text-[10px] px-2 py-0.5 rounded font-mono transition-colors ${o===l?"text-white":"text-[#475569] hover:text-[#94a3b8]"}`,style:{backgroundColor:o===l?u.color+"33":"transparent",borderColor:u.color+"44",border:"1px solid"},children:u.label},l))}),t.jsx("div",{className:"flex flex-col gap-3 overflow-y-auto flex-1",children:a.map(l=>t.jsx("div",{children:l.type==="slider"?t.jsx(Ze,{policy:l,value:(e==null?void 0:e[l.id])??0,onChange:r}):t.jsx(Je,{policy:l,value:(e==null?void 0:e[l.id])??!1,onChange:r})},l.id))})]})]})}const et=[{label:"1Ã—",value:1,title:"Slow â€” watch individual agents"},{label:"5Ã—",value:5,title:"Normal play"},{label:"20Ã—",value:20,title:"Fast-forward"},{label:"Max",value:60,title:"Stress test"}];function tt({paused:e,speed:r,onPause:o,onResume:s,onReset:n,onSpeedChange:i,onScenarioOpen:a,onShockMe:l,scenarioName:u,year:d,narratorEnabled:m,narratorLoading:f,onNarratorToggle:h}){const[p,w]=c.useState(!1),j=()=>{navigator.clipboard&&(navigator.clipboard.writeText(window.location.href),w(!0),setTimeout(()=>w(!1),2e3))};return t.jsxs("header",{className:"flex items-center justify-between px-4 py-2 bg-[#0a0a0f] border-b border-[#1e1e2e] flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-lg",children:"ðŸ¾"}),t.jsx("span",{className:"text-[#e2e8f0] font-bold font-mono text-sm hidden sm:block",children:"EconSim"})]}),t.jsxs("button",{onClick:a,className:"text-xs font-mono text-[#6366f1] hover:text-[#818cf8] border border-[#6366f133] hover:border-[#6366f166] rounded px-2 py-1 transition-colors",children:[u||"Free Market"," â–¾"]}),d!==void 0&&t.jsxs("span",{className:"text-[#475569] text-xs font-mono",children:["Year ",d]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex items-center gap-0.5 bg-[#12121a] border border-[#1e1e2e] rounded px-1",children:et.map(x=>t.jsx("button",{onClick:()=>i(x.value),title:x.title,className:`text-xs font-mono px-2 py-1 rounded transition-colors ${r===x.value?"bg-[#6366f1] text-white":"text-[#64748b] hover:text-[#e2e8f0]"}`,children:x.label},x.value))}),t.jsx("button",{onClick:e?s:o,className:`flex items-center gap-1 text-xs font-mono px-3 py-1.5 rounded border transition-colors
            border-[#1e1e2e] text-[#e2e8f0] hover:border-[#6366f1] hover:text-[#6366f1]`,children:e?"â–¶ Play":"â¸ Pause"}),t.jsx("button",{onClick:n,className:`text-xs font-mono px-3 py-1.5 rounded border border-[#1e1e2e] text-[#64748b]
            hover:border-[#ef4444] hover:text-[#ef4444] transition-colors`,title:"Reset simulation",children:"â†º Reset"}),t.jsx("button",{onClick:l,className:`text-xs font-mono px-3 py-1.5 rounded border border-[#f59e0b33] text-[#f59e0b]
            hover:bg-[#f59e0b11] transition-colors`,title:"Trigger a random economic event",children:"âš¡ Shock"}),t.jsx("button",{onClick:j,className:`text-xs font-mono px-3 py-1.5 rounded border border-[#1e1e2e] text-[#64748b]
            hover:border-[#22c55e] hover:text-[#22c55e] transition-colors`,title:"Copy shareable link",children:p?"âœ“ Copied!":"ðŸ”— Share"}),t.jsx("button",{onClick:h,disabled:f,className:`text-xs font-mono px-3 py-1.5 rounded border transition-colors ${m?"border-[#06b6d4] text-[#06b6d4] bg-[#06b6d411]":"border-[#1e1e2e] text-[#475569] hover:border-[#06b6d4] hover:text-[#06b6d4]"} ${f?"opacity-50 cursor-wait":""}`,title:m?"Disable narration":"Enable AI narration (loads ~40MB model)",children:f?"â³ Loadingâ€¦":m?"ðŸ”Š Voice On":"ðŸ”‡ Voice"})]})]})}const ot={freeMarket:{id:"freeMarket",name:"Free Market Utopia",subtitle:"No rules. Pure capitalism.",description:"Zero regulation. No minimum wage, no taxes, no safety net. Watch monopolies form naturally and see who wins â€” and who gets left behind.",icon:"ðŸ¦…",difficulty:"Observe",color:"#3b82f6",policies:{incomeTax:0,corporateTax:0,minWage:0,ubi:0,interestRate:.02,antiMonopoly:!1,educationFunding:0,unemploymentBenefit:0,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:20,wealthMultiplier:1.2,wealthInequality:1.5,avgSkill:.5,lesson:"Natural monopolies emerge quickly. The rich get richer. But GDP grows fast at first."},debtSpiral:{id:"debtSpiral",name:"The Debt Spiral",subtitle:"Borrowed too much. Now what?",description:"The government spent heavily on social programs. Debt is high, deficit is growing. Austerity or default â€” pick your poison.",icon:"ðŸ’¸",difficulty:"Hard",color:"#ef4444",policies:{incomeTax:.45,corporateTax:.35,minWage:15,ubi:200,interestRate:.12,antiMonopoly:!0,educationFunding:.8,unemploymentBenefit:150,priceControlFood:!1,priceControlHousing:!1,printMoney:5,publicHealthcare:!0,wealthTax:.02,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:18,wealthMultiplier:.8,wealthInequality:.8,avgSkill:.55,startGovDebt:5e3,lesson:"Cutting programs causes pain now. Keeping them causes pain later. The political economy of austerity."},techDisruption:{id:"techDisruption",name:"Tech Disruption",subtitle:"Automation is coming for jobs.",description:"A stable, balanced economy. Then a tech breakthrough hits â€” half the jobs can be automated. Will you adapt or collapse?",icon:"ðŸ¤–",difficulty:"Medium",color:"#8b5cf6",policies:{incomeTax:.28,corporateTax:.21,minWage:12,ubi:0,interestRate:.05,antiMonopoly:!1,educationFunding:.5,unemploymentBenefit:80,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:20,wealthMultiplier:1,wealthInequality:1,avgSkill:.5,scheduledEvent:{type:"techBreakthrough",atTick:200},lesson:"Automation creates wealth but destroys jobs. UBI or retraining â€” which policy saves more people?"}},nt=Object.values(ot);function rt({scenario:e,onSelect:r,current:o}){const s=o===e.id;return t.jsx("button",{onClick:()=>r(e.id),className:`w-full text-left p-4 rounded-xl border transition-all ${s?"border-opacity-60 bg-opacity-10":"border-[#1e1e2e] bg-[#12121a] hover:border-[#334155]"}`,style:{borderColor:s?e.color:void 0,backgroundColor:s?e.color+"10":void 0},children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-3xl",children:e.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"text-white font-bold text-sm",children:e.name}),t.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded font-mono",style:{backgroundColor:e.color+"22",color:e.color},children:e.difficulty})]}),t.jsx("p",{className:"text-[#94a3b8] text-xs italic mb-2",children:e.subtitle}),t.jsx("p",{className:"text-[#64748b] text-xs leading-relaxed",children:e.description}),t.jsxs("div",{className:"mt-2 text-[10px] font-mono text-[#475569] border-l-2 pl-2",style:{borderColor:e.color+"66"},children:["ðŸ’¡ ",e.lesson]})]})]})})}function st({current:e,onSelect:r,onClose:o}){return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm",children:t.jsxs("div",{className:"bg-[#0d0d14] border border-[#1e1e2e] rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-white font-bold text-xl font-mono",children:"Choose Scenario"}),t.jsx("p",{className:"text-[#64748b] text-sm mt-1",children:"Each scenario starts from a different economic reality. Your choices determine what happens next."})]}),t.jsx("button",{onClick:o,className:"text-[#475569] hover:text-white text-xl leading-none",children:"âœ•"})]}),t.jsx("div",{className:"flex flex-col gap-3",children:nt.map(s=>t.jsx(rt,{scenario:s,current:e,onSelect:n=>{r(n),o()}},s.id))}),t.jsx("div",{className:"mt-4 text-center text-[#475569] text-xs font-mono",children:"Changing scenario resets the simulation"})]})})}const it={monopoly_forming:{title:"Monopoly Alert",emoji:"ðŸ¢",body:"One business now controls over 60% of its market. Without competition, prices rise and quality drops.",realWorld:"Standard Oil controlled 91% of US oil in 1904. The Sherman Antitrust Act (1890) broke it up. Today, similar debates surround Big Tech.",color:"#ef4444"},high_inequality:{title:"Inequality Spike",emoji:"ðŸ“Š",body:"Wealth concentration is extreme. The Gini coefficient measures this: 0 = perfect equality, 1 = one person owns everything.",realWorld:"The US Gini is ~0.41. Scandinavia: ~0.28. Brazil: ~0.53. High inequality correlates with lower social mobility and higher crime.",color:"#f59e0b"},high_unemployment:{title:"Unemployment Crisis",emoji:"ðŸ“‰",body:"Mass unemployment creates a vicious cycle: fewer workers â†’ less spending â†’ fewer sales â†’ more layoffs.",realWorld:"Keynes' insight: in a recession, government spending can break this cycle by creating demand when the private sector won't.",color:"#ef4444"},inflation_spiral:{title:"Inflation Warning",emoji:"ðŸ”¥",body:"Prices are rising faster than wages. Your money buys less each day. The purchasing power of savings erodes.",realWorld:"Zimbabwe's hyperinflation (2008) reached 89.7 sextillion % monthly. The cure: independent central banks that raise rates.",color:"#f97316"},min_wage_tradeoff:{title:"Minimum Wage Tradeoff",emoji:"âš–ï¸",body:"A higher minimum wage raised living standards â€” but some businesses can no longer afford to hire.",realWorld:"Seattle's $15 minimum wage (2015) study: restaurant employment rose in some areas, fell in others. Context matters enormously.",color:"#6366f1"},budget_surplus:{title:"Fiscal Surplus!",emoji:"ðŸ’°",body:"Tax revenue exceeds spending. The government can pay down debt or invest in future growth.",realWorld:"The US ran surpluses 1998-2001. Norway's oil fund (built from surpluses) now exceeds $1.4 trillion.",color:"#22c55e"},stagnation:{title:"Stagflation Risk",emoji:"ðŸ˜°",body:"The economy is shrinking AND unemployment is rising â€” the worst of both worlds. Traditional policy tools conflict.",realWorld:"The 1970s oil crisis created stagflation. Volcker killed it (1980) by raising interest rates to 20% â€” causing a painful recession.",color:"#8b5cf6"},poverty_trap:{title:"Poverty Trap",emoji:"ðŸª¤",body:"Workers in poverty can't afford better nutrition, education, or healthcare â€” which keeps them in poverty.",realWorld:"The poverty trap: every dollar earned reduces welfare by $1. Effective marginal tax rates for the poor can exceed 80%.",color:"#ef4444"},dutch_disease:{title:"Resource Dependency",emoji:"â›½",body:"One sector dominates, crowding out others. High-earning sectors attract all workers, leaving other industries struggling.",realWorld:`The "Dutch Disease": Netherlands' 1960s natural gas discovery boosted the guilder, making exports uncompetitive.`,color:"#f59e0b"},ubi_effect:{title:"UBI Effect Observed",emoji:"ðŸŽ¯",body:"Universal Basic Income is reducing poverty and providing security. Some people are taking more risks â€” starting businesses.",realWorld:"Finland's UBI experiment (2017-18): recipients reported better wellbeing, mental health improved. Employment was neutral.",color:"#22c55e"}};function at({insight:e,onDismiss:r}){const[o,s]=c.useState(!1);if(c.useEffect(()=>{e&&s(!0)},[e]),!e||!o)return null;const n=it[e.id]||{title:e.title,emoji:"ðŸ’¡",body:e.body,realWorld:e.realWorld,color:"#6366f1"},i=()=>{s(!1),setTimeout(()=>r==null?void 0:r(),300)};return t.jsx("div",{className:`fixed bottom-6 right-6 z-40 max-w-sm transition-all duration-300 ${o?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:t.jsx("div",{className:"bg-[#0d0d14] border rounded-xl p-4 shadow-2xl",style:{borderColor:n.color+"66"},children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl flex-shrink-0",children:n.emoji}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-white font-bold text-sm",children:n.title}),t.jsx("button",{onClick:i,className:"text-[#475569] hover:text-white text-sm ml-2",children:"âœ•"})]}),t.jsx("p",{className:"text-[#94a3b8] text-xs leading-relaxed mb-2",children:n.body}),t.jsxs("div",{className:"text-[10px] text-[#64748b] leading-relaxed border-l-2 pl-2 italic",style:{borderColor:n.color+"66"},children:["ðŸŒ ",n.realWorld]}),t.jsxs("div",{className:"text-[9px] text-[#334155] mt-2 font-mono",children:["Year ",e.year," Â· ",e.id]})]})]})})})}const lt={working:"Employed",unemployed:"Unemployed",child:"Child",retired:"Retired",owner:"Business Owner",dead:"Deceased"},ct={working:"#22c55e",unemployed:"#ef4444",child:"#94a3b8",retired:"#64748b",owner:"#f59e0b",dead:"#374151"};function dt({agent:e,onClose:r}){if(!e)return null;const o=Math.floor(e.age/52),s=ee(e.wealth);return t.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-40 bg-[#0d0d14] border border-[#1e1e2e] rounded-xl p-4 shadow-2xl max-w-xs w-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 rounded-full border border-white/20",style:{backgroundColor:s}}),t.jsxs("span",{className:"text-white font-bold font-mono text-sm",children:["Agent #",e.id]})]}),t.jsx("button",{onClick:r,className:"text-[#475569] hover:text-white text-sm",children:"âœ•"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5 text-xs mb-3",children:[t.jsx(k,{label:"Age",value:`${o} yrs`}),t.jsx(k,{label:"Status",value:lt[e.state]||e.state,color:ct[e.state]}),t.jsx(k,{label:"Wealth",value:`$${Math.round(e.wealth)}`,color:s}),t.jsx(k,{label:"Wage",value:e.wage>0?`$${e.wage.toFixed(1)}/tick`:"â€”"}),t.jsx(k,{label:"Skill",value:`${(e.skill*100).toFixed(0)}%`}),t.jsx(k,{label:"Education",value:`${(e.education*100).toFixed(0)}%`}),t.jsx(k,{label:"Health",value:`${(e.health*100).toFixed(0)}%`}),t.jsx(k,{label:"Happiness",value:`${(e.happiness*100).toFixed(0)}%`,color:e.happiness>.6?"#22c55e":e.happiness<.3?"#ef4444":"#e2e8f0"}),e.jobSector&&t.jsx(k,{label:"Sector",value:e.jobSector}),t.jsx(k,{label:"Class",value:e.socialClass,color:e.socialClass==="rich"?"#f59e0b":e.socialClass==="poor"?"#ef4444":"#e2e8f0"})]}),e.events&&e.events.length>0&&t.jsxs("div",{children:[t.jsx("div",{className:"text-[#475569] text-[10px] uppercase tracking-wider font-mono mb-1.5",children:"Life History"}),t.jsx("ul",{className:"space-y-0.5 max-h-24 overflow-y-auto",children:e.events.map((n,i)=>t.jsxs("li",{className:"text-[10px] text-[#64748b] font-mono leading-tight",children:["â€¢ ",n]},i))})]})]})}function k({label:e,value:r,color:o}){return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-[#475569] font-mono",children:e}),t.jsx("span",{className:"font-mono font-medium",style:{color:o||"#e2e8f0"},children:r})]})}function ut(e){return e<100?"<$100":e<300?"$100-300":e<800?"$300-800":e<2e3?"$800-2K":e<5e3?"$2K-5K":">$5K"}const X=["<$100","$100-300","$300-800","$800-2K","$2K-5K",">$5K"],ft=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#f59e0b"];function ht({agents:e}){const r=c.useMemo(()=>{if(!(e!=null&&e.length))return[];const s={};X.forEach(n=>{s[n]=0});for(const n of e){if(!n.alive)continue;const i=ut(n.wealth);s[i]=(s[i]||0)+1}return X.map((n,i)=>({name:n,count:s[n]||0,fill:ft[i]}))},[e]),o=c.useMemo(()=>{if(!(e!=null&&e.length))return[];const s=e.filter(n=>n.alive).map(n=>Math.max(0,n.wealth));return Pe(s,20)},[e]);return t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:"Wealth Distribution"}),t.jsx("div",{className:"h-28",children:t.jsx(O,{width:"100%",height:"100%",children:t.jsxs(ge,{data:r,margin:{top:0,right:0,bottom:0,left:-20},children:[t.jsx(H,{dataKey:"name",tick:{fontSize:8,fill:"#475569",fontFamily:"monospace"},axisLine:!1,tickLine:!1}),t.jsx(q,{tick:{fontSize:8,fill:"#475569",fontFamily:"monospace"},axisLine:!1,tickLine:!1}),t.jsx(z,{contentStyle:{background:"#12121a",border:"1px solid #1e1e2e",fontSize:10},labelStyle:{color:"#e2e8f0"},itemStyle:{color:"#6366f1"}}),t.jsx(ye,{dataKey:"count",radius:[2,2,0,0],children:r.map((s,n)=>t.jsx(ve,{fill:s.fill},n))})]})})})]}),o.length>2&&t.jsxs("div",{children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:"Lorenz Curve"}),t.jsx("div",{className:"h-24",children:t.jsx(O,{width:"100%",height:"100%",children:t.jsxs(we,{data:o,margin:{top:0,right:0,bottom:0,left:-20},children:[t.jsx(H,{dataKey:"population",tick:{fontSize:8,fill:"#475569"},axisLine:!1,tickLine:!1,tickFormatter:s=>s+"%"}),t.jsx(q,{tick:{fontSize:8,fill:"#475569"},axisLine:!1,tickLine:!1,tickFormatter:s=>s+"%"}),t.jsx(K,{data:[{population:0,perfect:0},{population:100,perfect:100}],type:"linear",dataKey:"perfect",stroke:"#334155",strokeWidth:1,dot:!1,strokeDasharray:"3 3"}),t.jsx(K,{type:"monotone",dataKey:"wealth",stroke:"#6366f1",strokeWidth:1.5,dot:!1,isAnimationActive:!1}),t.jsx(z,{contentStyle:{background:"#12121a",border:"1px solid #1e1e2e",fontSize:10},formatter:s=>s.toFixed(1)+"%"})]})})}),t.jsx("div",{className:"text-[10px] text-[#334155] text-center font-mono",children:"Area between lines = Gini coefficient"})]})]})}function mt(e,r){const o={incomeTax:[0,.6],corporateTax:[0,.5],minWage:[0,50],ubi:[0,1e3],interestRate:[0,.2],educationFunding:[0,1],unemploymentBenefit:[0,500],printMoney:[0,100],wealthTax:[0,.05]};if(e in o){const[s,n]=o[e];return Ie(Number(r),s,n)}return r}const te="ecomsim_save";function pt(e){try{localStorage.setItem(te+"_scenario",e)}catch{}}function xt(){try{return localStorage.getItem(te+"_scenario")||"freeMarket"}catch{return"freeMarket"}}const bt="modulepreload",gt=function(e){return"/ecomsim/"+e},Z={},yt=function(r,o,s){let n=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(o.map(u=>{if(u=gt(u),u in Z)return;Z[u]=!0;const d=u.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${m}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":bt,d||(f.as="script"),f.crossOrigin="",f.href=u,l&&f.setAttribute("nonce",l),document.head.appendChild(f),d)return new Promise((h,p)=>{f.addEventListener("load",h),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return n.then(a=>{for(const l of a||[])l.status==="rejected"&&i(l.reason);return r().catch(i)})};let E=null,A=!1,W=[],L=null;const vt="af_sky",wt="onnx-community/Kokoro-82M-v1.0-ONNX",oe={monopoly_forming:"Warning. One company now dominates the market. Without competition, prices are rising and innovation is slowing.",high_inequality:"Inequality has reached extreme levels. The Gini coefficient indicates the top few now own most of the wealth.",high_unemployment:"Mass unemployment is spreading. A vicious cycle: fewer workers means less spending, which means even more layoffs.",inflation_spiral:"Inflation warning. Prices are rising faster than wages. Your population's purchasing power is eroding.",min_wage_tradeoff:"Minimum wage tradeoff observed. Living standards improved, but some small businesses can no longer afford to hire.",budget_surplus:"Fiscal surplus achieved. Tax revenue now exceeds government spending.",stagnation:"Stagflation risk. The economy is shrinking while unemployment rises â€” the classic policy dilemma.",poverty_trap:"Poverty trap forming. Workers in poverty cannot afford education or healthcare, keeping them trapped.",ubi_effect:"Universal Basic Income is reducing poverty. Some residents are using the security to start new businesses.",pandemic:"A pandemic has struck. Health is dropping, businesses are closing, and workers are staying home.",cropFailure:"Crop failure. Poor harvests are causing food prices to spike. The poorest citizens are suffering most.",techBreakthrough:"Technology breakthrough! Productivity in the tech sector has doubled â€” but automation is threatening other jobs.",financialBubble:"A financial bubble is growing. Asset prices are inflating rapidly â€” and history suggests what comes next.",corruption:"Corruption scandal. Government tax revenue is being diverted. Public services are beginning to collapse.",immigrationWave:"An immigration wave has arrived. Skilled workers are boosting productivity, but job competition is increasing.",recession:"Recession begins. Consumer demand is falling, businesses are struggling, and unemployment is rising.",boom:"Economic boom! Consumer confidence has surged. Businesses are hiring and wages are growing."};async function ne(){if(E)return E;if(A)return new Promise(e=>W.push(e));A=!0;try{const{KokoroTTS:e}=await yt(async()=>{const{KokoroTTS:r}=await import("./kokoro-CqRZUw5m.js");return{KokoroTTS:r}},[]);return E=await e.from_pretrained(wt,{dtype:"q4",device:"wasm"}),W.forEach(r=>r(E)),W=[],A=!1,E}catch(e){return console.warn("[Narrator] Failed to load Kokoro TTS:",e),A=!1,null}}function jt(){return L||(L=new(window.AudioContext||window.webkitAudioContext)),L}let P=null;async function _(e,r={}){if(e){re();try{const o=await ne();if(!o)return;const s=await o.generate(e,{voice:r.voice||vt}),n=jt(),i=n.createBuffer(1,s.audio.length,s.sampling_rate);i.copyToChannel(s.audio,0);const a=n.createBufferSource();return a.buffer=i,r.rate&&(a.playbackRate.value=r.rate),a.connect(n.destination),a.start(),P=a,new Promise(l=>{a.onended=()=>{P=null,l()}})}catch(o){console.warn("[Narrator] Narration error:",o)}}}function re(){if(P){try{P.stop()}catch{}P=null}}function kt(e){const r=oe[e];r&&_(r)}function Nt(e){const r=oe[e];r&&_(r)}function St(){ne()}function Ct(){return E!==null}function Tt(){const[e,r]=c.useState(!1),[o,s]=c.useState(!1),[n,i]=c.useState(!1),a=c.useRef(!1),l=c.useCallback(async()=>{r(!0),a.current=!0,s(!0),St();const h=setInterval(()=>{Ct()&&(i(!0),s(!1),clearInterval(h),_("Economy simulator narrator ready."))},500);setTimeout(()=>clearInterval(h),3e4)},[]),u=c.useCallback(()=>{r(!1),a.current=!1,re()},[]),d=c.useCallback(h=>{a.current&&kt(h)},[]),m=c.useCallback(h=>{a.current&&Nt(h)},[]),f=c.useCallback(h=>{a.current&&_(h)},[]);return{enabled:e,loading:o,ready:n,enable:l,disable:u,onInsight:d,onEvent:m,speak:f}}function Et(){const e=Tt(),r=c.useRef(null),[o,s]=c.useState(null),[n,i]=c.useState(!1),[a,l]=c.useState(5),[u,d]=c.useState(xt()),[m,f]=c.useState(!1),[h,p]=c.useState(null),[w,j]=c.useState([]),[x,g]=c.useState(null),[v,M]=c.useState("dashboard");c.useEffect(()=>{const b=new Worker(new URL("/ecomsim/assets/simWorker-BDaCscUB.js",import.meta.url),{type:"module"});return b.addEventListener("message",C=>{const{type:R,state:T,event:U,insight:F}=C.data;switch(R){case"STATE_UPDATE":s(T);break;case"EVENT":console.log("[Event]",U.name),e.onEvent(U.type);break;case"INSIGHT":p(F),j(me=>[F,...me].slice(0,20)),e.onInsight(F.id);break}}),b.postMessage({type:"INIT",scenarioId:u}),r.current=b,()=>b.terminate()},[]);const y=c.useCallback(b=>{var C;(C=r.current)==null||C.postMessage(b)},[]),se=c.useCallback(()=>{i(!0),y({type:"PAUSE"})},[y]),ie=c.useCallback(()=>{i(!1),y({type:"RESUME"})},[y]),ae=c.useCallback(()=>{s(null),p(null),g(null),y({type:"RESET",scenarioId:u}),n&&(i(!1),y({type:"RESUME"}))},[y,u,n]),le=c.useCallback(b=>{l(b),y({type:"SET_SPEED",speed:b})},[y]),ce=c.useCallback((b,C)=>{const R=mt(b,C);y({type:"SET_POLICY",policy:b,value:R}),s(T=>T&&{...T,policies:{...T.policies,[b]:R}})},[y]),de=c.useCallback(b=>{d(b),pt(b),s(null),p(null),g(null),y({type:"RESET",scenarioId:b}),i(!1)},[y]),ue=c.useCallback(()=>{y({type:"SET_POLICY",policy:"_forceShock",value:!0})},[y]),fe=c.useCallback(b=>{g(b)},[]),he=o?u==="freeMarket"?"Free Market":u==="debtSpiral"?"Debt Spiral":"Tech Disruption":"Loading...";return t.jsxs("div",{className:"h-screen flex flex-col bg-[#0a0a0f] text-[#e2e8f0] overflow-hidden font-mono",children:[t.jsx(tt,{paused:n,speed:a,onPause:se,onResume:ie,onReset:ae,onSpeedChange:le,onScenarioOpen:()=>f(!0),onShockMe:ue,scenarioName:he,year:o==null?void 0:o.year,narratorEnabled:e.enabled,narratorLoading:e.loading,onNarratorToggle:e.enabled?e.disable:e.enable}),t.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[t.jsxs("div",{className:"flex-1 relative bg-[#0a0a0f]",children:[t.jsx(qe,{simState:o,onAgentClick:fe,selectedAgentId:x==null?void 0:x.id}),x&&t.jsx(dt,{agent:x,onClose:()=>g(null)})]}),t.jsxs("div",{className:"w-72 flex flex-col border-l border-[#1e1e2e] bg-[#0a0a0f]",children:[t.jsx("div",{className:"flex border-b border-[#1e1e2e]",children:["dashboard","policies","histogram"].map(b=>t.jsx("button",{onClick:()=>M(b),className:`flex-1 py-2 text-xs font-mono capitalize transition-colors ${v===b?"text-[#6366f1] border-b border-[#6366f1]":"text-[#475569] hover:text-[#94a3b8]"}`,children:b},b))}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-3",children:[v==="dashboard"&&t.jsx(Ye,{metrics:o==null?void 0:o.metrics,market:o==null?void 0:o.market,activeEvents:o==null?void 0:o.activeEvents}),v==="policies"&&t.jsx(Qe,{policies:o==null?void 0:o.policies,onPolicyChange:ce}),v==="histogram"&&t.jsx(ht,{agents:o==null?void 0:o.agents})]})]})]}),h&&t.jsx(at,{insight:h,onDismiss:()=>p(null)}),m&&t.jsx(st,{current:u,onSelect:de,onClose:()=>f(!1)})]})}$.createRoot(document.getElementById("root")).render(t.jsx(je.StrictMode,{children:t.jsx(Et,{})}));
