import{r as u,a as pt,R as S,A as Z,b as Q,B as Ue,X as M,Y as P,T as F,c as qe,C as je,L as ae,d as W,e as _,f as Y,S as mt,g as xt,h as gt}from"./charts-CV9kRm1S.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function o(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=o(a);fetch(a.href,s)}})();var Ye={exports:{}},pe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bt=u,yt=Symbol.for("react.element"),vt=Symbol.for("react.fragment"),wt=Object.prototype.hasOwnProperty,jt=bt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kt={key:!0,ref:!0,__self:!0,__source:!0};function ze(e,n,o){var i,a={},s=null,r=null;o!==void 0&&(s=""+o),n.key!==void 0&&(s=""+n.key),n.ref!==void 0&&(r=n.ref);for(i in n)wt.call(n,i)&&!kt.hasOwnProperty(i)&&(a[i]=n[i]);if(e&&e.defaultProps)for(i in n=e.defaultProps,n)a[i]===void 0&&(a[i]=n[i]);return{$$typeof:yt,type:e,key:s,ref:r,props:a,_owner:jt.current}}pe.Fragment=vt;pe.jsx=ze;pe.jsxs=ze;Ye.exports=pe;var t=Ye.exports,we={},Re=pt;we.createRoot=Re.createRoot,we.hydrateRoot=Re.hydrateRoot;function Nt(e,n,o){return Math.max(n,Math.min(o,e))}function Ct(e,n=20){if(!e||e.length===0)return[];const o=[...e].sort((s,r)=>s-r),i=o.reduce((s,r)=>s+r,0);if(i===0)return[];const a=[{population:0,wealth:0}];for(let s=1;s<=n;s++){const r=Math.floor(s/n*o.length),l=o.slice(0,r).reduce((c,d)=>c+d,0);a.push({population:s/n*100,wealth:l/i*100})}return a}const $=[{threshold:0,color:[220,38,38]},{threshold:100,color:[234,88,12]},{threshold:300,color:[100,116,139]},{threshold:800,color:[59,130,246]},{threshold:2e3,color:[6,182,212]},{threshold:5e3,color:[234,179,8]},{threshold:1e4,color:[251,191,36]}];function Ke(e){const n=Math.max(0,e);let o=$[0],i=$[$.length-1];for(let d=0;d<$.length-1;d++)if(n>=$[d].threshold&&n<$[d+1].threshold){o=$[d],i=$[d+1];break}const a=i.threshold-o.threshold,s=a>0?(n-o.threshold)/a:1,r=Math.round(o.color[0]+(i.color[0]-o.color[0])*s),l=Math.round(o.color[1]+(i.color[1]-o.color[1])*s),c=Math.round(o.color[2]+(i.color[2]-o.color[2])*s);return`rgb(${r},${l},${c})`}const ke={food:"#22c55e",housing:"#f59e0b",tech:"#6366f1",luxury:"#ec4899"},Tt=800,St=600,Mt=4;function Pt(e,n,o,i){for(const a of n)a.alive&&Ft(e,a,a.id===o,i)}function Ft(e,n,o,i){const{x:a,y:s,state:r,wealth:l,happiness:c,unrest:d,employed:p,isOwner:h,age:g}=n,m=Mt;e.save(),d>.5?(e.shadowColor="rgba(239,68,68,0.7)",e.shadowBlur=8):l>5e3&&(e.shadowColor="rgba(251,191,36,0.5)",e.shadowBlur=6);const x=Ke(l);if(e.beginPath(),h||r==="owner"?(e.moveTo(a,s-m*1.4),e.lineTo(a+m*1,s),e.lineTo(a,s+m*1.4),e.lineTo(a-m*1,s),e.closePath()):r==="child"||g<18*52?e.arc(a,s,m*.65,0,Math.PI*2):r==="retired"?e.rect(a-m*.9,s-m*.9,m*1.8,m*1.8):e.arc(a,s,m,0,Math.PI*2),e.fillStyle=x,e.fill(),r==="unemployed"?(e.strokeStyle="#ef4444",e.lineWidth=1.5,e.setLineDash([2,2]),e.stroke(),e.setLineDash([])):(p||h)&&(e.strokeStyle="rgba(255,255,255,0.6)",e.lineWidth=1,e.stroke()),l<100&&r!=="child"){const j=.3+.3*Math.sin(i*.1);e.strokeStyle=`rgba(239,68,68,${j})`,e.lineWidth=2,e.setLineDash([]),e.beginPath(),e.arc(a,s,m+3,0,Math.PI*2),e.stroke()}o&&(e.strokeStyle="#ffffff",e.lineWidth=2,e.setLineDash([]),e.beginPath(),e.arc(a,s,m+4,0,Math.PI*2),e.stroke()),e.restore()}function At(e,n,o,i=.12){e.save(),e.lineWidth=.5;for(const a of n){if(!a.alive||!a.employed||!a.employerId)continue;const s=o.find(r=>r.id===a.employerId);s&&(e.beginPath(),e.strokeStyle=`rgba(99,102,241,${i})`,e.moveTo(a.x,a.y),e.lineTo(s.x,s.y),e.stroke())}e.restore()}function It(e,n,o){for(const i of n)i.alive&&_t(e,i,o)}function _t(e,n,o){const{x:i,y:a,sector:s,employeeCount:r,radius:l,pulse:c,dominance:d,capital:p}=n,h=ke[s]||"#94a3b8";e.save(),d>.4?(e.shadowColor=h,e.shadowBlur=15+d*20):p>2e3&&(e.shadowColor=h,e.shadowBlur=8);const g=l||10;if(e.beginPath(),Ee(e,i,a,g),e.fillStyle=h+"33",e.fill(),e.strokeStyle=h,e.lineWidth=2,e.stroke(),e.fillStyle=h,e.font=`${Math.max(8,g*.8)}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(Rt[s]||"?",i,a),r>0&&(e.fillStyle="rgba(0,0,0,0.7)",e.beginPath(),e.arc(i+g*.8,a-g*.8,6,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff",e.font="7px sans-serif",e.fillText(r,i+g*.8,a-g*.8)),p<100){const m=.4+.4*Math.sin(o*.15);e.strokeStyle=`rgba(239,68,68,${m})`,e.lineWidth=2,e.beginPath(),Ee(e,i,a,g+4),e.stroke()}e.restore()}function Ee(e,n,o,i){e.beginPath();for(let a=0;a<6;a++){const s=Math.PI/3*a-Math.PI/6,r=n+i*Math.cos(s),l=o+i*Math.sin(s);a===0?e.moveTo(r,l):e.lineTo(r,l)}e.closePath()}const Rt={food:"ðŸŒ¾",housing:"ðŸ ",tech:"ðŸ’»",luxury:"ðŸ’Ž"};function Et(e,n,o,i){e.save();for(const a of n){if(!a.alive)continue;const s=ke[a.sector]||"#94a3b8",r=30+a.employeeCount*5,l=e.createRadialGradient(a.x,a.y,0,a.x,a.y,r);l.addColorStop(0,s+"15"),l.addColorStop(1,"transparent"),e.fillStyle=l,e.beginPath(),e.arc(a.x,a.y,r,0,Math.PI*2),e.fill()}e.restore()}const ne=[];function Bt(e,n){for(let o=0;o<6;o++){const i=Math.PI*2/6*o;ne.push({type:"sparkle",x:e,y:n,vx:Math.cos(i)*2,vy:Math.sin(i)*2,life:1,color:"#22c55e",size:3})}}function Dt(e,n){for(let o=0;o<8;o++){const i=Math.random()*Math.PI*2;ne.push({type:"fade",x:e+(Math.random()-.5)*10,y:n+(Math.random()-.5)*10,vx:Math.cos(i)*1.5,vy:Math.sin(i)*1.5,life:1,color:"#ef4444",size:2})}}function Wt(e){for(let n=ne.length-1;n>=0;n--){const o=ne[n];switch(e.save(),e.globalAlpha=o.life,o.type){case"sparkle":e.fillStyle=o.color,e.beginPath(),e.arc(o.x,o.y,o.size*o.life,0,Math.PI*2),e.fill(),o.x+=o.vx,o.y+=o.vy,o.vx*=.95,o.vy*=.95,o.life-=.04;break;case"fade":e.fillStyle=o.color,e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fill(),o.x+=o.vx,o.y+=o.vy,o.life-=.06;break;case"wave":e.strokeStyle=o.color,e.lineWidth=1.5,e.beginPath(),e.arc(o.x,o.y,o.radius,0,Math.PI*2),e.stroke(),o.radius=o.radius+(o.maxRadius-o.radius)*.08,o.life-=.03;break}e.restore(),o.life<=0&&ne.splice(n,1)}}function Gt({simState:e,onAgentClick:n,selectedAgentId:o}){const i=u.useRef(null),a=u.useRef(null),s=u.useRef(0),r=u.useRef(new Set),l=u.useCallback(()=>{const d=i.current;if(!d)return;const p=d.getContext("2d");s.current++;const h=s.current;if(p.fillStyle="#0a0a0f",p.fillRect(0,0,d.width,d.height),!e){p.fillStyle="#334155",p.font="14px monospace",p.textAlign="center",p.fillText("Initializing simulation...",d.width/2,d.height/2);return}const{agents:g=[],businesses:m=[]}=e,x=new Set(g.filter(v=>v.alive).map(v=>v.id)),j=r.current;for(const v of j)if(!x.has(v)){const y=g.find(T=>T.id===v);y&&Dt(y.x,y.y)}for(const v of x)if(!j.has(v)){const y=g.find(T=>T.id===v);y&&Bt(y.x,y.y)}r.current=x,Et(p,m,d.width,d.height),At(p,g,m),It(p,m,h),Pt(p,g,o,h),Wt(p),a.current=requestAnimationFrame(l)},[e,o]);u.useEffect(()=>(a.current=requestAnimationFrame(l),()=>{a.current&&cancelAnimationFrame(a.current)}),[l]);const c=u.useCallback(d=>{if(!(e!=null&&e.agents)||!n)return;const p=i.current,h=p.getBoundingClientRect(),g=p.width/h.width,m=p.height/h.height,x=(d.clientX-h.left)*g,j=(d.clientY-h.top)*m;let v=null,y=12;for(const T of e.agents){if(!T.alive)continue;const G=Math.sqrt((T.x-x)**2+(T.y-j)**2);G<y&&(y=G,v=T)}n(v)},[e,n]);return t.jsx("canvas",{ref:i,width:Tt,height:St,className:"w-full h-full cursor-crosshair",style:{imageRendering:"pixelated",display:"block"},onClick:c})}function H({label:e,value:n,unit:o="",trend:i,color:a="#6366f1",history:s=[],format:r="number"}){const l=u.useMemo(()=>r==="percent"?(n*100).toFixed(1)+"%":r==="currency"?"$"+Be(n):r==="index"?n.toFixed(1):Be(n),[n,r]),c=s.slice(-40).map((d,p)=>({i:p,v:d}));return t.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-lg p-3 flex flex-col gap-1",children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono",children:e}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsx("span",{className:"text-white text-xl font-bold font-mono",style:{color:a},children:l}),o&&t.jsx("span",{className:"text-[#64748b] text-xs mb-1",children:o}),i!==void 0&&t.jsxs("span",{className:`text-xs mb-1 ${i>=0?"text-green-400":"text-red-400"}`,children:[i>=0?"â†‘":"â†“"," ",Math.abs(i*100).toFixed(1),"%"]})]}),c.length>5&&t.jsx("div",{className:"h-8 w-full",children:t.jsx(S,{width:"100%",height:"100%",children:t.jsx(Z,{data:c,margin:{top:0,right:0,bottom:0,left:0},children:t.jsx(Q,{type:"monotone",dataKey:"v",stroke:a,fill:a+"22",strokeWidth:1,dot:!1,isAnimationActive:!1})})})})]})}function $t({prices:e,supply:n,demand:o}){return t.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-lg p-3",children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:"Market Prices"}),t.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:Object.entries(e||{}).map(([i,a])=>{const s=(n==null?void 0:n[i])||0,r=(o==null?void 0:o[i])||0,l=r>s?"text-red-400":"text-green-400",c=r>s?"â†‘":"â†“";return t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsx("span",{style:{color:ke[i]},className:"font-mono capitalize",children:i}),t.jsxs("span",{className:`font-mono font-bold ${l}`,children:["$",a.toFixed(1)," ",c]})]},i)})})]})}function Ht({value:e}){const n=(e*100).toFixed(1),o=e>.5?"#ef4444":e>.35?"#f59e0b":"#22c55e";return t.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-lg p-3",children:[t.jsxs("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:["Inequality (Gini) â€” ",n]}),t.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-2 mb-1",children:t.jsx("div",{className:"h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(100,e*100)}%`,backgroundColor:o}})}),t.jsxs("div",{className:"flex justify-between text-[10px] text-[#475569]",children:[t.jsx("span",{children:"Perfect Equality (0)"}),t.jsx("span",{children:"Total Inequality (1)"})]})]})}function Ot({event:e}){return t.jsxs("div",{className:"bg-[#1e1e2e] border border-[#334155] rounded px-2 py-1 text-xs flex items-center gap-1",children:[t.jsx("span",{children:e.icon}),t.jsx("span",{className:"text-[#e2e8f0] font-mono",children:e.name})]})}function Lt({metrics:e,market:n,activeEvents:o=[]}){if(!e)return t.jsx("div",{className:"text-[#475569] text-sm font-mono p-4",children:"Loading metrics..."});const{history:i={}}=e;return t.jsxs("div",{className:"flex flex-col gap-2 overflow-y-auto h-full",children:[o.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1 px-1",children:o.map(a=>t.jsx(Ot,{event:a},a.id))}),t.jsxs("div",{className:"text-[#475569] text-xs font-mono px-1",children:["Year ",e.year," Â· Tick ",e.tick," Â· Pop ",e.population]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(H,{label:"GDP",value:e.gdp,format:"currency",trend:e.gdpGrowth,color:"#6366f1",history:i.gdp||[]}),t.jsx(H,{label:"Unemployment",value:e.unemployment,format:"percent",color:e.unemployment>.15?"#ef4444":"#22c55e",history:i.unemployment||[]}),t.jsx(H,{label:"Inflation (CPI)",value:e.cpi,format:"index",color:e.cpi>120?"#f97316":"#e2e8f0",history:i.cpi||[]}),t.jsx(H,{label:"Avg Wage",value:e.avgWage,format:"currency",color:"#06b6d4"})]}),t.jsx(Ht,{value:e.gini}),t.jsx($t,{prices:n==null?void 0:n.prices,supply:n==null?void 0:n.supply,demand:n==null?void 0:n.demand}),t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsx(H,{label:"Poverty Rate",value:e.povertyRate,format:"percent",color:e.povertyRate>.25?"#ef4444":"#94a3b8"}),t.jsx(H,{label:"Social Unrest",value:e.socialUnrest,format:"percent",color:e.socialUnrest>.5?"#ef4444":"#94a3b8",history:i.unrest||[]}),t.jsx(H,{label:"Businesses",value:e.businessCount,color:"#f59e0b"}),t.jsx(H,{label:"Gov Debt",value:Math.abs(e.govDebt||0),format:"currency",color:(e.govDebt||0)>1e3?"#ef4444":"#64748b"})]})]})}function Be(e){return e==null||isNaN(e)?"0":Math.abs(e)>=1e9?(e/1e9).toFixed(1)+"B":Math.abs(e)>=1e6?(e/1e6).toFixed(1)+"M":Math.abs(e)>=1e3?(e/1e3).toFixed(1)+"K":Math.round(e).toString()}const Ut=[{id:"incomeTax",name:"Income Tax",category:"fiscal",type:"slider",min:0,max:.6,step:.01,format:"percent",icon:"ðŸ›ï¸",description:"Tax on worker wages. Funds public spending. Too high reduces work incentive.",tradeoff:"â†‘ Revenue but â†“ Worker take-home pay"},{id:"corporateTax",name:"Corporate Tax",category:"fiscal",type:"slider",min:0,max:.5,step:.01,format:"percent",icon:"ðŸ¢",description:"Tax on business profits. High rates may deter investment.",tradeoff:"â†‘ Revenue but â†“ Business investment"},{id:"minWage",name:"Minimum Wage",category:"labor",type:"slider",min:0,max:30,step:1,format:"currency",icon:"ðŸ’¼",description:"Floor on wages. Protects workers but may price out low-skill labor.",tradeoff:"â†‘ Worker wages but â†‘ Unemployment risk"},{id:"ubi",name:"Universal Basic Income",category:"welfare",type:"slider",min:0,max:500,step:10,format:"currency",icon:"ðŸŽ",description:"Unconditional payment to all citizens. Eliminates poverty floor. Very expensive.",tradeoff:"â†‘ Equality but â†‘â†‘ Government spending"},{id:"interestRate",name:"Interest Rate",category:"monetary",type:"slider",min:0,max:.2,step:.005,format:"percent",icon:"ðŸ¦",description:"Cost of borrowing money. High rates fight inflation but slow growth.",tradeoff:"â†‘ Fights inflation but â†“ Business investment"},{id:"antiMonopoly",name:"Anti-Monopoly Laws",category:"regulation",type:"toggle",icon:"âš–ï¸",description:"Break up businesses that dominate a market. Prevents price gouging.",tradeoff:"â†‘ Competition but â†“ Economies of scale"},{id:"educationFunding",name:"Education Spending",category:"public",type:"slider",min:0,max:1,step:.05,format:"percent",icon:"ðŸ“š",description:"Invests in workforce quality over time. Slow payoff, lasting effect.",tradeoff:"â†‘ Long-term productivity but â†‘ Government spending now"},{id:"unemploymentBenefit",name:"Unemployment Benefits",category:"welfare",type:"slider",min:0,max:300,step:10,format:"currency",icon:"ðŸ›¡ï¸",description:"Payments to unemployed workers. Maintains demand but may reduce job search urgency.",tradeoff:"â†‘ Stability but may â†‘ Unemployment duration"},{id:"priceControlFood",name:"Food Price Controls",category:"regulation",type:"toggle",icon:"ðŸŒ¾",description:"Caps food prices to protect the poor. May cause shortages if price is too low.",tradeoff:"â†‘ Affordability but â†“ Farm investment"},{id:"priceControlHousing",name:"Rent Controls",category:"regulation",type:"toggle",icon:"ðŸ ",description:"Limits housing rent increases. Helps existing tenants, discourages new supply.",tradeoff:"â†‘ Affordability but â†“ New housing construction"},{id:"printMoney",name:"Quantitative Easing",category:"monetary",type:"slider",min:0,max:50,step:1,format:"number",icon:"ðŸ–¨ï¸",description:"Inject money into the economy. Boosts demand but causes inflation.",tradeoff:"â†‘ Short-term demand but â†‘â†‘ Inflation risk"},{id:"publicHealthcare",name:"Public Healthcare",category:"public",type:"toggle",icon:"ðŸ¥",description:"Government-funded health. Improves health, reduces death rate, increases happiness.",tradeoff:"â†‘ Health + happiness but â†‘â†‘ Government spending"},{id:"wealthTax",name:"Wealth Tax",category:"fiscal",type:"slider",min:0,max:.05,step:.001,format:"percent",icon:"ðŸ’Ž",description:"Annual tax on total wealth above threshold. Directly reduces inequality.",tradeoff:"â†‘ Equality but â†“ Capital accumulation"},{id:"openBorders",name:"Open Immigration",category:"labor",type:"toggle",icon:"ðŸŒ",description:"Allow skilled immigrants. Boosts labor supply and productivity, may suppress wages.",tradeoff:"â†‘ Productivity but â†‘ Job competition"},{id:"subsidiesFarming",name:"Farm Subsidies",category:"fiscal",type:"toggle",icon:"ðŸšœ",description:"Government support for food production. Lowers food prices but costs taxpayers.",tradeoff:"â†‘ Food supply + lower prices but â†‘ Spending"},{id:"fourDayWeek",name:"4-Day Work Week",category:"weird",type:"toggle",icon:"ðŸ—“ï¸",description:"Mandate a 4-day work week for all businesses. Workers are happier and healthier â€” but businesses get 20% less output per worker.",tradeoff:"â†‘ Worker health & morale but â†“ Business productivity"},{id:"robotTax",name:"Robot Tax",category:"weird",type:"slider",min:0,max:.5,step:.05,format:"percent",icon:"ðŸ¤–",description:"Tax on automated production in the tech sector. Slows job displacement and funds redistribution.",tradeoff:"â†‘ Employment but â†“ Tech sector growth"},{id:"breadAndCircuses",name:"Bread & Circuses",category:"weird",type:"toggle",icon:"ðŸŽª",description:"Government-funded free food and entertainment for all. Romans used it to keep the masses pacified. Crushes unrest â€” briefly.",tradeoff:"â†“ Unrest now but â†‘ Gov spending + dependency risk"},{id:"mandatoryProfitShare",name:"Mandatory Profit Sharing",category:"weird",type:"slider",min:0,max:.3,step:.05,format:"percent",icon:"ðŸ¤",description:"Businesses must share a percentage of profits with all employees. Reduces inequality, may deter investment.",tradeoff:"â†‘ Worker wealth + lower Gini but â†“ Business capital"},{id:"landValueTax",name:"Land Value Tax",category:"weird",type:"slider",min:0,max:.05,step:.005,format:"percent",icon:"ðŸŒ",description:"Annual tax on land value only (not buildings). Georgist reform â€” discourages speculation, funds government efficiently.",tradeoff:"â†‘ Gov revenue + lower housing prices but unpopular with landowners"},{id:"banAdvertising",name:"Ban Advertising",category:"weird",type:"toggle",icon:"ðŸš«",description:"Outlaws all commercial advertising. Luxury demand collapses. People only buy what they actually need. Businesses struggle to grow.",tradeoff:"â†“ Luxury consumption + lower Gini but â†“ Business growth"},{id:"debtJubilee",name:"Debt Jubilee",category:"weird",type:"toggle",icon:"ðŸŽº",description:"One-time Biblical-style cancellation of all debts. Agents with negative wealth are reset to zero. Happens once then turns off.",tradeoff:"Massive one-time equality reset â€” may destabilize lenders"},{id:"lotteryRedistribution",name:"Wealth Lottery",category:"weird",type:"toggle",icon:"ðŸŽ°",description:'Each tick, a random wealthy citizen pays a "luck tax" directly to a random poor citizen. Chaotic but surprisingly equalizing.',tradeoff:"â†“ Extreme wealth concentration but unpredictable and arbitrary"},{id:"sumptuary",name:"Sumptuary Laws",category:"weird",type:"toggle",icon:"ðŸ‘‘",description:"Legal limits on luxury spending for the wealthy. Medieval kings used these. Luxury sector collapses but inequality drops.",tradeoff:"â†“ Inequality + â†“ Gini but luxury sector destruction"},{id:"degrowth",name:"Degrowth Policy",category:"weird",type:"toggle",icon:"ðŸŒ±",description:"Deliberately slow economic growth. Less GDP obsession means less stress, more stability, better health â€” but economists freak out.",tradeoff:"â†“ GDP growth + â†‘ Health & stability but controversial"},{id:"algoCentralPlanning",name:"Algorithmic Planning",category:"weird",type:"toggle",icon:"ðŸ§®",description:"An AI algorithm sets all prices and wages. Eliminates market volatility. Cold, efficient, and slightly dystopian.",tradeoff:"â†“ Price chaos but removes market discovery + creepy"},{id:"universalBankAccount",name:"Universal Bank Account",category:"weird",type:"toggle",icon:"ðŸ§",description:"Every citizen gets a free government bank account. Reduces financial exclusion, enables direct transfers, improves savings rates.",tradeoff:"â†‘ Financial inclusion + savings but â†‘ Gov infrastructure cost"},{id:"helicopterMoney",name:"Helicopter Money",category:"chaos",type:"slider",min:0,max:500,step:10,format:"currency",icon:"ðŸš",description:"Drop cash directly into every citizen's pocket every tick. Milton Friedman's thought experiment. Pure demand stimulus â€” with pure inflation consequences.",tradeoff:"â†‘â†‘ Demand and spending but â†‘â†‘â†‘ Inflation â€” eventually hyperinflation"},{id:"maximumWage",name:"Maximum Wage",category:"chaos",type:"slider",min:0,max:500,step:10,format:"currency",icon:"ðŸ”’",description:"Hard cap on how much anyone can earn. Income above the limit is confiscated. No CEO mega-salaries allowed. Brain drain incoming.",tradeoff:"â†“ Inequality and Gini but â†‘ Risk of skill emigration and talent suppression"},{id:"wealthConfiscation",name:"Wealth Confiscation",category:"chaos",type:"slider",min:0,max:.5,step:.05,format:"percent",icon:"ðŸª“",description:"Seize a portion of all wealth above $1000. Not a tax â€” an outright seizure. The rich will not be happy. Capital flight begins immediately.",tradeoff:"â†“â†“ Gini immediately but â†‘ Capital flight, investment collapse, and rich agent rage"},{id:"nationalizeIndustries",name:"Nationalize Industries",category:"chaos",type:"toggle",icon:"ðŸ­",description:'The government takes over all private businesses. Workers get flat wages. Production is "planned." The invisible hand is replaced by a five-year plan.',tradeoff:"â†“ Unemployment but â†“â†“ Productivity, â†‘ Gov costs, and businesses stop innovating"},{id:"punitiveTargiffs",name:"Punitive Tariffs",category:"chaos",type:"slider",min:0,max:2,step:.1,format:"percent",icon:"ðŸš§",description:'Slap a massive surcharge on all goods. "Protecting" the economy. In practice: prices skyrocket, consumers suffer, trading partners retaliate.',tradeoff:"â†‘â†‘ Prices (inflation) and â†“ Real wages â€” the Smoot-Hawley special"},{id:"guaranteedJobs",name:"Guaranteed Jobs Program",category:"chaos",type:"toggle",icon:"ðŸ‘·",description:"The government employs every unemployed citizen at minimum wage. Unemployment vanishes on paper. The government payroll explodes.",tradeoff:"â†“ Unemployment to 0% but â†‘â†‘â†‘ Government spending and budget deficit"}],qt={fiscal:{label:"Fiscal Policy",color:"#3b82f6"},monetary:{label:"Monetary Policy",color:"#f59e0b"},labor:{label:"Labor Market",color:"#22c55e"},welfare:{label:"Welfare",color:"#ec4899"},regulation:{label:"Regulation",color:"#8b5cf6"},public:{label:"Public Services",color:"#06b6d4"},weird:{label:"âš—ï¸ Weird Laws",color:"#f97316"},chaos:{label:"ðŸ’£ Chaos Levers",color:"#dc2626"}};function Yt({policy:e,value:n,onChange:o}){const i=a=>e.format==="percent"?(a*100).toFixed(0)+"%":e.format==="currency"?"$"+a:a;return t.jsxs("div",{className:"group",children:[t.jsxs("div",{className:"flex justify-between items-center mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-sm",children:e.icon}),t.jsx("span",{className:"text-xs text-[#e2e8f0] font-mono",children:e.name})]}),t.jsx("span",{className:"text-xs font-bold font-mono text-[#6366f1]",children:i(n)})]}),t.jsx("input",{type:"range",min:e.min,max:e.max,step:e.step,value:n,onChange:a=>o(e.id,parseFloat(a.target.value)),className:"w-full h-1.5 rounded-full appearance-none cursor-pointer",style:{background:`linear-gradient(to right, #6366f1 0%, #6366f1 ${(n-e.min)/(e.max-e.min)*100}%, #1e1e2e ${(n-e.min)/(e.max-e.min)*100}%, #1e1e2e 100%)`},title:e.description}),t.jsx("div",{className:"hidden group-hover:block text-[10px] text-[#475569] mt-1 leading-tight",children:e.tradeoff})]})}function zt({policy:e,value:n,onChange:o}){return t.jsxs("div",{className:"flex items-center justify-between group",children:[t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-sm",children:e.icon}),t.jsx("span",{className:"text-xs text-[#e2e8f0] font-mono",children:e.name})]}),t.jsx("button",{onClick:()=>o(e.id,!n),className:`relative w-9 h-5 rounded-full transition-colors duration-200 flex-shrink-0 ${n?"bg-[#6366f1]":"bg-[#334155]"}`,children:t.jsx("span",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full shadow transition-transform duration-200 ${n?"translate-x-4":"translate-x-0.5"}`})})]})}function Kt({policies:e,onPolicyChange:n}){const[o,i]=u.useState("fiscal"),[a,s]=u.useState(!0),r=Ut.filter(l=>l.category===o);return t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("h3",{className:"text-xs uppercase tracking-widest text-[#64748b] font-mono",children:"Policy Controls"}),t.jsx("button",{onClick:()=>s(!a),className:"text-[#475569] hover:text-[#e2e8f0] text-xs",children:a?"â–¼":"â–¶"})]}),a&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:Object.entries(qt).map(([l,c])=>t.jsx("button",{onClick:()=>i(l),className:`text-[10px] px-2 py-0.5 rounded font-mono transition-colors ${o===l?"text-white":"text-[#475569] hover:text-[#94a3b8]"}`,style:{backgroundColor:o===l?c.color+"33":"transparent",borderColor:c.color+"44",border:"1px solid"},children:c.label},l))}),t.jsx("div",{className:"flex flex-col gap-3 overflow-y-auto flex-1",children:r.map(l=>t.jsx("div",{children:l.type==="slider"?t.jsx(Yt,{policy:l,value:(e==null?void 0:e[l.id])??0,onChange:n}):t.jsx(zt,{policy:l,value:(e==null?void 0:e[l.id])??!1,onChange:n})},l.id))})]})]})}const Vt=[{label:"1Ã—",value:1,title:"Slow â€” watch individual agents"},{label:"5Ã—",value:5,title:"Normal play"},{label:"20Ã—",value:20,title:"Fast-forward"},{label:"Max",value:60,title:"Stress test"}];function Jt({paused:e,speed:n,onPause:o,onResume:i,onReset:a,onSpeedChange:s,onScenarioOpen:r,onShockMe:l,onStatsOpen:c,scenarioName:d,year:p,narratorEnabled:h,narratorLoading:g,onNarratorToggle:m}){const[x,j]=u.useState(!1),v=()=>{navigator.clipboard&&(navigator.clipboard.writeText(window.location.href),j(!0),setTimeout(()=>j(!1),2e3))};return t.jsxs("header",{className:"flex items-center justify-between px-4 py-2 bg-[#0a0a0f] border-b border-[#1e1e2e] flex-wrap gap-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-lg",children:"ðŸ¾"}),t.jsx("span",{className:"text-[#e2e8f0] font-bold font-mono text-sm hidden sm:block",children:"EconSim"})]}),t.jsxs("button",{onClick:r,className:"text-xs font-mono text-[#6366f1] hover:text-[#818cf8] border border-[#6366f133] hover:border-[#6366f166] rounded px-2 py-1 transition-colors",children:[d||"Free Market"," â–¾"]}),p!==void 0&&t.jsxs("span",{className:"text-[#475569] text-xs font-mono",children:["Year ",p]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex items-center gap-0.5 bg-[#12121a] border border-[#1e1e2e] rounded px-1",children:Vt.map(y=>t.jsx("button",{onClick:()=>s(y.value),title:y.title,className:`text-xs font-mono px-2 py-1 rounded transition-colors ${n===y.value?"bg-[#6366f1] text-white":"text-[#64748b] hover:text-[#e2e8f0]"}`,children:y.label},y.value))}),t.jsx("button",{onClick:e?i:o,className:`flex items-center gap-1 text-xs font-mono px-3 py-1.5 rounded border transition-colors
            border-[#1e1e2e] text-[#e2e8f0] hover:border-[#6366f1] hover:text-[#6366f1]`,children:e?"â–¶ Play":"â¸ Pause"}),t.jsx("button",{onClick:a,className:`text-xs font-mono px-3 py-1.5 rounded border border-[#1e1e2e] text-[#64748b]
            hover:border-[#ef4444] hover:text-[#ef4444] transition-colors`,title:"Reset simulation",children:"â†º Reset"}),t.jsx("button",{onClick:l,className:`text-xs font-mono px-3 py-1.5 rounded border border-[#f59e0b33] text-[#f59e0b]
            hover:bg-[#f59e0b11] transition-colors`,title:"Trigger a random economic event",children:"âš¡ Shock"}),t.jsx("button",{onClick:v,className:`text-xs font-mono px-3 py-1.5 rounded border border-[#1e1e2e] text-[#64748b]
            hover:border-[#22c55e] hover:text-[#22c55e] transition-colors`,title:"Copy shareable link",children:x?"âœ“ Copied!":"ðŸ”— Share"}),t.jsx("button",{onClick:c,className:`text-xs font-mono px-3 py-1.5 rounded border border-[#1e1e2e] text-[#64748b]
            hover:border-[#6366f1] hover:text-[#6366f1] transition-colors`,title:"Open macroeconomic statistics",children:"ðŸ“Š Stats"}),t.jsx("button",{onClick:m,disabled:g,className:`text-xs font-mono px-3 py-1.5 rounded border transition-colors ${h?"border-[#06b6d4] text-[#06b6d4] bg-[#06b6d411]":"border-[#1e1e2e] text-[#475569] hover:border-[#06b6d4] hover:text-[#06b6d4]"} ${g?"opacity-50 cursor-wait":""}`,title:h?"Disable narration":"Enable AI narration (loads ~40MB model)",children:g?"â³ Loadingâ€¦":h?"ðŸ”Š Voice On":"ðŸ”‡ Voice"})]})]})}const I=[{id:"story_ch1",number:1,title:"The Industrial Revolution",era:"1850 â€“ 1880",tagline:"Harness the power of industry â€” without breaking the people who build it.",icon:"ðŸ­",color:"#f59e0b",durationYears:30,openingNarrative:`The year is 1850. Steam engines thunder. Factories rise where fields once stretched.

Your small nation stands at the threshold of the industrial age. Entrepreneurs are building mills and mines. Workers are flooding in from the countryside â€” hungry, desperate, and ready to work for almost nothing.

You control the levers of power. How you shape this transformation will echo for generations.

Industrialise too fast and brutal inequality will tear your society apart. Go too slow and you'll fall behind competing nations. History rarely rewards caution â€” but it punishes cruelty.

What kind of industrial nation will you build?`,kokoroNarration:"The year is 1850. Steam engines thunder. Factories rise where fields once stretched. Your nation stands at the threshold of the industrial age. Workers are flooding in from the countryside â€” hungry, desperate, and ready to work for almost nothing. How you shape this transformation will echo for generations.",closingNarrative:{excellent:"Your industrial revolution was a model of managed progress. Workers were protected. Productivity soared. You proved that growth and dignity are not opposites. History will remember this era as a turning point for human welfare.",good:"Your industrial revolution delivered real growth â€” but left scars. Inequality rose faster than wages. Some workers lived better; many did not. The foundations you built are strong, but the cracks will show in time.",poor:"The factories ran. The profits flowed â€” to the few. Workers labored in brutal conditions, children among them. You fed the machine of progress with human suffering. The resentment has only begun to fester."},scenarioConfig:{agentCount:150,businessCount:12,wealthMultiplier:.8,wealthInequality:1.2,avgSkill:.35,policies:{incomeTax:.05,corporateTax:.05,minWage:0,ubi:0,interestRate:.08,antiMonopoly:!1,educationFunding:.1,unemploymentBenefit:0,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!0}},scheduledEvents:[{atTick:100,type:"techBreakthrough"},{atTick:350,type:"generalStrike"},{atTick:600,type:"immigrationWave"}],objectives:[{id:"industrialize",label:"Industrialise",icon:"âš™ï¸",description:"Grow GDP to 3Ã— starting value",metric:"gdp",operator:"gt_initial",threshold:3,sustainTicks:0,weight:.3,tip:"Reduce interest rates to encourage business investment"},{id:"contain_inequality",label:"Contain Inequality",icon:"âš–ï¸",description:"Keep Gini coefficient below 0.65",metric:"gini",operator:"lt",threshold:.65,sustainTicks:52,weight:.35,tip:"Education funding and minimum wage slow inequality accumulation"},{id:"prevent_unrest",label:"Prevent Revolution",icon:"ðŸ”¥",description:"Keep social unrest below 60%",metric:"socialUnrest",operator:"lt",threshold:.6,sustainTicks:52,weight:.35,tip:"Workers strike when inequality is extreme. Early labour protections help."}]},{id:"story_ch2",number:2,title:"The Great Depression",era:"1929 â€“ 1939",tagline:"The bubble has burst. The banks are failing. Can you stop the collapse?",icon:"ðŸ“‰",color:"#ef4444",durationYears:10,openingNarrative:`October 1929. The stock market has just crashed. Overnight, millions lost their savings.

Banks are failing. Factories are shutting. Unemployment lines stretch around the block. The industrial prosperity you inherited now threatens to become the greatest catastrophe in economic history.

Herbert Hoover is doing nothing. The markets will correct themselves, they say. They have not corrected. They are freefall.

You have a decade to stop the collapse, prevent total social breakdown, and set the stage for recovery. Every decision will be second-guessed by historians for the next hundred years.

What do you do?`,kokoroNarration:"October 1929. The stock market has just crashed. Banks are failing. Factories are shutting. Unemployment lines stretch around the block. You have one decade to stop the collapse. Every decision you make will be second-guessed by historians for the next hundred years.",closingNarrative:{excellent:"You navigated the Depression better than history did. The New Deal worked â€” or something like it. Workers were put back to work, banks were stabilised, and the social contract held. Future generations will look back at this as the moment government proved its worth.",good:"Recovery came, but slowly and unevenly. Unemployment fell but never fully resolved. You avoided total collapse â€” which is more than Hoover managed. The scars remain, but the patient survived.",poor:"The Depression deepened on your watch. Unemployment exceeded 30%. Hunger marches turned violent. The social fabric frayed. You've created the conditions for something dangerous to fill the vacuum."},scenarioConfig:{agentCount:200,businessCount:25,wealthMultiplier:1.5,wealthInequality:2.5,avgSkill:.45,startingGovDebt:2e3,policies:{incomeTax:.25,corporateTax:.15,minWage:0,ubi:0,interestRate:.06,antiMonopoly:!1,educationFunding:.2,unemploymentBenefit:0,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1}},scheduledEvents:[{atTick:10,type:"financialBubble"},{atTick:80,type:"bankRun"},{atTick:200,type:"recession"},{atTick:350,type:"cropFailure"}],objectives:[{id:"employment",label:"Reduce Unemployment",icon:"ðŸ‘·",description:"Get unemployment below 15%",metric:"unemployment",operator:"lt",threshold:.15,sustainTicks:104,weight:.4,tip:"Stimulus spending, guaranteed jobs, or UBI can absorb the unemployed"},{id:"no_collapse",label:"Prevent Social Collapse",icon:"ðŸ›ï¸",description:"Keep social unrest below 70%",metric:"socialUnrest",operator:"lt",threshold:.7,sustainTicks:0,weight:.35,tip:"Hungry, unemployed people revolt. Food aid and benefits are not luxuries here."},{id:"gdp_recovery",label:"Stabilise GDP",icon:"ðŸ“ˆ",description:"Stop GDP from falling below 50% of starting value",metric:"gdp",operator:"gt_initial",threshold:.5,sustainTicks:52,weight:.25,tip:"Austerity deepens depressions. Keynes said so. Try stimulus."}]},{id:"story_ch3",number:3,title:"The Golden Age",era:"1950 â€“ 1975",tagline:"Postwar prosperity. Build the welfare state â€” before stagflation ends it.",icon:"âœ¨",color:"#22c55e",durationYears:25,openingNarrative:`The war is over. Soldiers have come home. Baby carriages fill the streets.

The economy is booming. Factories, infrastructure, education â€” everything needs to be built. There is broad political consensus that government should provide education, healthcare, and a safety net. This is your window.

But the prosperity won't last forever. By the mid-1970s, oil shocks will trigger stagflation â€” high inflation and high unemployment at the same time, the nightmare scenario that breaks every economic model.

Your task: build a welfare state that is both generous and resilient enough to survive when the oil runs out.`,kokoroNarration:"The war is over. Soldiers have come home. The economy is booming. This is your window to build the welfare state. But the prosperity won't last forever. By the mid-seventies, oil shocks will trigger stagflation â€” the nightmare scenario that breaks every economic model. Build something resilient.",closingNarrative:{excellent:"You built the most successful welfare state in history. Education, healthcare, housing â€” all delivered. When stagflation hit, your economy had the resilience to absorb the shock. This will be remembered as the Golden Age it promised to be.",good:"You built a reasonable welfare state and survived stagflation with manageable damage. Not Sweden, but not collapse either. The middle class is large. Inequality is moderate. The foundations are solid.",poor:"The Golden Age became the Age of Stagflation on your watch. Inflation spiralled, unemployment spiked, and the welfare programs you couldn't afford to maintain were cut. The social contract is fraying."},scenarioConfig:{agentCount:220,businessCount:28,wealthMultiplier:1.2,wealthInequality:1.3,avgSkill:.55,policies:{incomeTax:.35,corporateTax:.28,minWage:8,ubi:0,interestRate:.04,antiMonopoly:!0,educationFunding:.5,unemploymentBenefit:80,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!0,wealthTax:0,openBorders:!1,subsidiesFarming:!0}},scheduledEvents:[{atTick:50,type:"boom"},{atTick:200,type:"techBreakthrough"},{atTick:600,type:"recession"},{atTick:750,type:"hyperinflation"}],objectives:[{id:"welfare",label:"Build Welfare State",icon:"ðŸ¥",description:"Keep poverty rate below 15%",metric:"povertyRate",operator:"lt",threshold:.15,sustainTicks:104,weight:.35,tip:"Healthcare, education, unemployment benefits â€” all reduce poverty"},{id:"growth",label:"Sustained Growth",icon:"ðŸ“ˆ",description:"Maintain positive GDP growth for 5 years",metric:"gdpGrowth",operator:"gt",threshold:0,sustainTicks:260,weight:.35,tip:"The postwar boom is yours to manage. Don't break it."},{id:"survive_stagflation",label:"Survive Stagflation",icon:"ðŸ›¡ï¸",description:"Keep inflation below 15% when it hits",metric:"inflation",operator:"lt",threshold:15,sustainTicks:52,weight:.3,tip:"Tight monetary policy can fight inflation â€” but it triggers recession"}]},{id:"story_ch4",number:4,title:"The Neoliberal Turn",era:"1980 â€“ 2000",tagline:"Deregulate everything. But who gets left behind?",icon:"ðŸ¦",color:"#8b5cf6",durationYears:20,openingNarrative:`Reagan is in the White House. Thatcher is at 10 Downing Street. The message is clear: government is the problem. Markets are the solution.

Inflation has been crushed â€” but at the cost of brutal unemployment. The industrial heartland is hollowing out. Financialisation is replacing manufacturing. Inequality is rising faster than at any time since the Gilded Age.

The tech revolution is beginning. This could be a tremendous era of growth â€” or the beginning of a 40-year inequality explosion.

The choice is yours. Deregulate and grow fast, or manage the transition and protect those left behind?`,kokoroNarration:"Reagan is in the White House. Thatcher is at Downing Street. The message is clear â€” government is the problem. Markets are the solution. Inflation has been crushed. The tech revolution is beginning. This could be tremendous growth â€” or the beginning of a 40-year inequality explosion. The choice is yours.",closingNarrative:{excellent:"You managed the neoliberal era with rare wisdom â€” capturing the growth benefits of deregulation while protecting workers from its worst effects. Inequality rose modestly. The middle class survived. The tech revolution was distributed, not just captured by the elite.",good:"Growth was real. So was the inequality. The 1990s produced genuine prosperity for many, but the gap between the top and bottom widened considerably. The seeds of future discontent were planted, but the economy is functional.",poor:"Trickle-down didn't trickle. Deregulation unleashed a financial sector that captured all the gains. Workers who lost manufacturing jobs never found equivalent work. The economy is a casino â€” and the house always wins."},scenarioConfig:{agentCount:240,businessCount:30,wealthMultiplier:1.4,wealthInequality:1.8,avgSkill:.5,policies:{incomeTax:.28,corporateTax:.35,minWage:5,ubi:0,interestRate:.15,antiMonopoly:!1,educationFunding:.3,unemploymentBenefit:60,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!0,subsidiesFarming:!1}},scheduledEvents:[{atTick:80,type:"techBreakthrough"},{atTick:250,type:"financialBubble"},{atTick:400,type:"brainDrain"},{atTick:600,type:"boom"}],objectives:[{id:"growth_neo",label:"Deliver Growth",icon:"ðŸ“ˆ",description:"Grow GDP to 2Ã— starting value",metric:"gdp",operator:"gt_initial",threshold:2,sustainTicks:0,weight:.3,tip:"Low rates and deregulation stimulate growth â€” short-term"},{id:"inequality_neo",label:"Contain Inequality",icon:"âš–ï¸",description:"Keep Gini below 0.55",metric:"gini",operator:"lt",threshold:.55,sustainTicks:104,weight:.4,tip:"The hardest challenge of this era. Redistribution fights against market forces."},{id:"employment_neo",label:"Full Employment",icon:"ðŸ‘·",description:"Keep unemployment below 8%",metric:"unemployment",operator:"lt",threshold:.08,sustainTicks:104,weight:.3,tip:"Technology displaces workers. Education and retraining are your best tools."}]},{id:"story_ch5",number:5,title:"The Age of Crises",era:"2008 â€“ Now",tagline:"Financial crash. Pandemic. Inequality explosion. Can you hold it together?",icon:"ðŸŒ",color:"#6366f1",durationYears:20,openingNarrative:`September 2008. Lehman Brothers has just filed for bankruptcy. The global financial system is in cardiac arrest.

Everything you built over the previous decades is now being tested. The debt is enormous. The inequality is extreme. The financial sector is insolvent. And in a decade, a pandemic will arrive that shuts down the entire world economy.

This is the final chapter. The cumulative weight of every previous decision â€” industrial exploitation, Depression policy, welfare choices, neoliberal inequality â€” comes due now.

Can you hold civilisation together? Or will this be where it finally breaks?`,kokoroNarration:"September 2008. Lehman Brothers has just filed for bankruptcy. The global financial system is in cardiac arrest. Everything you built over decades is being tested. And in a decade, a pandemic will arrive. This is the final chapter. Can you hold it together?",closingNarrative:{excellent:"Against extraordinary odds, you navigated the Age of Crises. The 2008 crash was contained. The pandemic was managed. Inequality, while still high, was brought back to manageable levels. This is what competent governance looks like in the hardest times.",good:"The crises were severe but not fatal. Recovery was slow and uneven. The wealthy recovered faster than the workers â€” as always. But the system held. Democracy survived. This is the realistic best-case outcome.",poor:"The crises broke what the previous decades had strained. Unemployment, inequality, social unrest â€” all reached historic highs. The social contract you inherited lies in ruins. Whatever comes next won't look like what came before."},scenarioConfig:{agentCount:250,businessCount:35,wealthMultiplier:2,wealthInequality:3,avgSkill:.6,startingGovDebt:3500,policies:{incomeTax:.3,corporateTax:.25,minWage:10,ubi:0,interestRate:.05,antiMonopoly:!1,educationFunding:.4,unemploymentBenefit:100,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1}},scheduledEvents:[{atTick:10,type:"financialBubble"},{atTick:100,type:"bankRun"},{atTick:250,type:"recession"},{atTick:500,type:"pandemic"},{atTick:650,type:"hyperinflation"}],objectives:[{id:"survive_crash",label:"Survive the Crash",icon:"ðŸ¦",description:"Keep GDP above 60% of starting value",metric:"gdp",operator:"gt_initial",threshold:.6,sustainTicks:52,weight:.3,tip:"Stimulus, QE, and deposit guarantees are your tools for the crash"},{id:"inequality_final",label:"Reduce Inequality",icon:"âš–ï¸",description:"Bring Gini below 0.5",metric:"gini",operator:"lt",threshold:.5,sustainTicks:104,weight:.35,tip:"This is the defining challenge of the 21st century. Wealth taxes, UBI, education."},{id:"stability_final",label:"Social Stability",icon:"ðŸ•Šï¸",description:"Keep social unrest below 50%",metric:"socialUnrest",operator:"lt",threshold:.5,sustainTicks:52,weight:.35,tip:"People who have nothing to lose are dangerous. Safety nets buy stability."}]}];function Xt(e=[]){if(!e.length)return 50;const n=e.reduce((i,a)=>i+(a.weight||1),0),o=e.reduce((i,a)=>i+(a.completed?a.weight||1:0),0);return Math.round(o/n*100)}function Ve(e){return e>=85?{grade:"S",label:"Excellent",color:"#f59e0b"}:e>=65?{grade:"A",label:"Good",color:"#22c55e"}:e>=40?{grade:"B",label:"Adequate",color:"#6366f1"}:e>=20?{grade:"C",label:"Poor",color:"#f97316"}:{grade:"F",label:"Failed",color:"#ef4444"}}function Zt(e){return e>=65?"excellent":e>=35?"good":"poor"}const V={freeMarket:{id:"freeMarket",name:"Free Market Utopia",subtitle:"No rules. Pure capitalism.",description:"Zero regulation. No minimum wage, no taxes, no safety net. Watch monopolies form naturally and see who wins â€” and who gets left behind.",icon:"ðŸ¦…",difficulty:"Observe",color:"#3b82f6",isHistorical:!1,policies:{incomeTax:0,corporateTax:0,minWage:0,ubi:0,interestRate:.02,antiMonopoly:!1,educationFunding:0,unemploymentBenefit:0,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:20,wealthMultiplier:1.2,wealthInequality:1.5,avgSkill:.5,lesson:"Natural monopolies emerge quickly. The rich get richer. But GDP grows fast at first."},debtSpiral:{id:"debtSpiral",name:"The Debt Spiral",subtitle:"Borrowed too much. Now what?",description:"The government spent heavily on social programs. Debt is high, deficit is growing. Austerity or default â€” pick your poison.",icon:"ðŸ’¸",difficulty:"Hard",color:"#ef4444",isHistorical:!1,policies:{incomeTax:.45,corporateTax:.35,minWage:15,ubi:200,interestRate:.12,antiMonopoly:!0,educationFunding:.8,unemploymentBenefit:150,priceControlFood:!1,priceControlHousing:!1,printMoney:5,publicHealthcare:!0,wealthTax:.02,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:18,wealthMultiplier:.8,wealthInequality:.8,avgSkill:.55,startGovDebt:5e3,lesson:"Cutting programs causes pain now. Keeping them causes pain later. The political economy of austerity."},techDisruption:{id:"techDisruption",name:"Tech Disruption",subtitle:"Automation is coming for jobs.",description:"A stable, balanced economy. Then a tech breakthrough hits â€” half the jobs can be automated. Will you adapt or collapse?",icon:"ðŸ¤–",difficulty:"Medium",color:"#8b5cf6",isHistorical:!1,policies:{incomeTax:.28,corporateTax:.21,minWage:12,ubi:0,interestRate:.05,antiMonopoly:!1,educationFunding:.5,unemploymentBenefit:80,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:20,wealthMultiplier:1,wealthInequality:1,avgSkill:.5,scheduledEvents:[{type:"techBreakthrough",atTick:200}],lesson:"Automation creates wealth but destroys jobs. UBI or retraining â€” which policy saves more people?"},greatDepression:{id:"greatDepression",name:"The Great Depression",subtitle:"October 1929. The markets have collapsed.",description:'GDP has fallen 30%. Unemployment is climbing toward 25%. Banks are failing daily. Hoover says "be patient." Do you agree?',icon:"ðŸ“‰",difficulty:"Very Hard",color:"#78716c",isHistorical:!0,era:"1929â€“1939 Â· United States",durationYears:15,policies:{incomeTax:.02,corporateTax:.12,minWage:0,ubi:0,interestRate:.06,antiMonopoly:!1,educationFunding:.1,unemploymentBenefit:0,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:12,wealthMultiplier:.35,wealthInequality:2,avgSkill:.4,scheduledEvents:[{type:"recession",atTick:1},{type:"financialBubble",atTick:80}],lesson:"Austerity deepened the Depression. FDR's New Deal proved government spending could restart demand."},weimarHyperinflation:{id:"weimarHyperinflation",name:"Weimar Hyperinflation",subtitle:"A loaf of bread costs a wheelbarrow of cash.",description:"Post-WWI Germany is printing money to pay reparations. Inflation is doubling daily. The middle class is being wiped out. Can you stabilize the currency before society collapses?",icon:"ðŸ’¹",difficulty:"Expert",color:"#dc2626",isHistorical:!0,era:"1921â€“1924 Â· Germany",durationYears:10,policies:{incomeTax:.15,corporateTax:.1,minWage:0,ubi:0,interestRate:.01,antiMonopoly:!1,educationFunding:.2,unemploymentBenefit:0,priceControlFood:!0,priceControlHousing:!1,printMoney:40,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:180,businessCount:15,wealthMultiplier:.5,wealthInequality:1.8,avgSkill:.45,scheduledEvents:[],lesson:"Stopping hyperinflation requires cold turkey: halt money printing, issue new credible currency, accept short-term pain."},stagflation1970s:{id:"stagflation1970s",name:"1970s Stagflation",subtitle:"Inflation up. Unemployment up. Nothing works.",description:"OPEC's oil embargo just hit. Prices are surging but the economy is stagnating. Your standard policy tools are pointing in opposite directions. What do you do?",icon:"â›½",difficulty:"Hard",color:"#d97706",isHistorical:!0,era:"1973â€“1982 Â· United States",durationYears:12,policies:{incomeTax:.3,corporateTax:.48,minWage:8,ubi:0,interestRate:.06,antiMonopoly:!1,educationFunding:.4,unemploymentBenefit:100,priceControlFood:!1,priceControlHousing:!1,printMoney:8,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:18,wealthMultiplier:.85,wealthInequality:1.1,avgSkill:.5,scheduledEvents:[{type:"cropFailure",atTick:20},{type:"recession",atTick:150}],lesson:"Stagflation broke Keynesian consensus. Volcker's painful rate hikes eventually worked â€” but cost millions their jobs."},crisisOf2008:{id:"crisisOf2008",name:"2008 Financial Crisis",subtitle:"Lehman just failed. The banks are frozen.",description:"The US housing bubble has burst. Banks are insolvent. Credit is frozen. The global economy is in freefall. Bail out the banks, let them fail, or something else?",icon:"ðŸ¦",difficulty:"Hard",color:"#7c3aed",isHistorical:!0,era:"2008â€“2015 Â· Global",durationYears:10,policies:{incomeTax:.28,corporateTax:.35,minWage:10,ubi:0,interestRate:.05,antiMonopoly:!1,educationFunding:.4,unemploymentBenefit:100,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!1,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:16,wealthMultiplier:.7,wealthInequality:1.6,avgSkill:.5,scheduledEvents:[{type:"financialBubble",atTick:1},{type:"recession",atTick:30}],lesson:"Bailouts prevented a depression but rewarded recklessness. The political consequences lasted a decade."},japanLostDecade:{id:"japanLostDecade",name:"Japan's Lost Decade",subtitle:"Zero rates. Zero growth. Zero inflation.",description:"Japan's asset bubble burst in 1991. Interest rates are near zero. Stimulus packages come and go. Nothing works. Can you escape the deflationary trap that trapped Japan for 20 years?",icon:"ðŸ—¾",difficulty:"Expert",color:"#0891b2",isHistorical:!0,era:"1991â€“2010 Â· Japan",durationYears:15,policies:{incomeTax:.33,corporateTax:.38,minWage:6,ubi:0,interestRate:.005,antiMonopoly:!1,educationFunding:.6,unemploymentBenefit:80,priceControlFood:!1,priceControlHousing:!1,printMoney:2,publicHealthcare:!0,wealthTax:0,openBorders:!1,subsidiesFarming:!1},agentCount:200,businessCount:20,wealthMultiplier:.9,wealthInequality:.9,avgSkill:.65,scheduledEvents:[{type:"financialBubble",atTick:1},{type:"recession",atTick:10}],lesson:"Half-measures and zombie banks prolonged Japan's stagnation for 20 years. Swift, decisive action matters."},nordicMiracle:{id:"nordicMiracle",name:"Build the Nordic Model",subtitle:"High taxes. High trust. High happiness.",description:"You're building a new nation. Can you achieve the Nordic balance: low inequality, high productivity, strong safety net, and sustained growth? This is what success looks like.",icon:"ðŸŒ",difficulty:"Blueprint",color:"#059669",isHistorical:!0,era:"Reference Model Â· Scandinavia",durationYears:20,policies:{incomeTax:.45,corporateTax:.25,minWage:18,ubi:0,interestRate:.03,antiMonopoly:!0,educationFunding:.9,unemploymentBenefit:200,priceControlFood:!1,priceControlHousing:!1,printMoney:0,publicHealthcare:!0,wealthTax:.01,openBorders:!1,subsidiesFarming:!0},agentCount:200,businessCount:22,wealthMultiplier:1,wealthInequality:.7,avgSkill:.6,avgEducation:.65,scheduledEvents:[],lesson:"The Nordic model requires high institutional trust, universal services, AND open competitive markets. All three."}};for(const e of I)V[e.id]={id:e.id,name:e.title,subtitle:e.era,description:e.tagline,icon:e.icon,difficulty:`Chapter ${e.number}`,color:e.color,isHistorical:!1,isStory:!0,storyChapterNumber:e.number,durationYears:e.durationYears,era:e.era,lesson:e.tagline,scheduledEvents:e.scheduledEvents||[],...e.scenarioConfig,policies:e.scenarioConfig.policies};const Ne=Object.values(V),De=Ne.filter(e=>!e.isHistorical&&!e.isStory),We=Ne.filter(e=>e.isHistorical);Ne.filter(e=>e.isStory);function Ge({scenario:e,onSelect:n,current:o}){const i=o===e.id;return t.jsx("button",{onClick:()=>n(e.id),className:`w-full text-left p-3 rounded-xl border transition-all ${i?"":"border-[#1e1e2e] bg-[#12121a] hover:border-[#334155]"}`,style:{borderColor:i?e.color:void 0,backgroundColor:i?e.color+"10":void 0},children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-xl",children:e.icon}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:"text-white font-bold text-xs",children:e.name}),t.jsx("span",{className:"text-[9px] px-1.5 py-0.5 rounded font-mono flex-shrink-0",style:{backgroundColor:e.color+"22",color:e.color},children:e.difficulty}),e.durationYears&&t.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded font-mono bg-[#1e1e2e] text-[#64748b] flex-shrink-0",children:[e.durationYears,"yr"]})]}),e.era&&t.jsx("div",{className:"text-[9px] text-[#475569] font-mono",children:e.era}),t.jsx("p",{className:"text-[#64748b] text-[10px] leading-relaxed mt-0.5",children:e.description})]})]})})}function Qt({chapter:e,storyProgress:n,onSelect:o,current:i,chapterIndex:a}){var h;const s=e.number<=n.unlockedChapter,r=(h=n.scores)==null?void 0:h[e.id],l=r!==void 0,c=i===e.id,{grade:d,color:p}=l?Ve(r):{};return t.jsxs("button",{onClick:()=>s&&o(e.id),disabled:!s,className:`w-full text-left p-3 rounded-xl border transition-all relative ${s?c?"":"border-[#1e1e2e] bg-[#12121a] hover:border-[#334155]":"border-[#1e1e2e] bg-[#0a0a0f] opacity-40 cursor-not-allowed"}`,style:{borderColor:c?e.color:void 0,backgroundColor:c?e.color+"10":void 0},children:[!s&&t.jsx("div",{className:"absolute top-2 right-2 text-[#334155] text-xs",children:"ðŸ”’"}),t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-xl",children:e.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsxs("span",{className:"text-[9px] font-mono px-1.5 py-0.5 rounded",style:{backgroundColor:e.color+"22",color:e.color},children:["Ch.",e.number]}),t.jsx("span",{className:"text-white font-bold text-xs",children:e.title}),l&&t.jsxs("span",{className:"text-[9px] font-mono font-bold ml-auto",style:{color:p},children:[d," Â· ",r,"/100"]})]}),t.jsx("div",{className:"text-[9px] font-mono text-[#475569] mt-0.5",children:e.era}),t.jsx("p",{className:"text-[#64748b] text-[10px] mt-0.5 leading-relaxed",children:e.tagline})]})]}),l&&t.jsx("div",{className:"mt-2 w-full bg-[#1e1e2e] rounded-full h-0.5",children:t.jsx("div",{className:"h-0.5 rounded-full",style:{width:`${r}%`,backgroundColor:p}})})]})}const $e=[{id:"freeplay",label:"ðŸŽ® Free Play",desc:"No time limit. No objectives. Experiment freely."},{id:"historical",label:"ðŸ“œ Historical",desc:"Real crises. Can you do better than history?"},{id:"story",label:"ðŸ“– Story Mode",desc:"5-chapter campaign through economic history."}];function eo({current:e,onSelect:n,onClose:o,storyProgress:i}){var c;const[a,s]=u.useState(()=>{De.find(h=>h.id===e);const d=We.find(h=>h.id===e);return I.find(h=>h.id===e)?"story":d?"historical":"freeplay"}),r=Object.keys((i==null?void 0:i.scores)||{}).length,l=I.length;return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:t.jsxs("div",{className:"bg-[#0d0d14] border border-[#1e1e2e] rounded-2xl p-5 max-w-2xl w-full mx-4 max-h-[92vh] overflow-hidden flex flex-col shadow-2xl",children:[t.jsxs("div",{className:"flex items-start justify-between mb-4 flex-shrink-0",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-white font-bold text-lg font-mono",children:"ðŸ¾ EconSim"}),t.jsx("p",{className:"text-[#64748b] text-xs mt-0.5",children:"Choose your mode"})]}),t.jsx("button",{onClick:o,className:"text-[#475569] hover:text-white text-xl ml-4",children:"âœ•"})]}),t.jsx("div",{className:"flex gap-1 mb-4 bg-[#12121a] rounded-xl p-1 flex-shrink-0",children:$e.map(d=>t.jsxs("button",{onClick:()=>s(d.id),className:`flex-1 text-center py-2 rounded-lg text-xs font-mono transition-all ${a===d.id?"bg-[#1e1e2e] text-white font-bold":"text-[#475569] hover:text-[#94a3b8]"}`,children:[d.label,d.id==="story"&&r>0&&t.jsxs("span",{className:"ml-1 text-[9px] text-[#6366f1]",children:[r,"/",l]})]},d.id))}),t.jsx("div",{className:"text-[10px] text-[#475569] font-mono mb-3 flex-shrink-0",children:(c=$e.find(d=>d.id===a))==null?void 0:c.desc}),t.jsxs("div",{className:"flex-1 overflow-y-auto flex flex-col gap-2 pr-1",children:[a==="freeplay"&&t.jsxs(t.Fragment,{children:[De.map(d=>t.jsx(Ge,{scenario:d,current:e,onSelect:p=>{n(p),o()}},d.id)),t.jsx("div",{className:"mt-2 p-3 rounded-xl bg-[#12121a] border border-[#1e1e2e]",children:t.jsxs("div",{className:"text-[10px] font-mono text-[#475569] leading-relaxed",children:["ðŸ’¡ Free Play tips: use ",t.jsx("span",{className:"text-[#f59e0b]",children:"âš¡ Shock"})," to trigger random crises, try the ",t.jsx("span",{className:"text-[#dc2626]",children:"ðŸ’£ Chaos Levers"})," to stress-test the economy, or the ",t.jsx("span",{className:"text-[#f97316]",children:"âš—ï¸ Weird Laws"})," for unusual interventions. Open ",t.jsx("span",{className:"text-[#6366f1]",children:"ðŸ“Š Stats"})," for the full macroeconomic dashboard."]})})]}),a==="historical"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-[10px] font-mono text-[#334155] mb-1",children:"Real economic crises, simulated. Your decisions are compared to what actually happened."}),We.map(d=>t.jsx(Ge,{scenario:d,current:e,onSelect:p=>{n(p),o()}},d.id))]}),a==="story"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-[10px] font-mono text-[#334155] mb-1",children:"A 5-chapter campaign through the history of capitalism. Each chapter unlocks after completing the previous one."}),I.map((d,p)=>t.jsx(Qt,{chapter:d,storyProgress:i,current:e,chapterIndex:p,onSelect:h=>{n(h),o()}},d.id)),r===l&&t.jsxs("div",{className:"p-3 rounded-xl bg-[#f59e0b11] border border-[#f59e0b33] text-center",children:[t.jsx("div",{className:"text-[#f59e0b] font-mono font-bold text-sm",children:"ðŸ† Campaign Complete!"}),t.jsx("div",{className:"text-[#94a3b8] text-xs mt-1",children:"You've navigated 200 years of economic history."})]}),r>0&&t.jsx("button",{onClick:()=>{window.confirm("Reset story progress? This cannot be undone.")&&n("_reset_story")},className:"text-[9px] font-mono text-[#334155] hover:text-[#ef4444] text-center py-1 transition-colors",children:"Reset story progress"})]})]}),t.jsx("div",{className:"mt-3 text-center text-[#334155] text-[10px] font-mono flex-shrink-0",children:"Changing scenario resets the simulation"})]})})}const to={monopoly_forming:{title:"Monopoly Alert",emoji:"ðŸ¢",body:"One business now controls over 60% of its market. Without competition, prices rise and quality drops.",realWorld:"Standard Oil controlled 91% of US oil in 1904. The Sherman Antitrust Act (1890) broke it up. Today, similar debates surround Big Tech.",color:"#ef4444"},high_inequality:{title:"Inequality Spike",emoji:"ðŸ“Š",body:"Wealth concentration is extreme. The Gini coefficient measures this: 0 = perfect equality, 1 = one person owns everything.",realWorld:"The US Gini is ~0.41. Scandinavia: ~0.28. Brazil: ~0.53. High inequality correlates with lower social mobility and higher crime.",color:"#f59e0b"},high_unemployment:{title:"Unemployment Crisis",emoji:"ðŸ“‰",body:"Mass unemployment creates a vicious cycle: fewer workers â†’ less spending â†’ fewer sales â†’ more layoffs.",realWorld:"Keynes' insight: in a recession, government spending can break this cycle by creating demand when the private sector won't.",color:"#ef4444"},inflation_spiral:{title:"Inflation Warning",emoji:"ðŸ”¥",body:"Prices are rising faster than wages. Your money buys less each day. The purchasing power of savings erodes.",realWorld:"Zimbabwe's hyperinflation (2008) reached 89.7 sextillion % monthly. The cure: independent central banks that raise rates.",color:"#f97316"},min_wage_tradeoff:{title:"Minimum Wage Tradeoff",emoji:"âš–ï¸",body:"A higher minimum wage raised living standards â€” but some businesses can no longer afford to hire.",realWorld:"Seattle's $15 minimum wage (2015) study: restaurant employment rose in some areas, fell in others. Context matters enormously.",color:"#6366f1"},budget_surplus:{title:"Fiscal Surplus!",emoji:"ðŸ’°",body:"Tax revenue exceeds spending. The government can pay down debt or invest in future growth.",realWorld:"The US ran surpluses 1998-2001. Norway's oil fund (built from surpluses) now exceeds $1.4 trillion.",color:"#22c55e"},stagnation:{title:"Stagflation Risk",emoji:"ðŸ˜°",body:"The economy is shrinking AND unemployment is rising â€” the worst of both worlds. Traditional policy tools conflict.",realWorld:"The 1970s oil crisis created stagflation. Volcker killed it (1980) by raising interest rates to 20% â€” causing a painful recession.",color:"#8b5cf6"},poverty_trap:{title:"Poverty Trap",emoji:"ðŸª¤",body:"Workers in poverty can't afford better nutrition, education, or healthcare â€” which keeps them in poverty.",realWorld:"The poverty trap: every dollar earned reduces welfare by $1. Effective marginal tax rates for the poor can exceed 80%.",color:"#ef4444"},dutch_disease:{title:"Resource Dependency",emoji:"â›½",body:"One sector dominates, crowding out others. High-earning sectors attract all workers, leaving other industries struggling.",realWorld:`The "Dutch Disease": Netherlands' 1960s natural gas discovery boosted the guilder, making exports uncompetitive.`,color:"#f59e0b"},ubi_effect:{title:"UBI Effect Observed",emoji:"ðŸŽ¯",body:"Universal Basic Income is reducing poverty and providing security. Some people are taking more risks â€” starting businesses.",realWorld:"Finland's UBI experiment (2017-18): recipients reported better wellbeing, mental health improved. Employment was neutral.",color:"#22c55e"}};function oo({insight:e,onDismiss:n}){const[o,i]=u.useState(!1);if(u.useEffect(()=>{e&&i(!0)},[e]),!e||!o)return null;const a=to[e.id]||{title:e.title,emoji:"ðŸ’¡",body:e.body,realWorld:e.realWorld,color:"#6366f1"},s=()=>{i(!1),setTimeout(()=>n==null?void 0:n(),300)};return t.jsx("div",{className:`fixed bottom-6 right-6 z-40 max-w-sm transition-all duration-300 ${o?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:t.jsx("div",{className:"bg-[#0d0d14] border rounded-xl p-4 shadow-2xl",style:{borderColor:a.color+"66"},children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl flex-shrink-0",children:a.emoji}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("h4",{className:"text-white font-bold text-sm",children:a.title}),t.jsx("button",{onClick:s,className:"text-[#475569] hover:text-white text-sm ml-2",children:"âœ•"})]}),t.jsx("p",{className:"text-[#94a3b8] text-xs leading-relaxed mb-2",children:a.body}),t.jsxs("div",{className:"text-[10px] text-[#64748b] leading-relaxed border-l-2 pl-2 italic",style:{borderColor:a.color+"66"},children:["ðŸŒ ",a.realWorld]}),t.jsxs("div",{className:"text-[9px] text-[#334155] mt-2 font-mono",children:["Year ",e.year," Â· ",e.id]})]})]})})})}const no={working:"Employed",unemployed:"Unemployed",child:"Child",retired:"Retired",owner:"Business Owner",dead:"Deceased"},io={working:"#22c55e",unemployed:"#ef4444",child:"#94a3b8",retired:"#64748b",owner:"#f59e0b",dead:"#374151"};function ao({agent:e,onClose:n}){if(!e)return null;const o=Math.floor(e.age/52),i=Ke(e.wealth);return t.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-40 bg-[#0d0d14] border border-[#1e1e2e] rounded-xl p-4 shadow-2xl max-w-xs w-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 rounded-full border border-white/20",style:{backgroundColor:i}}),t.jsxs("span",{className:"text-white font-bold font-mono text-sm",children:["Agent #",e.id]})]}),t.jsx("button",{onClick:n,className:"text-[#475569] hover:text-white text-sm",children:"âœ•"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5 text-xs mb-3",children:[t.jsx(B,{label:"Age",value:`${o} yrs`}),t.jsx(B,{label:"Status",value:no[e.state]||e.state,color:io[e.state]}),t.jsx(B,{label:"Wealth",value:`$${Math.round(e.wealth)}`,color:i}),t.jsx(B,{label:"Wage",value:e.wage>0?`$${e.wage.toFixed(1)}/tick`:"â€”"}),t.jsx(B,{label:"Skill",value:`${(e.skill*100).toFixed(0)}%`}),t.jsx(B,{label:"Education",value:`${(e.education*100).toFixed(0)}%`}),t.jsx(B,{label:"Health",value:`${(e.health*100).toFixed(0)}%`}),t.jsx(B,{label:"Happiness",value:`${(e.happiness*100).toFixed(0)}%`,color:e.happiness>.6?"#22c55e":e.happiness<.3?"#ef4444":"#e2e8f0"}),e.jobSector&&t.jsx(B,{label:"Sector",value:e.jobSector}),t.jsx(B,{label:"Class",value:e.socialClass,color:e.socialClass==="rich"?"#f59e0b":e.socialClass==="poor"?"#ef4444":"#e2e8f0"})]}),e.events&&e.events.length>0&&t.jsxs("div",{children:[t.jsx("div",{className:"text-[#475569] text-[10px] uppercase tracking-wider font-mono mb-1.5",children:"Life History"}),t.jsx("ul",{className:"space-y-0.5 max-h-24 overflow-y-auto",children:e.events.map((a,s)=>t.jsxs("li",{className:"text-[10px] text-[#64748b] font-mono leading-tight",children:["â€¢ ",a]},s))})]})]})}function B({label:e,value:n,color:o}){return t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"text-[#475569] font-mono",children:e}),t.jsx("span",{className:"font-mono font-medium",style:{color:o||"#e2e8f0"},children:n})]})}function so(e){return e<100?"<$100":e<300?"$100-300":e<800?"$300-800":e<2e3?"$800-2K":e<5e3?"$2K-5K":">$5K"}const He=["<$100","$100-300","$300-800","$800-2K","$2K-5K",">$5K"],ro=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#f59e0b"];function lo({agents:e}){const n=u.useMemo(()=>{if(!(e!=null&&e.length))return[];const i={};He.forEach(a=>{i[a]=0});for(const a of e){if(!a.alive)continue;const s=so(a.wealth);i[s]=(i[s]||0)+1}return He.map((a,s)=>({name:a,count:i[a]||0,fill:ro[s]}))},[e]),o=u.useMemo(()=>{if(!(e!=null&&e.length))return[];const i=e.filter(a=>a.alive).map(a=>Math.max(0,a.wealth));return Ct(i,20)},[e]);return t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:"Wealth Distribution"}),t.jsx("div",{className:"h-28",children:t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(Ue,{data:n,margin:{top:0,right:0,bottom:0,left:-20},children:[t.jsx(M,{dataKey:"name",tick:{fontSize:8,fill:"#475569",fontFamily:"monospace"},axisLine:!1,tickLine:!1}),t.jsx(P,{tick:{fontSize:8,fill:"#475569",fontFamily:"monospace"},axisLine:!1,tickLine:!1}),t.jsx(F,{contentStyle:{background:"#12121a",border:"1px solid #1e1e2e",fontSize:10},labelStyle:{color:"#e2e8f0"},itemStyle:{color:"#6366f1"}}),t.jsx(qe,{dataKey:"count",radius:[2,2,0,0],children:n.map((i,a)=>t.jsx(je,{fill:i.fill},a))})]})})})]}),o.length>2&&t.jsxs("div",{children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:"Lorenz Curve"}),t.jsx("div",{className:"h-24",children:t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(ae,{data:o,margin:{top:0,right:0,bottom:0,left:-20},children:[t.jsx(M,{dataKey:"population",tick:{fontSize:8,fill:"#475569"},axisLine:!1,tickLine:!1,tickFormatter:i=>i+"%"}),t.jsx(P,{tick:{fontSize:8,fill:"#475569"},axisLine:!1,tickLine:!1,tickFormatter:i=>i+"%"}),t.jsx(W,{data:[{population:0,perfect:0},{population:100,perfect:100}],type:"linear",dataKey:"perfect",stroke:"#334155",strokeWidth:1,dot:!1,strokeDasharray:"3 3"}),t.jsx(W,{type:"monotone",dataKey:"wealth",stroke:"#6366f1",strokeWidth:1.5,dot:!1,isAnimationActive:!1}),t.jsx(F,{contentStyle:{background:"#12121a",border:"1px solid #1e1e2e",fontSize:10},formatter:i=>i.toFixed(1)+"%"})]})})}),t.jsx("div",{className:"text-[10px] text-[#334155] text-center font-mono",children:"Area between lines = Gini coefficient"})]})]})}function co({objectives:e=[],scenarioDurationYears:n,year:o,scenarioName:i}){if(!e.length)return t.jsxs("div",{className:"text-[#334155] text-xs font-mono p-2 text-center",children:["No objectives in sandbox mode.",t.jsx("br",{}),t.jsx("span",{className:"text-[#475569]",children:"Pick a Historical Crisis for a timed challenge."})]});const a=n?Math.max(0,n-(o||0)):null,s=e.filter(r=>r.completed).length;return t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"text-[#64748b] text-xs font-mono",children:[s,"/",e.length," objectives met"]}),a!==null&&t.jsxs("div",{className:`text-xs font-mono font-bold ${a<3?"text-[#ef4444]":"text-[#94a3b8]"}`,children:[a,"yr left"]})]}),n&&t.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-1",children:t.jsx("div",{className:"h-1 rounded-full transition-all duration-500 bg-[#6366f1]",style:{width:`${Math.min(100,(o||0)/n*100)}%`}})}),e.map(r=>{const l=r.completed?"#22c55e":r.met?"#f59e0b":"#ef4444",c=r.completed?"Complete":r.met?"Activeâ€¦":"Not met";return t.jsxs("div",{className:"bg-[#12121a] border rounded-lg p-3",style:{borderColor:l+"44"},children:[t.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5 text-xs font-mono text-[#e2e8f0]",children:[t.jsx("span",{children:r.icon}),t.jsx("span",{children:r.label})]}),t.jsx("span",{className:"text-[10px] font-mono flex-shrink-0",style:{color:l},children:c})]}),t.jsx("div",{className:"text-[10px] text-[#475569] mb-1.5",children:r.description}),t.jsx("div",{className:"w-full bg-[#0a0a0f] rounded-full h-1.5 mb-1",children:t.jsx("div",{className:"h-1.5 rounded-full transition-all duration-500",style:{width:`${Math.round(r.progress*100)}%`,backgroundColor:l}})}),r.met&&!r.completed&&r.sustainProgress>0&&t.jsxs("div",{className:"text-[9px] text-[#475569] font-mono",children:["Sustaining: ",Math.round(r.sustainProgress*100),"%"]}),!r.completed&&t.jsxs("div",{className:"text-[9px] text-[#334155] mt-1 leading-tight italic",children:["ðŸ’¡ ",r.tip]})]},r.id)})]})}function uo(e){const n=e.id,o=e.effectOverride||{},i=[];return o.demandMultiplier!==void 0&&i.push(o.demandMultiplier>.7?"â†‘ GDP recovery":"â†“ GDP contraction"),o.wealthCrashPhase!==void 0&&i.push(o.wealthCrashPhase>.5?"â†— Softer crash":"â†˜ Hard crash"),o.deathRateMultiplier!==void 0&&i.push(o.deathRateMultiplier>2?"â†‘â†‘ Deaths":"â†‘ Fewer deaths"),o.techProductivityMultiplier!==void 0&&(i.push(o.techProductivityMultiplier>1.5?"â†‘ GDP spike":"â†’ Moderate growth"),i.push(o.otherJobsAutomatedRate>.1?"â†“â†“ Jobs lost":"â†“ Some jobs lost")),o.foodSupplyMultiplier!==void 0&&i.push(o.foodPriceMultiplier>1.8?"â†‘â†‘ Food prices":"â†‘ Food prices"),e.govDebtPenalty&&i.push(`â†‘ Debt +${e.govDebtPenalty}`),n==="do_nothing"&&(i.push("â†’ Default market response"),i.push("? Outcome uncertain")),i}function ho({choice:e,selected:n,onSelect:o}){const i=uo(e),a=e.id==="do_nothing";return t.jsx("button",{onClick:()=>o(e.id),className:`w-full text-left p-4 rounded-xl border-2 transition-all ${n?"border-[#6366f1] bg-[#6366f111]":a?"border-[#334155] border-dashed bg-[#12121a] hover:border-[#475569]":"border-[#1e1e2e] bg-[#12121a] hover:border-[#334155] hover:bg-[#1a1a28]"}`,children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("span",{className:"text-2xl flex-shrink-0 mt-0.5",children:e.emoji}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"font-bold text-white text-sm mb-1",children:e.label}),t.jsx("p",{className:"text-[#94a3b8] text-xs leading-relaxed mb-2",children:e.description}),t.jsxs("div",{className:"flex items-start gap-1.5 mb-2",children:[t.jsx("span",{className:"text-[#f59e0b] text-[10px] flex-shrink-0 mt-0.5",children:"âš "}),t.jsx("span",{className:"text-[#f59e0b] text-[10px] leading-relaxed",children:e.tradeoff})]}),i.length>0&&t.jsx("div",{className:"flex flex-wrap gap-1",children:i.map((s,r)=>t.jsx("span",{className:`text-[9px] font-mono px-1.5 py-0.5 rounded ${s.startsWith("â†‘")||s.startsWith("â†—")?"bg-[#22c55e22] text-[#22c55e]":s.startsWith("â†“")||s.startsWith("â†˜")?"bg-[#ef444422] text-[#ef4444]":"bg-[#1e1e2e] text-[#64748b]"}`,children:s},r))})]})]})})}function fo({event:e,onChoose:n}){var c,d;const[o,i]=u.useState(null),[a,s]=u.useState(!1);if(!e)return null;const r=()=>{if(o){if(!a){s(!0);return}n(e.id,o)}},l=(c=e.choices)==null?void 0:c.find(p=>p.id===o);return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:t.jsxs("div",{className:"bg-[#0d0d14] border border-[#334155] rounded-2xl p-6 max-w-xl w-full mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("span",{className:"text-4xl",children:e.icon}),t.jsxs("div",{children:[t.jsx("h2",{className:"text-white font-bold text-lg",children:e.name}),t.jsx("p",{className:"text-[#94a3b8] text-sm",children:e.description})]})]}),t.jsxs("div",{className:"border-t border-[#1e1e2e] pt-4 mb-4",children:[t.jsx("p",{className:"text-[#64748b] text-xs font-mono uppercase tracking-wider mb-3",children:"âš¡ Simulation paused â€” your decision required"}),t.jsx("div",{className:"flex flex-col gap-2",children:(d=e.choices)==null?void 0:d.map(p=>t.jsx(ho,{choice:p,selected:o===p.id,onSelect:i},p.id))})]}),a&&l&&t.jsxs("div",{className:"mb-4 p-3 bg-[#1e1e2e] rounded-lg border border-[#334155]",children:[t.jsx("div",{className:"text-[#64748b] text-[10px] uppercase tracking-wider font-mono mb-1",children:"ðŸ“š What history did"}),t.jsx("p",{className:"text-[#94a3b8] text-xs leading-relaxed italic",children:l.historicalNote})]}),t.jsx("button",{onClick:r,disabled:!o,className:`w-full py-3 rounded-xl font-mono font-bold text-sm transition-colors ${o?"bg-[#6366f1] hover:bg-[#818cf8] text-white":"bg-[#1e1e2e] text-[#475569] cursor-not-allowed"}`,children:o?a?"â–¶ Apply and continue":"Confirm â€” see what history did â†’":"Select a response"})]})})}const po={greatDepression:{summary:"The US experienced 10 years of contraction. GDP fell 46% peak-to-trough. Unemployment peaked at 25% in 1933. Deflation wiped out savings.",turningPoint:"FDR's New Deal (1933): bank reform, work programs (CCC, WPA), agricultural relief, and abandoning the gold standard.",whatWorked:"Government spending restarted demand. Banking reform restored confidence. Devaluing the dollar stopped deflation.",whatFailed:"Initial Hoover austerity and Smoot-Hawley tariffs deepened the slump. Balanced-budget orthodoxy was catastrophically wrong.",historicalGrade:"D+",metrics:{gdpChangePercent:-46,peakUnemployment:25,inflationAvg:-6,gini:.63,povertyRate:35,recoveryYears:10},quote:'"The only thing we have to fear is fear itself." â€” FDR, 1933'},weimarHyperinflation:{summary:"Germany printed money to pay WWI reparations. By Nov 1923 a loaf of bread cost 200 billion marks. The middle class was wiped out.",turningPoint:"The Rentenmark (Nov 1923): a new currency backed by land assets, issued by an independent body. Printing stopped cold.",whatWorked:"Completely stopping money creation. Issuing a credible new currency. International loans (Dawes Plan) stabilized reparations.",whatFailed:"There was no painless exit. Savings were permanently destroyed. The political fallout helped fuel the rise of extremism.",historicalGrade:"C",metrics:{gdpChangePercent:-25,peakUnemployment:30,inflationAvg:29500,gini:.7,povertyRate:45,recoveryYears:6},quote:'"Inflation is the most important single factor in the politico-economic history of the Weimar Republic." â€” Adam Fergusson'},stagflation1970s:{summary:"OPEC oil embargo (1973) triggered both high inflation AND high unemployment simultaneously â€” violating Keynesian assumptions.",turningPoint:"Volcker Shock (1979â€“82): Federal Reserve raised rates to 20%, deliberately causing a recession to break inflationary expectations.",whatWorked:"Aggressive interest rate hikes eventually tamed inflation. Supply-side reforms improved productivity.",whatFailed:"Wage-price controls (Nixon 1971) temporarily masked inflation then made it worse. Easy money in the early 70s was a mistake.",historicalGrade:"C+",metrics:{gdpChangePercent:-3,peakUnemployment:13,inflationAvg:11,gini:.4,povertyRate:15,recoveryYears:8},quote:'"Inflation is always and everywhere a monetary phenomenon." â€” Milton Friedman'},crisisOf2008:{summary:"US housing bubble collapsed. Lehman Brothers failed Sep 2008. Global credit froze. Worst recession since the Great Depression.",turningPoint:"TARP bank bailouts ($700B), Fed QE programs ($4T), Obama stimulus ($787B). Slow but sustained recovery 2009â€“2019.",whatWorked:"Massive fiscal stimulus, quantitative easing, and bank recapitalization prevented a second Great Depression.",whatFailed:"Austerity in Europe caused a double-dip recession. Too little debt relief for homeowners prolonged household balance sheet repair.",historicalGrade:"B-",metrics:{gdpChangePercent:-4.3,peakUnemployment:10,inflationAvg:1.5,gini:.47,povertyRate:15,recoveryYears:6},quote:'"We came very close to a complete collapse of the financial system." â€” Ben Bernanke'},japanLostDecade:{summary:"Japan's asset bubble burst in 1991. Despite near-zero rates and stimulus, GDP stagnated for 20+ years. Deflation became entrenched.",turningPoint:"Abenomics (2012): aggressive QE, fiscal stimulus, structural reforms. Partially effective â€” ended deflation but growth remained weak.",whatWorked:"Eventually: currency devaluation, quantitative easing at scale, negative interest rates.",whatFailed:"Years of half-measures and zombie bank forbearance. Failure to force bad debt write-offs kept the economy in stasis.",historicalGrade:"D",metrics:{gdpChangePercent:10,peakUnemployment:5.5,inflationAvg:-.2,gini:.34,povertyRate:16,recoveryYears:20},quote:`"Japan's experience suggests that it's very hard to escape deflation once it becomes entrenched." â€” Ben Bernanke`},nordicMiracle:{summary:"Nordic countries (esp. Sweden 1990s) combined high taxes, strong unions, universal welfare, and open markets into sustained prosperity.",turningPoint:"Sweden's 1990s bank crisis resolution: swift bank nationalization, transparent debt writedowns, then re-privatization. Full recovery in 3 years.",whatWorked:"Universal education and healthcare create a productive workforce. Strong safety nets allow risk-taking. Transparent institutions reduce corruption.",whatFailed:"Model requires high trust, homogeneity, and strong institutions to function. Difficult to replicate in larger, more diverse economies.",historicalGrade:"A",metrics:{gdpChangePercent:35,peakUnemployment:8,inflationAvg:2.1,gini:.27,povertyRate:8,recoveryYears:3},quote:`"The Nordic model is not socialism. It's a highly competitive market economy with strong social insurance." â€” Daron Acemoglu`}};function mo(e){return po[e]||null}const Je={"A+":"#22c55e",A:"#22c55e",B:"#84cc16",C:"#eab308",D:"#f97316",F:"#ef4444"};function be({label:e,score:n}){const o=n>=70?"#22c55e":n>=45?"#eab308":"#ef4444";return t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-1 text-xs font-mono",children:[t.jsx("span",{className:"text-[#94a3b8]",children:e}),t.jsxs("span",{style:{color:o},children:[n,"/100"]})]}),t.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-1.5",children:t.jsx("div",{className:"h-1.5 rounded-full transition-all duration-700",style:{width:`${n}%`,backgroundColor:o}})})]})}function xo({obj:e}){const n=e.completed?"âœ…":e.met?"ðŸ”„":"âŒ",o=e.completed?"#22c55e":e.met?"#f59e0b":"#ef4444";return t.jsxs("div",{className:"flex items-start gap-2 py-1.5 border-b border-[#1e1e2e] last:border-0",children:[t.jsx("span",{className:"text-sm flex-shrink-0 mt-0.5",children:n}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs font-mono text-[#e2e8f0]",children:[e.icon," ",e.label]}),t.jsx("span",{className:"text-xs font-mono",style:{color:o},children:e.completed?"Done":e.met?"In progress":`${Math.round(e.progress*100)}%`})]}),t.jsx("div",{className:"text-[10px] text-[#475569] mt-0.5",children:e.description})]})]})}function go({playerOutcome:e,historicalOutcome:n}){var i;if(!n)return null;const o=[{label:"GDP Change",player:`${e.gdpChangePercent>0?"+":""}${e.gdpChangePercent}%`,history:`${n.metrics.gdpChangePercent}%`,betterIfHigher:!0,playerVal:e.gdpChangePercent,histVal:n.metrics.gdpChangePercent},{label:"Peak Unemployment",player:`${e.peakUnemployment}%`,history:`${n.metrics.peakUnemployment}%`,betterIfHigher:!1,playerVal:e.peakUnemployment,histVal:n.metrics.peakUnemployment},{label:"Avg Inflation",player:`${e.inflationAvg}%`,history:`${n.metrics.inflationAvg}%`,betterIfHigher:null,playerVal:Math.abs(e.inflationAvg),histVal:Math.abs(n.metrics.inflationAvg)},{label:"Gini Coefficient",player:e.gini.toFixed(2),history:n.metrics.gini.toFixed(2),betterIfHigher:!1,playerVal:e.gini,histVal:n.metrics.gini},{label:"Poverty Rate",player:`${e.povertyRate}%`,history:`${n.metrics.povertyRate}%`,betterIfHigher:!1,playerVal:e.povertyRate,histVal:n.metrics.povertyRate}];return t.jsxs("div",{children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-3",children:"You vs History"}),t.jsxs("div",{className:"bg-[#0d0d14] rounded-xl overflow-hidden border border-[#1e1e2e]",children:[t.jsxs("div",{className:"grid grid-cols-3 text-[10px] font-mono text-[#475569] px-3 py-1.5 border-b border-[#1e1e2e]",children:[t.jsx("span",{children:"Metric"}),t.jsx("span",{className:"text-center text-[#6366f1]",children:"You"}),t.jsx("span",{className:"text-center",children:"History"})]}),o.map(a=>{let s="#e2e8f0";return a.betterIfHigher===!0?s=a.playerVal>=a.histVal?"#22c55e":"#ef4444":a.betterIfHigher===!1&&(s=a.playerVal<=a.histVal?"#22c55e":"#ef4444"),t.jsxs("div",{className:"grid grid-cols-3 px-3 py-1.5 text-xs font-mono border-b border-[#0a0a0f] last:border-0",children:[t.jsx("span",{className:"text-[#64748b]",children:a.label}),t.jsx("span",{className:"text-center font-bold",style:{color:s},children:a.player}),t.jsx("span",{className:"text-center text-[#475569]",children:a.history})]},a.label)})]}),t.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs font-mono text-[#475569] px-1",children:[t.jsxs("span",{children:["History's grade: ",t.jsx("span",{style:{color:Je[n.historicalGrade]||"#94a3b8"},className:"font-bold",children:n.historicalGrade})]}),t.jsxs("span",{className:"text-[10px] italic",children:['"',(i=n.quote)==null?void 0:i.slice(0,50),'â€¦"']})]})]})}function bo({report:e,onRetry:n,onNextScenario:o}){var r;if(!e)return null;const i=mo(e.scenarioId),a=Je[e.grade]||"#94a3b8",s=i&&e.finalScore>({"A+":95,A:85,B:70,C:55,D:40,F:20}[i.historicalGrade]||50);return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/85 backdrop-blur-sm",children:t.jsxs("div",{className:"bg-[#0d0d14] border border-[#1e1e2e] rounded-2xl p-6 max-w-lg w-full mx-4 max-h-[92vh] overflow-y-auto shadow-2xl",children:[t.jsxs("div",{className:"text-center mb-5",children:[t.jsx("div",{className:"text-6xl font-bold font-mono mb-1",style:{color:a},children:e.grade}),t.jsx("div",{className:"text-white font-bold text-lg",children:e.scenarioName}),t.jsxs("div",{className:"text-[#64748b] text-sm",children:["Year ",e.year," Â· Score ",e.finalScore,"/100"]}),s&&t.jsx("div",{className:"mt-2 text-[#22c55e] text-sm font-mono",children:"ðŸ† You did better than history!"})]}),t.jsxs("div",{className:"bg-[#12121a] rounded-xl p-4 mb-4 flex flex-col gap-2.5",children:[t.jsx(be,{label:"Equality",score:e.domains.equality.score}),t.jsx(be,{label:"Growth",score:e.domains.growth.score}),t.jsx(be,{label:"Stability",score:e.domains.stability.score})]}),((r=e.objectives)==null?void 0:r.length)>0&&t.jsxs("div",{className:"bg-[#12121a] rounded-xl p-4 mb-4",children:[t.jsx("div",{className:"text-[#64748b] text-xs uppercase tracking-wider font-mono mb-2",children:"Objectives"}),e.objectives.map(l=>t.jsx(xo,{obj:l},l.id))]}),i&&t.jsxs("div",{className:"bg-[#12121a] rounded-xl p-4 mb-4",children:[t.jsx(go,{playerOutcome:e.playerOutcome,historicalOutcome:i}),t.jsxs("div",{className:"mt-3 border-t border-[#1e1e2e] pt-3",children:[t.jsx("div",{className:"text-[10px] text-[#475569] font-mono uppercase tracking-wider mb-1",children:"What worked in history"}),t.jsx("p",{className:"text-[#64748b] text-xs leading-relaxed",children:i.whatWorked})]})]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:n,className:"flex-1 py-3 rounded-xl border border-[#1e1e2e] text-[#94a3b8] hover:border-[#6366f1] hover:text-[#6366f1] font-mono text-sm transition-colors",children:"â†º Try Again"}),t.jsx("button",{onClick:o,className:"flex-1 py-3 rounded-xl bg-[#6366f1] hover:bg-[#818cf8] text-white font-mono font-bold text-sm transition-colors",children:"Next Challenge â†’"})]})]})})}const R={contentStyle:{background:"#0d0d14",border:"1px solid #334155",borderRadius:8,fontSize:11,fontFamily:"monospace"},labelStyle:{color:"#94a3b8"},itemStyle:{color:"#e2e8f0"}},w={tick:{fill:"#475569",fontSize:9,fontFamily:"monospace"},axisLine:{stroke:"#1e1e2e"},tickLine:!1};function A({title:e,subtitle:n,color:o="#6366f1",children:i,wide:a=!1}){return t.jsxs("div",{className:`bg-[#0d0d14] border border-[#1e1e2e] rounded-xl p-3 flex flex-col gap-2 ${a?"col-span-2":""}`,children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-mono font-bold text-[#e2e8f0]",style:{color:o},children:e}),n&&t.jsx("div",{className:"text-[10px] font-mono text-[#475569]",children:n})]}),t.jsx("div",{className:"flex-1",style:{minHeight:150},children:i})]})}function yo({history:e}){const n=(e.gdp||[]).map((o,i)=>({i,gdp:o}));return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(Z,{data:n,margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"gdpGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#6366f1",stopOpacity:.4}),t.jsx("stop",{offset:"95%",stopColor:"#6366f1",stopOpacity:.02})]})}),t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:o=>`${Math.round(o/52)}y`,interval:Math.floor((n.length-1)/5)}),t.jsx(P,{...w,tickFormatter:o=>o>=1e6?`${(o/1e6).toFixed(0)}M`:o>=1e3?`${(o/1e3).toFixed(0)}K`:o,width:36}),t.jsx(F,{...R,formatter:o=>["$"+fe(o),"GDP"],labelFormatter:o=>`Year ${Math.round(o/52)}`}),t.jsx(Q,{type:"monotone",dataKey:"gdp",stroke:"#6366f1",fill:"url(#gdpGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function vo({history:e}){const n=Math.min((e.unemployment||[]).length,(e.inflation||[]).length),o=Array.from({length:n},(i,a)=>({i:a,unemployment:e.unemployment[a],inflation:e.inflation[a]}));return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(ae,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:i=>`${Math.round(i/52)}y`,interval:Math.floor((o.length-1)/5)}),t.jsx(P,{...w,tickFormatter:i=>i.toFixed(0)+"%",width:36}),t.jsx(F,{...R,formatter:(i,a)=>[i.toFixed(1)+"%",a==="unemployment"?"Unemployment":"Inflation"],labelFormatter:i=>`Year ${Math.round(i/52)}`}),t.jsx(Y,{y:5,stroke:"#475569",strokeDasharray:"3 3"}),t.jsx(W,{type:"monotone",dataKey:"unemployment",stroke:"#f59e0b",strokeWidth:2,dot:!1,isAnimationActive:!1}),t.jsx(W,{type:"monotone",dataKey:"inflation",stroke:"#ef4444",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}const he={food:"#22c55e",housing:"#06b6d4",tech:"#6366f1",luxury:"#f59e0b"};function wo({sectorPrices:e}){const n=e||{},o=Math.max(...Object.values(n).map(a=>(a==null?void 0:a.length)||0),0),i=Array.from({length:o},(a,s)=>{var r,l,c,d;return{i:s,food:(r=n.food)==null?void 0:r[s],housing:(l=n.housing)==null?void 0:l[s],tech:(c=n.tech)==null?void 0:c[s],luxury:(d=n.luxury)==null?void 0:d[s]}});return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(ae,{data:i,margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:a=>`${Math.round(a/52)}y`,interval:Math.floor((i.length-1)/5)}),t.jsx(P,{...w,tickFormatter:a=>"$"+(a==null?void 0:a.toFixed(0)),width:36}),t.jsx(F,{...R,formatter:(a,s)=>["$"+(a||0).toFixed(1),s],labelFormatter:a=>`Year ${Math.round(a/52)}`}),Object.entries(he).map(([a,s])=>t.jsx(W,{type:"monotone",dataKey:a,stroke:s,strokeWidth:1.5,dot:!1,isAnimationActive:!1},a))]})})}function jo({history:e}){const n=Math.min((e.gini||[]).length,(e.poverty||[]).length),o=Array.from({length:n},(i,a)=>({i:a,gini:e.gini[a]*100,poverty:e.poverty[a]}));return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(ae,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:i=>`${Math.round(i/52)}y`,interval:Math.floor((o.length-1)/5)}),t.jsx(P,{...w,tickFormatter:i=>i.toFixed(0),width:28,domain:[0,100]}),t.jsx(F,{...R,formatter:(i,a)=>[i.toFixed(1),a==="gini"?"Gini Ã—100":"Poverty %"],labelFormatter:i=>`Year ${Math.round(i/52)}`}),t.jsx(Y,{y:50,stroke:"#ef444444",strokeDasharray:"3 3"}),t.jsx(W,{type:"monotone",dataKey:"gini",stroke:"#ec4899",strokeWidth:2,dot:!1,isAnimationActive:!1}),t.jsx(W,{type:"monotone",dataKey:"poverty",stroke:"#f97316",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function ko({history:e}){const n=(e.govBudget||[]).map((o,i)=>({i,budget:o,fill:o>=0?"#22c55e":"#ef4444"}));return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(Ue,{data:n,margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:o=>`${Math.round(o/52)}y`,interval:Math.floor((n.length-1)/5)}),t.jsx(P,{...w,tickFormatter:o=>o>=1e3?`${(o/1e3).toFixed(0)}K`:o,width:36}),t.jsx(F,{...R,formatter:o=>[fe(o),o>=0?"Surplus":"Deficit"],labelFormatter:o=>`Year ${Math.round(o/52)}`}),t.jsx(Y,{y:0,stroke:"#475569"}),t.jsx(qe,{dataKey:"budget",radius:[1,1,0,0],isAnimationActive:!1,children:n.map((o,i)=>t.jsx(je,{fill:o.fill},i))})]})})}function No({history:e}){const n=(e.population||[]).map((o,i)=>({i,pop:o}));return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(Z,{data:n,margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"popGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#06b6d4",stopOpacity:.4}),t.jsx("stop",{offset:"95%",stopColor:"#06b6d4",stopOpacity:.02})]})}),t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:o=>`${Math.round(o/52)}y`,interval:Math.floor((n.length-1)/5)}),t.jsx(P,{...w,width:28}),t.jsx(F,{...R,formatter:o=>[o,"Population"],labelFormatter:o=>`Year ${Math.round(o/52)}`}),t.jsx(Q,{type:"monotone",dataKey:"pop",stroke:"#06b6d4",fill:"url(#popGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function Co({history:e}){const n=e.unemployment||[],o=e.inflation||[],i=Math.min(n.length,o.length),a=Array.from({length:i},(s,r)=>({x:n[r],y:o[r],age:r/i})).slice(-120);return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(mt,{margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"x",...w,name:"Unemployment",tickFormatter:s=>(s==null?void 0:s.toFixed(0))+"%",label:{value:"Unemployment %",position:"insideBottom",offset:-2,style:{fill:"#475569",fontSize:9}}}),t.jsx(P,{dataKey:"y",...w,name:"Inflation",tickFormatter:s=>(s==null?void 0:s.toFixed(0))+"%",width:28}),t.jsx(F,{...R,formatter:(s,r)=>[(s==null?void 0:s.toFixed(1))+"%",r==="x"?"Unemployment":"Inflation"]}),t.jsx(Y,{y:0,stroke:"#47556999"}),t.jsx(xt,{data:a,isAnimationActive:!1,children:a.map((s,r)=>t.jsx(je,{fill:`hsl(${240+s.age*90}, 80%, ${30+s.age*40}%)`},r))})]})})}function To({history:e}){const n=(e.businessCount||[]).map((o,i)=>({i,count:o}));return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(Z,{data:n,margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"bizGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#f59e0b",stopOpacity:.4}),t.jsx("stop",{offset:"95%",stopColor:"#f59e0b",stopOpacity:.02})]})}),t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:o=>`${Math.round(o/52)}y`,interval:Math.floor((n.length-1)/5)}),t.jsx(P,{...w,width:28}),t.jsx(F,{...R,formatter:o=>[o,"Businesses"],labelFormatter:o=>`Year ${Math.round(o/52)}`}),t.jsx(Q,{type:"monotone",dataKey:"count",stroke:"#f59e0b",fill:"url(#bizGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function So({history:e}){const n=Math.min((e.wages||[]).length,(e.medianWealth||[]).length),o=Array.from({length:n},(i,a)=>({i:a,wage:e.wages[a],median:e.medianWealth[a]}));return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(ae,{data:o,margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:i=>`${Math.round(i/52)}y`,interval:Math.floor((o.length-1)/5)}),t.jsx(P,{...w,tickFormatter:i=>"$"+(i==null?void 0:i.toFixed(0)),width:36}),t.jsx(F,{...R,formatter:(i,a)=>["$"+(i||0).toFixed(1),a==="wage"?"Avg Wage":"Median Wealth"],labelFormatter:i=>`Year ${Math.round(i/52)}`}),t.jsx(W,{type:"monotone",dataKey:"wage",stroke:"#22c55e",strokeWidth:2,dot:!1,isAnimationActive:!1}),t.jsx(W,{type:"monotone",dataKey:"median",stroke:"#8b5cf6",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function Mo({history:e}){var i;const n=(e.cpi||[]).map((a,s)=>({i:s,cpi:a})),o=((i=n[0])==null?void 0:i.cpi)||100;return t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(Z,{data:n,margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"cpiGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#f97316",stopOpacity:.4}),t.jsx("stop",{offset:"95%",stopColor:"#f97316",stopOpacity:.02})]})}),t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:a=>`${Math.round(a/52)}y`,interval:Math.floor((n.length-1)/5)}),t.jsx(P,{...w,domain:["auto","auto"],width:36}),t.jsx(F,{...R,formatter:a=>[a.toFixed(1),"CPI Index"],labelFormatter:a=>`Year ${Math.round(a/52)}`}),t.jsx(Y,{y:o,stroke:"#47556966",strokeDasharray:"3 3",label:{value:"Baseline",style:{fill:"#475569",fontSize:9}}}),t.jsx(Y,{y:o*2,stroke:"#ef444444",strokeDasharray:"3 3"}),t.jsx(Q,{type:"monotone",dataKey:"cpi",stroke:"#f97316",fill:"url(#cpiGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})}function O({label:e,value:n,color:o="#94a3b8",bg:i="#1e1e2e"}){return t.jsxs("div",{className:"flex flex-col items-center px-3 py-2 rounded-lg",style:{backgroundColor:i+"44"},children:[t.jsx("span",{className:"text-[10px] font-mono text-[#64748b] uppercase tracking-wider",children:e}),t.jsx("span",{className:"text-sm font-bold font-mono mt-0.5",style:{color:o},children:n})]})}function q({color:e,label:n}){return t.jsxs("span",{className:"flex items-center gap-1 text-[10px] font-mono text-[#64748b]",children:[t.jsx("span",{className:"w-2 h-2 rounded-full inline-block flex-shrink-0",style:{background:e}}),n]})}function Po({metrics:e,market:n,onClose:o}){const i=(e==null?void 0:e.history)||{},a=(e==null?void 0:e.year)??0,s=(((e==null?void 0:e.gini)??0)*100).toFixed(1),r=((e==null?void 0:e.gini)??0)>.5?"#ef4444":((e==null?void 0:e.gini)??0)>.35?"#f59e0b":"#22c55e";((e==null?void 0:e.cpi)??100).toFixed(1);const l=((e==null?void 0:e.inflation)??0).toFixed(2),c=(((e==null?void 0:e.unemployment)??0)*100).toFixed(1),d=(((e==null?void 0:e.povertyRate)??0)*100).toFixed(1),p="$"+fe((e==null?void 0:e.gdp)??0),h="$"+fe(Math.abs((e==null?void 0:e.govDebt)??0)),g=(e==null?void 0:e.population)??0,m=(e==null?void 0:e.businessCount)??0;return t.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 backdrop-blur-sm overflow-y-auto",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-white font-bold text-xl font-mono",children:"ðŸ“Š Macroeconomic Dashboard"}),t.jsxs("p",{className:"text-[#64748b] text-sm font-mono",children:["Year ",a," Â· Live simulation statistics"]})]}),t.jsx("button",{onClick:o,className:"text-[#475569] hover:text-white text-2xl transition-colors leading-none",children:"âœ•"})]}),t.jsxs("div",{className:"grid grid-cols-4 sm:grid-cols-8 gap-2 mb-4",children:[t.jsx(O,{label:"GDP",value:p,color:"#6366f1",bg:"#6366f1"}),t.jsx(O,{label:"Growth",value:(((e==null?void 0:e.gdpGrowth)??0)*100).toFixed(2)+"%",color:((e==null?void 0:e.gdpGrowth)??0)>=0?"#22c55e":"#ef4444",bg:((e==null?void 0:e.gdpGrowth)??0)>=0?"#22c55e":"#ef4444"}),t.jsx(O,{label:"Unemploy",value:c+"%",color:parseFloat(c)>15?"#ef4444":"#f59e0b",bg:"#f59e0b"}),t.jsx(O,{label:"Inflation",value:l+"%",color:parseFloat(l)>5?"#ef4444":"#94a3b8",bg:"#f97316"}),t.jsx(O,{label:"Gini",value:s,color:r,bg:r}),t.jsx(O,{label:"Poverty",value:d+"%",color:parseFloat(d)>25?"#ef4444":"#94a3b8",bg:"#ec4899"}),t.jsx(O,{label:"Gov Debt",value:h,color:((e==null?void 0:e.govDebt)??0)>2e3?"#ef4444":"#94a3b8",bg:"#64748b"}),t.jsx(O,{label:"Pop / Biz",value:`${g} / ${m}`,color:"#06b6d4",bg:"#06b6d4"})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-3",children:[t.jsx(A,{title:"GDP",subtitle:"Total economic output over time",color:"#6366f1",children:t.jsx(yo,{history:i})}),t.jsxs(A,{title:"Unemployment & Inflation",subtitle:"â€” unemployment  â€” inflation",color:"#f59e0b",children:[t.jsx(vo,{history:i}),t.jsxs("div",{className:"flex gap-3 mt-1",children:[t.jsx(q,{color:"#f59e0b",label:"Unemployment %"}),t.jsx(q,{color:"#ef4444",label:"Inflation %"})]})]}),t.jsx(A,{title:"CPI Index",subtitle:"Consumer price index â€” baseline = 100",color:"#f97316",children:t.jsx(Mo,{history:i})}),t.jsxs(A,{title:"Sector Prices",subtitle:"Food Â· Housing Â· Tech Â· Luxury",color:"#22c55e",children:[t.jsx(wo,{sectorPrices:i.sectorPrices}),t.jsx("div",{className:"flex flex-wrap gap-3 mt-1",children:Object.entries(he).map(([x,j])=>t.jsx(q,{color:j,label:x},x))})]}),t.jsxs(A,{title:"Inequality",subtitle:"â€” Gini Ã—100  â€” Poverty %",color:"#ec4899",children:[t.jsx(jo,{history:i}),t.jsxs("div",{className:"flex gap-3 mt-1",children:[t.jsx(q,{color:"#ec4899",label:"Gini Ã—100"}),t.jsx(q,{color:"#f97316",label:"Poverty %"})]})]}),t.jsx(A,{title:"Gov Budget",subtitle:"Green = surplus Â· Red = deficit",color:"#22c55e",children:t.jsx(ko,{history:i})}),t.jsx(A,{title:"Phillips Curve",subtitle:"Inflation vs unemployment â€” color = time (dark=old)",color:"#8b5cf6",children:t.jsx(Co,{history:i})}),t.jsx(A,{title:"Population",subtitle:"Total alive agents",color:"#06b6d4",children:t.jsx(No,{history:i})}),t.jsxs(A,{title:"Wages & Wealth",subtitle:"â€” avg wage  â€” median wealth",color:"#22c55e",children:[t.jsx(So,{history:i}),t.jsxs("div",{className:"flex gap-3 mt-1",children:[t.jsx(q,{color:"#22c55e",label:"Avg Wage"}),t.jsx(q,{color:"#8b5cf6",label:"Median Wealth"})]})]}),t.jsx(A,{title:"Business Count",subtitle:"Active firms over time",color:"#f59e0b",children:t.jsx(To,{history:i})}),t.jsx(A,{title:"Sector Snapshot",subtitle:"Current supply vs demand",color:"#06b6d4",children:t.jsx("div",{className:"flex flex-col gap-2 mt-2",children:["food","housing","tech","luxury"].map(x=>{var L,re,ee;const j=((L=n==null?void 0:n.prices)==null?void 0:L[x])??0,v=((re=n==null?void 0:n.supply)==null?void 0:re[x])??0,y=((ee=n==null?void 0:n.demand)==null?void 0:ee[x])??0,T=y/Math.max(v,1),G=T>1.2?"#ef4444":T<.8?"#22c55e":"#f59e0b",se=Math.min(100,v/Math.max(y,1)*50);return t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[t.jsx("span",{className:"text-xs font-mono capitalize",style:{color:he[x]},children:x}),t.jsxs("span",{className:"text-xs font-mono font-bold",style:{color:G},children:["$",j.toFixed(1)]})]}),t.jsxs("div",{className:"flex gap-1 items-center",children:[t.jsx("div",{className:"flex-1 h-1.5 bg-[#1e1e2e] rounded-full overflow-hidden",children:t.jsx("div",{className:"h-1.5 rounded-full transition-all duration-500",style:{width:`${se}%`,backgroundColor:he[x]}})}),t.jsxs("span",{className:"text-[9px] font-mono text-[#475569] w-16 text-right",children:["S:",v.toFixed(0)," D:",y.toFixed(0)]})]})]},x)})})}),t.jsx(A,{title:"Social Unrest",subtitle:"% of population in unrest",color:"#ef4444",children:t.jsx(S,{width:"100%",height:"100%",children:t.jsxs(Z,{data:(i.unrest||[]).map((x,j)=>({i:j,unrest:x})),margin:{top:4,right:4,left:0,bottom:0},children:[t.jsx("defs",{children:t.jsxs("linearGradient",{id:"unrestGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.4}),t.jsx("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:.02})]})}),t.jsx(_,{strokeDasharray:"3 3",stroke:"#1e1e2e"}),t.jsx(M,{dataKey:"i",...w,tickFormatter:x=>`${Math.round(x/52)}y`,interval:Math.floor(((i.unrest||[]).length-1)/5)}),t.jsx(P,{...w,tickFormatter:x=>x.toFixed(0)+"%",width:32,domain:[0,100]}),t.jsx(F,{...R,formatter:x=>[x.toFixed(1)+"%","Unrest"],labelFormatter:x=>`Year ${Math.round(x/52)}`}),t.jsx(Y,{y:50,stroke:"#ef444466",strokeDasharray:"3 3"}),t.jsx(Q,{type:"monotone",dataKey:"unrest",stroke:"#ef4444",fill:"url(#unrestGrad)",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})})]}),t.jsxs("div",{className:"mt-4 text-center text-[#334155] text-xs font-mono pb-4",children:["Data updates every 10 ticks Â· Last ",(i.gdp||[]).length," data points shown"]})]})})}function fe(e){return e==null||isNaN(e)?"0":Math.abs(e)>=1e9?(e/1e9).toFixed(1)+"B":Math.abs(e)>=1e6?(e/1e6).toFixed(1)+"M":Math.abs(e)>=1e3?(e/1e3).toFixed(1)+"K":Math.round(e).toString()}function Fo({chapter:e,onBegin:n,onBack:o,chapterScore:i}){const[a,s]=u.useState(!0),r=e.openingNarrative.trim().split(`

`);return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",children:t.jsxs("div",{className:"max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto rounded-2xl border p-8 shadow-2xl",style:{borderColor:e.color+"55",background:"#0a0a0f"},children:[t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx("span",{className:"text-5xl",children:e.icon}),t.jsxs("div",{children:[t.jsxs("div",{className:"text-xs font-mono uppercase tracking-widest mb-1",style:{color:e.color},children:["Chapter ",e.number," Â· ",e.era]}),t.jsx("h2",{className:"text-white font-bold text-2xl leading-tight",children:e.title}),t.jsx("p",{className:"text-[#64748b] text-sm mt-0.5 italic",children:e.tagline})]})]}),i!==void 0&&t.jsx("div",{className:"mb-5 p-3 rounded-lg border text-xs font-mono",style:{borderColor:e.color+"33",background:e.color+"11"},children:t.jsxs("span",{style:{color:e.color},children:["â—€ Chapter ",e.number-1," score: ",i,"/100 â€” you've earned this chapter"]})}),t.jsx("div",{className:"mb-6 space-y-4",children:r.map((l,c)=>t.jsx("p",{className:`font-mono leading-relaxed ${c===0?"text-white text-sm font-bold":"text-[#94a3b8] text-sm"}`,children:l},c))}),t.jsxs("div",{className:"mb-6 p-4 rounded-xl border border-[#1e1e2e] bg-[#12121a]",children:[t.jsx("div",{className:"text-[10px] font-mono text-[#475569] uppercase tracking-wider mb-3",children:"Your objectives"}),t.jsx("div",{className:"flex flex-col gap-2",children:e.objectives.map(l=>t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("span",{className:"text-base flex-shrink-0",children:l.icon}),t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-mono font-bold text-[#e2e8f0]",children:l.label}),t.jsx("div",{className:"text-[10px] text-[#64748b]",children:l.description})]})]},l.id))}),t.jsxs("div",{className:"mt-3 text-[10px] font-mono text-[#334155]",children:["â± You have ",e.durationYears," in-game years"]})]}),t.jsxs("div",{className:"flex gap-3",children:[o&&t.jsx("button",{onClick:o,className:"flex-none px-4 py-2.5 rounded-xl text-xs font-mono border border-[#1e1e2e] text-[#475569] hover:text-[#94a3b8] transition-colors",children:"â† Back"}),t.jsxs("button",{onClick:n,className:"flex-1 py-3 rounded-xl font-mono font-bold text-sm text-white transition-colors",style:{background:e.color},children:["â–¶ Begin Chapter ",e.number]})]})]})})}function Ao({grade:e,color:n}){return t.jsx("div",{className:"w-20 h-20 rounded-full border-4 flex items-center justify-center flex-shrink-0",style:{borderColor:n},children:t.jsx("span",{className:"text-3xl font-bold font-mono",style:{color:n},children:e})})}function Io({obj:e}){const n=e.completed?"#22c55e":"#ef4444",o=e.completed?"âœ“":"âœ—";return t.jsxs("div",{className:"flex items-center gap-2 py-1.5 border-b border-[#1e1e2e] last:border-0",children:[t.jsx("span",{className:"text-sm font-bold",style:{color:n},children:o}),t.jsx("span",{className:"text-sm",children:e.icon}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-xs font-mono font-bold",style:{color:e.completed?"#e2e8f0":"#64748b"},children:e.label}),t.jsx("div",{className:"text-[10px] text-[#475569]",children:e.description})]}),t.jsx("div",{className:"w-12 h-1.5 rounded-full bg-[#1e1e2e] overflow-hidden flex-shrink-0",children:t.jsx("div",{className:"h-1.5 rounded-full transition-all",style:{width:`${Math.round((e.progress||0)*100)}%`,backgroundColor:n}})})]})}function _o({chapter:e,objectives:n=[],score:o,onNextChapter:i,onReplay:a,isLastChapter:s}){const{grade:r,label:l,color:c}=Ve(o),d=Zt(o),h=e.closingNarrative[d].trim().split(`

`);return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-sm",children:t.jsxs("div",{className:"max-w-xl w-full mx-4 max-h-[90vh] overflow-y-auto rounded-2xl border p-6 shadow-2xl",style:{borderColor:c+"55",background:"#0a0a0f"},children:[t.jsxs("div",{className:"flex items-center gap-4 mb-5",children:[t.jsx(Ao,{grade:r,color:c}),t.jsxs("div",{children:[t.jsxs("div",{className:"text-[10px] font-mono text-[#475569] uppercase tracking-widest mb-0.5",children:["Chapter ",e.number," Complete"]}),t.jsx("h2",{className:"text-white font-bold text-xl",children:e.title}),t.jsxs("div",{className:"text-sm font-mono mt-0.5",style:{color:c},children:[l," â€” ",o,"/100"]})]})]}),t.jsx("div",{className:"w-full bg-[#1e1e2e] rounded-full h-2 mb-5",children:t.jsx("div",{className:"h-2 rounded-full transition-all duration-1000",style:{width:`${o}%`,backgroundColor:c}})}),t.jsxs("div",{className:"bg-[#12121a] border border-[#1e1e2e] rounded-xl p-3 mb-4",children:[t.jsx("div",{className:"text-[10px] font-mono text-[#475569] uppercase tracking-wider mb-2",children:"Objectives"}),n.map(g=>t.jsx(Io,{obj:g},g.id))]}),t.jsxs("div",{className:"mb-5 p-4 rounded-xl",style:{background:c+"11",border:`1px solid ${c}33`},children:[t.jsx("div",{className:"text-[10px] font-mono uppercase tracking-wider mb-2",style:{color:c},children:"Historical verdict"}),h.map((g,m)=>t.jsx("p",{className:"text-[#94a3b8] text-xs leading-relaxed mb-1.5",children:g},m))]}),t.jsxs("div",{className:"flex gap-3",children:[t.jsx("button",{onClick:a,className:"flex-none px-4 py-2.5 rounded-xl text-xs font-mono border border-[#1e1e2e] text-[#475569] hover:text-[#94a3b8] transition-colors",children:"â†º Replay"}),s?t.jsx("button",{onClick:i,className:"flex-1 py-3 rounded-xl font-mono font-bold text-sm text-white bg-[#6366f1] hover:bg-[#818cf8] transition-colors",children:"ðŸ† Campaign Complete"}):t.jsxs("button",{onClick:i,className:"flex-1 py-3 rounded-xl font-mono font-bold text-sm text-white transition-colors",style:{background:c},children:["â†’ Chapter ",e.number+1]})]})]})})}function Ro(e,n){const o={incomeTax:[0,.6],corporateTax:[0,.5],minWage:[0,50],ubi:[0,1e3],interestRate:[0,.2],educationFunding:[0,1],unemploymentBenefit:[0,500],printMoney:[0,100],wealthTax:[0,.05],robotTax:[0,.5],mandatoryProfitShare:[0,.3],landValueTax:[0,.05],helicopterMoney:[0,500],maximumWage:[0,500],wealthConfiscation:[0,.5],punitiveTargiffs:[0,2]};if(e in o){const[i,a]=o[e];return Nt(Number(n),i,a)}return n}const Xe="ecomsim_save",Ce="ecomsim_story";function Eo(e){try{localStorage.setItem(Xe+"_scenario",e)}catch{}}function Bo(){try{return localStorage.getItem(Xe+"_scenario")||"freeMarket"}catch{return"freeMarket"}}function Do(e){try{localStorage.setItem(Ce,JSON.stringify(e))}catch{}}function Wo(){try{const e=localStorage.getItem(Ce);return e?JSON.parse(e):{unlockedChapter:1,scores:{}}}catch{return{unlockedChapter:1,scores:{}}}}function Go(){try{localStorage.removeItem(Ce)}catch{}}const $o="modulepreload",Ho=function(e){return"/ecomsim/"+e},Oe={},Oo=function(n,o,i){let a=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));a=Promise.allSettled(o.map(c=>{if(c=Ho(c),c in Oe)return;Oe[c]=!0;const d=c.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":$o,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((g,m)=>{h.addEventListener("load",g),h.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(r){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=r,window.dispatchEvent(l),!l.defaultPrevented)throw r}return a.then(r=>{for(const l of r||[])l.status==="rejected"&&s(l.reason);return n().catch(s)})};let K=null,ue=!1,ye=[],ve=null;const Lo="af_sky",Uo="onnx-community/Kokoro-82M-v1.0-ONNX",J={monopoly_forming:"Warning. One company now dominates the market. Without competition, prices are rising and innovation is slowing.",high_inequality:"Inequality has reached extreme levels. The Gini coefficient indicates the top few now own most of the wealth.",high_unemployment:"Mass unemployment is spreading. A vicious cycle: fewer workers means less spending, which means even more layoffs.",inflation_spiral:"Inflation warning. Prices are rising faster than wages. Your population's purchasing power is eroding.",min_wage_tradeoff:"Minimum wage tradeoff observed. Living standards improved, but some small businesses can no longer afford to hire.",budget_surplus:"Fiscal surplus achieved. Tax revenue now exceeds government spending.",stagnation:"Stagflation risk. The economy is shrinking while unemployment rises â€” the classic policy dilemma.",poverty_trap:"Poverty trap forming. Workers in poverty cannot afford education or healthcare, keeping them trapped.",ubi_effect:"Universal Basic Income is reducing poverty. Some residents are using the security to start new businesses.",policy_fourDayWeek_on:"The four-day work week is now law. Workers rejoice. Friday afternoons are sacred. Economists nervously check productivity spreadsheets.",policy_fourDayWeek_off:"The four-day work week has been repealed. Monday through Friday, back to the grind.",policy_robotTax_on:"A robot tax has been introduced. For every job automated away, the tech sector must pay. Silicon Valley is not pleased.",policy_breadAndCircuses_on:"Bread and circuses for all! The government is handing out free food and entertainment. Unrest is falling. Economists are horrified.",policy_breadAndCircuses_off:"The bread and circuses program has ended. Let's see how long the calm lasts.",policy_mandatoryProfitShare_on:"Mandatory profit sharing is now law. Businesses must distribute a cut of profits to every worker. Workers approve. Shareholders do not.",policy_mandatoryProfitShare_off:"Mandatory profit sharing repealed. The windfall stays with the owners again.",policy_landValueTax_on:"A land value tax has been enacted. Henry George would be proud. Landowners are furious. Economists say this is actually the most efficient tax possible.",policy_banAdvertising_on:"Advertising is banned. No more billboards, no more commercials, no more targeted manipulation. The luxury sector is experiencing an identity crisis.",policy_banAdvertising_off:"The advertising ban is lifted. The bombardment of commercial messages resumes immediately.",policy_debtJubilee_on:"DEBT JUBILEE! All debts are cancelled â€” right now, this instant. It is a Biblical reset. The slate is wiped clean. This happens only once.",policy_lotteryRedistribution_on:"The wealth lottery is running. Random rich citizens are paying a luck tax directly to random poor ones. It's chaotic. It's arbitrary. It's weirdly effective.",policy_lotteryRedistribution_off:"The wealth lottery has ended. The rich breathe a sigh of relief.",policy_sumptuary_on:"Sumptuary laws are in effect. The wealthy may no longer spend freely on luxury goods. Medieval rulers used this to maintain social order. It also destroyed the luxury economy.",policy_sumptuary_off:"Sumptuary laws repealed. The luxury market roars back to life.",policy_degrowth_on:"Degrowth policy enacted. The government has officially stopped chasing GDP growth. Economists are having a meltdown. Everyone else is working less and feeling healthier.",policy_degrowth_off:"Degrowth policy abandoned. Back to the infinite growth imperative.",policy_algoCentralPlanning_on:"Algorithmic central planning is online. An AI now sets all prices. The market volatility disappears. So does the spontaneous order. It is efficient. It is cold. It is watching.",policy_algoCentralPlanning_off:"The algorithm has been shut down. Prices will now rediscover chaos on their own.",policy_universalBankAccount_on:"Universal bank accounts issued to every citizen. No one is unbanked. The poorest residents finally have somewhere safe to store their savings.",policy_universalBankAccount_off:"Universal bank accounts discontinued. Financial exclusion returns for the poorest citizens.",policy_helicopterMoney_on:"Helicopter money is airborne. Cash is literally raining from the sky. Every citizen is richer â€” briefly. Inflation is watching from below, grinning.",policy_helicopterMoney_off:"The helicopter has landed. The free money spigot is closed. Prices remain elevated.",policy_maximumWage_on:"A maximum wage is now law. No one earns above the cap. Executives are furious. Economists are concerned about brain drain. The people are delighted.",policy_maximumWage_off:"Maximum wage repealed. Compensation limits removed. The talent exodus risk is over.",policy_wealthConfiscation_on:"Wealth confiscation is in effect. Government agents are seizing assets above the threshold. The rich are moving money offshore as fast as they can.",policy_wealthConfiscation_off:"Wealth confiscation has ended. Assets are safe again â€” for now.",policy_nationalizeIndustries_on:"All industries are now nationalized. The government owns the means of production. Five-year plans are being drafted. Entrepreneurs are unemployed. Productivity is in freefall.",policy_nationalizeIndustries_off:"Privatization has begun. Industries are returning to private hands. Markets are chaotic but slowly returning to life.",policy_punitiveTargiffs_on:"Punitive tariffs are in place. All goods are now more expensive. This is to protect the economy, apparently. Consumers are paying the price â€” literally.",policy_punitiveTargiffs_off:"Tariffs removed. Trade barriers down. Prices begin to normalize.",policy_guaranteedJobs_on:"A guaranteed jobs program is active. Every unemployed citizen now works for the government. Unemployment is officially zero. The budget is officially catastrophic.",policy_guaranteedJobs_off:"Guaranteed jobs program ended. Government workers are being released back to the private market.",pandemic:"A pandemic has struck. Health is dropping, businesses are closing, and workers are staying home.",cropFailure:"Crop failure. Poor harvests are causing food prices to spike. The poorest citizens are suffering most.",techBreakthrough:"Technology breakthrough! Productivity in the tech sector has doubled â€” but automation is threatening other jobs.",financialBubble:"A financial bubble is growing. Asset prices are inflating rapidly â€” and history suggests what comes next.",corruption:"Corruption scandal. Government tax revenue is being diverted. Public services are beginning to collapse.",immigrationWave:"An immigration wave has arrived. Skilled workers are boosting productivity, but job competition is increasing.",recession:"Recession begins. Consumer demand is falling, businesses are struggling, and unemployment is rising.",boom:"Economic boom! Consumer confidence has surged. Businesses are hiring and wages are growing.",hyperinflation:"Hyperinflation. Prices are doubling faster than wages can keep up. The currency is becoming worthless. Wheelbarrows of cash are not yet required â€” but give it time.",generalStrike:"General strike! Workers across every sector have walked off the job. Production has stopped. The economy is frozen. History will judge what you do next.",bankRun:"Bank run! Panic is spreading. Citizens are lining up to withdraw everything. The financial system has hours before it collapses. Decide fast.",brainDrain:"Brain drain underway. Your most skilled citizens are packing their bags. Once expertise leaves, it rarely comes back. The productivity gap will compound for decades."};async function Ze(){if(K)return K;if(ue)return new Promise(e=>ye.push(e));ue=!0;try{const{KokoroTTS:e}=await Oo(async()=>{const{KokoroTTS:n}=await import("./kokoro-CqRZUw5m.js");return{KokoroTTS:n}},[]);return K=await e.from_pretrained(Uo,{dtype:"q4",device:"wasm"}),ye.forEach(n=>n(K)),ye=[],ue=!1,K}catch(e){return console.warn("[Narrator] Failed to load Kokoro TTS:",e),ue=!1,null}}function qo(){return ve||(ve=new(window.AudioContext||window.webkitAudioContext)),ve}let ie=null;async function X(e,n={}){if(e){Qe();try{const o=await Ze();if(!o)return;const i=await o.generate(e,{voice:n.voice||Lo}),a=qo(),s=a.createBuffer(1,i.audio.length,i.sampling_rate);s.copyToChannel(i.audio,0);const r=a.createBufferSource();return r.buffer=s,n.rate&&(r.playbackRate.value=n.rate),r.connect(a.destination),r.start(),ie=r,new Promise(l=>{r.onended=()=>{ie=null,l()}})}catch(o){console.warn("[Narrator] Narration error:",o)}}}function Qe(){if(ie){try{ie.stop()}catch{}ie=null}}function Yo(e){const n=J[e];n&&X(n)}function zo(e){const n=J[e];n&&X(n)}function Ko(e,n){const o=`policy_${e}_on`,i=`policy_${e}_off`;if(n===!0||n===!1){const a=n?J[o]:J[i];a&&X(a);return}n>0&&J[o]&&X(J[o])}function Vo(){Ze()}function Jo(){return K!==null}function Xo(){const[e,n]=u.useState(!1),[o,i]=u.useState(!1),[a,s]=u.useState(!1),r=u.useRef(!1),l=u.useCallback(async()=>{n(!0),r.current=!0,i(!0),Vo();const m=setInterval(()=>{Jo()&&(s(!0),i(!1),clearInterval(m),X("Economy simulator narrator ready."))},500);setTimeout(()=>clearInterval(m),3e4)},[]),c=u.useCallback(()=>{n(!1),r.current=!1,Qe()},[]),d=u.useCallback(m=>{r.current&&Yo(m)},[]),p=u.useCallback(m=>{r.current&&zo(m)},[]),h=u.useCallback(m=>{r.current&&X(m)},[]),g=u.useCallback((m,x)=>{r.current&&Ko(m,x)},[]);return{enabled:e,loading:o,ready:a,enable:l,disable:c,onInsight:d,onEvent:p,speak:h,onPolicy:g}}const Le=["dashboard","objectives","policies","histogram"];function Zo(){var Fe,Ae,Ie,_e;const e=Xo(),n=u.useRef(null),[o,i]=u.useState(null),[a,s]=u.useState(!1),[r,l]=u.useState(5),[c,d]=u.useState(Bo()),[p,h]=u.useState(!1),[g,m]=u.useState(null),[x,j]=u.useState(null),[v,y]=u.useState("dashboard"),[T,G]=u.useState(null),[se,L]=u.useState(null),[re,ee]=u.useState(!1),[Te,Se]=u.useState(Wo),[te,le]=u.useState(null),[z,ce]=u.useState(null);u.useEffect(()=>{const f=new Worker(new URL("/ecomsim/assets/simWorker-C2SeXUx_.js",import.meta.url),{type:"module"});return f.addEventListener("message",b=>{const{type:k,state:C,event:D,insight:oe,report:ft}=b.data;switch(k){case"STATE_UPDATE":i(C);break;case"EVENT":e.onEvent(D==null?void 0:D.type);break;case"CHOICE_REQUIRED":G(D),s(!0);break;case"INSIGHT":m(oe),e.onInsight(oe.id);break;case"SCENARIO_COMPLETE":et(ft);break}}),f.postMessage({type:"INIT",scenarioId:c}),n.current=f,()=>f.terminate()},[]);const et=u.useCallback(f=>{const b=V[c];if(b!=null&&b.isStory){const k=I.find(C=>C.id===c);if(k){const C=Xt((f==null?void 0:f.objectives)||[]);if(Se(D=>{const oe={unlockedChapter:Math.max(D.unlockedChapter,k.number+1),scores:{...D.scores,[k.id]:C}};return Do(oe),oe}),ce({chapter:k,objectives:(f==null?void 0:f.objectives)||[],score:C}),s(!0),e.enabled){const D=C>=65?"excellent":C>=35?"good":"poor";e.speak(k.closingNarrative[D])}return}}L(f),s(!0)},[c,e]),N=u.useCallback(f=>{var b;(b=n.current)==null||b.postMessage(f)},[]),U=u.useCallback(f=>{i(null),m(null),j(null),G(null),L(null),ce(null),N({type:"RESET",scenarioId:f}),s(!1)},[N]),tt=u.useCallback(()=>{s(!0),N({type:"PAUSE"})},[N]),ot=u.useCallback(()=>{s(!1),N({type:"RESUME"})},[N]),me=u.useCallback(()=>{U(c)},[U,c]),nt=u.useCallback(f=>{l(f),N({type:"SET_SPEED",speed:f})},[N]),it=u.useCallback((f,b)=>{const k=Ro(f,b);N({type:"SET_POLICY",policy:f,value:k}),i(C=>C&&{...C,policies:{...C.policies,[f]:k}}),e.onPolicy(f,k)},[N,e]),xe=u.useCallback(f=>{if(f==="_reset_story"){Go(),Se({unlockedChapter:1,scores:{}});return}const b=V[f],k=b!=null&&b.isStory?I.find(C=>C.id===f):null;d(f),Eo(f),k?(le(k),U(f),s(!0),N({type:"PAUSE"}),y("objectives"),e.enabled&&e.speak(k.kokoroNarration)):(U(f),b!=null&&b.isHistorical?y("objectives"):y("dashboard"))},[U,N,e]),at=u.useCallback(()=>{N({type:"SET_POLICY",policy:"_forceShock",value:!0})},[N]),st=u.useCallback((f,b)=>{G(null),N({type:"RESOLVE_CHOICE",eventId:f,choiceId:b}),s(!1)},[N]),rt=u.useCallback(()=>{L(null),me()},[me]),lt=u.useCallback(()=>{L(null),h(!0)},[]),ct=u.useCallback(()=>{ce(null),U(c);const f=I.find(b=>b.id===c);f&&le(f)},[U,c]),dt=u.useCallback(()=>{const f=I.find(k=>k.id===c),b=I.find(k=>k.number===((f==null?void 0:f.number)||0)+1);ce(null),b?xe(b.id):h(!0)},[c,xe]),ut=u.useCallback(()=>{le(null),N({type:"RESUME"}),s(!1)},[N]),Me=((Fe=V[c])==null?void 0:Fe.name)||"Free Market",ge=V[c],de=ge==null?void 0:ge.isStory,E=de?I.find(f=>f.id===c):null,Pe=((Ae=o==null?void 0:o.objectives)==null?void 0:Ae.length)>0,ht=Pe?Le:Le.filter(f=>f!=="objectives");return t.jsxs("div",{className:"h-screen flex flex-col bg-[#0a0a0f] text-[#e2e8f0] overflow-hidden font-mono",children:[t.jsx(Jt,{paused:a,speed:r,onPause:tt,onResume:ot,onReset:me,onSpeedChange:nt,onScenarioOpen:()=>h(!0),onShockMe:at,onStatsOpen:()=>ee(!0),scenarioName:de&&E?`Ch.${E.number} ${E.title}`:Me,year:o==null?void 0:o.year,narratorEnabled:e.enabled,narratorLoading:e.loading,onNarratorToggle:e.enabled?e.disable:e.enable}),t.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[t.jsxs("div",{className:"flex-1 relative bg-[#0a0a0f]",children:[t.jsx(Gt,{simState:o,onAgentClick:j,selectedAgentId:x==null?void 0:x.id}),x&&t.jsx(ao,{agent:x,onClose:()=>j(null)}),de&&E&&!te&&!z&&t.jsxs("div",{className:"absolute top-3 left-1/2 -translate-x-1/2 px-4 py-1.5 rounded-full text-xs font-mono font-bold pointer-events-none",style:{background:E.color+"22",border:`1px solid ${E.color}44`,color:E.color},children:["ðŸ“– Chapter ",E.number,": ",E.title," Â· ",E.era]})]}),t.jsxs("div",{className:"w-72 flex flex-col border-l border-[#1e1e2e] bg-[#0a0a0f]",children:[t.jsx("div",{className:"flex border-b border-[#1e1e2e]",children:ht.map(f=>t.jsx("button",{onClick:()=>y(f),className:`flex-1 py-2 text-xs font-mono capitalize transition-colors ${v===f?"text-[#6366f1] border-b border-[#6366f1]":"text-[#475569] hover:text-[#94a3b8]"}`,children:f==="objectives"&&Pe?`ðŸŽ¯ ${o.objectives.filter(b=>b.completed).length}/${o.objectives.length}`:f},f))}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-3",children:[v==="dashboard"&&t.jsx(Lt,{metrics:o==null?void 0:o.metrics,market:o==null?void 0:o.market,activeEvents:o==null?void 0:o.activeEvents}),v==="objectives"&&t.jsx(co,{objectives:o==null?void 0:o.objectives,scenarioDurationYears:o==null?void 0:o.scenarioDurationYears,year:o==null?void 0:o.year,scenarioName:Me}),v==="policies"&&t.jsx(Kt,{policies:o==null?void 0:o.policies,onPolicyChange:it}),v==="histogram"&&t.jsx(lo,{agents:o==null?void 0:o.agents})]})]})]}),g&&t.jsx(oo,{insight:g,onDismiss:()=>m(null)}),T&&t.jsx(fo,{event:T,onChoose:st}),se&&!de&&t.jsx(bo,{report:se,onRetry:rt,onNextScenario:lt}),re&&t.jsx(Po,{metrics:o==null?void 0:o.metrics,market:o==null?void 0:o.market,onClose:()=>ee(!1)}),te&&t.jsx(Fo,{chapter:te,onBegin:ut,onBack:()=>{le(null),h(!0)},chapterScore:te.number>1?(_e=Te.scores)==null?void 0:_e[(Ie=I[te.number-2])==null?void 0:Ie.id]:void 0}),z&&t.jsx(_o,{chapter:z.chapter,objectives:z.objectives,score:z.score,onReplay:ct,onNextChapter:dt,isLastChapter:z.chapter.number===I.length}),p&&t.jsx(eo,{current:c,onSelect:f=>{xe(f),h(!1)},onClose:()=>h(!1),storyProgress:Te})]})}we.createRoot(document.getElementById("root")).render(t.jsx(gt.StrictMode,{children:t.jsx(Zo,{})}));
